[
{
  "model": "desktop.document2",
  "pk": 164059,
  "fields": {
    "owner": [
      "tsevero"
    ],
    "name": "CANCEL: Dicionário Tabela",
    "description": "",
    "uuid": "95bc0676-1325-1741-1ab0-a9e266c7a1f0",
    "type": "query-impala",
    "connector": null,
    "data": "{\"id\": 164059, \"uuid\": \"95bc0676-1325-1741-1ab0-a9e266c7a1f0\", \"name\": \"CANCEL: Dicion\\u00e1rio Tabela\", \"description\": \"\", \"type\": \"query-impala\", \"initialType\": \"impala\", \"coordinatorUuid\": null, \"isHistory\": false, \"isManaged\": false, \"parentSavedQueryUuid\": null, \"isSaved\": true, \"onSuccessUrl\": null, \"pubSubUrl\": null, \"isPresentationModeDefault\": false, \"isPresentationMode\": false, \"isPresentationModeInitialized\": true, \"presentationSnippets\": {}, \"isHidingCode\": false, \"snippets\": [{\"id\": \"d156ca7f-c19d-578a-1bc6-26838549d072\", \"name\": \"\", \"type\": \"impala\", \"connector\": {\"name\": \"Impala\", \"type\": \"impala\", \"id\": \"impala\", \"displayName\": \"Impala\", \"buttonName\": \"Consulta\", \"tooltip\": \"Impala Query\", \"optimizer\": \"off\", \"page\": \"/editor/?type=impala\", \"is_sql\": true, \"is_batchable\": true, \"dialect\": \"impala\", \"dialect_properties\": {}}, \"isSqlDialect\": true, \"dialect\": \"impala\", \"isBatchable\": true, \"autocompleteSettings\": {\"temporaryOnly\": false}, \"aceCursorPosition\": null, \"errors\": [], \"aceErrorsHolder\": [], \"aceWarningsHolder\": [], \"aceErrors\": [], \"aceWarnings\": [], \"editorMode\": true, \"dbSelectionVisible\": false, \"showExecutionAnalysis\": true, \"namespace\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"status\": \"CREATED\", \"computes\": [{\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"type\": \"direct\", \"credentials\": {}}]}, \"compute\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"namespace\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"interface\": \"impala\", \"type\": \"direct\", \"options\": {}}, \"database\": \"default\", \"currentQueryTab\": \"queryResults\", \"pinnedContextTabs\": [], \"loadingQueries\": false, \"queriesHasErrors\": false, \"queriesCurrentPage\": 1, \"queriesTotalPages\": 1, \"queriesFilter\": \"\", \"queriesFilterVisible\": false, \"statementType\": \"text\", \"statementTypes\": [\"text\", \"file\"], \"statementPath\": \"\", \"externalStatementLoaded\": false, \"associatedDocumentLoading\": true, \"associatedDocumentUuid\": null, \"statement_raw\": \"select p.rpr_rge_ruc as IE, \\n  g.rge_cgc_cpf as CPF_CNPJ, \\n  g.Rge_Tge_Vtip_Insc as tipo_1_principal_2_outros, \\n  g.rge_nomb as nome, \\n  gen_tipo.tge_nomb_desc as status,\\n  p.rpr_tus_cod_usr_inicio as usuario_que_iniciou_cancelamento,\\n  p.rpr_ind_individual as origem_1_individual_0_massivo,\\n  gen_motivo.tge_nomb_desc as motivo,\\n  p.rpr_dt_inicio as data_inicio,\\n  sc.tsc_nom_sit as situacao_cadastral_atual,\\n  g.rge_codg_mun as codigo_municipio,\\n  mun.tmu_nom_mun as nome_municipio\\nfrom usr_sat_cadastro.ruc_protocolo p \\ninner join usr_sat_cadastro.ruc_general g on (g.rge_ruc = p.rpr_rge_ruc)\\ninner join usr_sat_shared.tab_generica gen_tipo on (gen_tipo.tge_tip_tab = p.rpr_tge_tstatus and gen_tipo.tge_cod_tip_tab = p.rpr_tge_vstatus)\\ninner join usr_sat_shared.tab_generica gen_motivo on (gen_motivo.tge_tip_tab = p.rpr_tge_tmotivo and gen_motivo.tge_cod_tip_tab = p.rpr_tge_vmotivo)\\ninner join usr_sat_cadastro.tab_sit_cad sc on (sc.tsc_sit_cad = g.rge_tsc_sit_cad)\\ninner join usr_sat_shared.tab_munic mun on (mun.tmu_cod_mun = g.rge_codg_mun)\\nwhere p.rpr_tge_vevento = 1\", \"statementsList\": [\"select p.rpr_rge_ruc as IE, \\n  g.rge_cgc_cpf as CPF_CNPJ, \\n  g.Rge_Tge_Vtip_Insc as tipo_1_principal_2_outros, \\n  g.rge_nomb as nome, \\n  gen_tipo.tge_nomb_desc as status,\\n  p.rpr_tus_cod_usr_inicio as usuario_que_iniciou_cancelamento,\\n  p.rpr_ind_individual as origem_1_individual_0_massivo,\\n  gen_motivo.tge_nomb_desc as motivo,\\n  p.rpr_dt_inicio as data_inicio,\\n  sc.tsc_nom_sit as situacao_cadastral_atual,\\n  g.rge_codg_mun as codigo_municipio,\\n  mun.tmu_nom_mun as nome_municipio\\nfrom usr_sat_cadastro.ruc_protocolo p \\ninner join usr_sat_cadastro.ruc_general g on (g.rge_ruc = p.rpr_rge_ruc)\\ninner join usr_sat_shared.tab_generica gen_tipo on (gen_tipo.tge_tip_tab = p.rpr_tge_tstatus and gen_tipo.tge_cod_tip_tab = p.rpr_tge_vstatus)\\ninner join usr_sat_shared.tab_generica gen_motivo on (gen_motivo.tge_tip_tab = p.rpr_tge_tmotivo and gen_motivo.tge_cod_tip_tab = p.rpr_tge_vmotivo)\\ninner join usr_sat_cadastro.tab_sit_cad sc on (sc.tsc_sit_cad = g.rge_tsc_sit_cad)\\ninner join usr_sat_shared.tab_munic mun on (mun.tmu_cod_mun = g.rge_codg_mun)\\nwhere p.rpr_tge_vevento = 1\"], \"aceSize\": 100, \"status\": \"available\", \"statusForButtons\": \"executed\", \"properties\": {\"settings\": []}, \"viewSettings\": {\"placeHolder\": \"Exemplo: SELECT * FROM tablename ou pressione CTRL + espa\\u00e7o\", \"sqlDialect\": true}, \"variables\": [], \"hasCurlyBracketParameters\": true, \"variableNames\": [], \"variableValues\": {}, \"statement\": \"select p.rpr_rge_ruc as IE, \\n  g.rge_cgc_cpf as CPF_CNPJ, \\n  g.Rge_Tge_Vtip_Insc as tipo_1_principal_2_outros, \\n  g.rge_nomb as nome, \\n  gen_tipo.tge_nomb_desc as status,\\n  p.rpr_tus_cod_usr_inicio as usuario_que_iniciou_cancelamento,\\n  p.rpr_ind_individual as origem_1_individual_0_massivo,\\n  gen_motivo.tge_nomb_desc as motivo,\\n  p.rpr_dt_inicio as data_inicio,\\n  sc.tsc_nom_sit as situacao_cadastral_atual,\\n  g.rge_codg_mun as codigo_municipio,\\n  mun.tmu_nom_mun as nome_municipio\\nfrom usr_sat_cadastro.ruc_protocolo p \\ninner join usr_sat_cadastro.ruc_general g on (g.rge_ruc = p.rpr_rge_ruc)\\ninner join usr_sat_shared.tab_generica gen_tipo on (gen_tipo.tge_tip_tab = p.rpr_tge_tstatus and gen_tipo.tge_cod_tip_tab = p.rpr_tge_vstatus)\\ninner join usr_sat_shared.tab_generica gen_motivo on (gen_motivo.tge_tip_tab = p.rpr_tge_tmotivo and gen_motivo.tge_cod_tip_tab = p.rpr_tge_vmotivo)\\ninner join usr_sat_cadastro.tab_sit_cad sc on (sc.tsc_sit_cad = g.rge_tsc_sit_cad)\\ninner join usr_sat_shared.tab_munic mun on (mun.tmu_cod_mun = g.rge_codg_mun)\\nwhere p.rpr_tge_vevento = 1\", \"result\": {\"id\": \"dd8c919c-1840-05c0-0a11-3bcba00923d3\", \"type\": \"table\", \"hasResultset\": true, \"handle\": {\"secret\": \"iBMkJzTiRMO/m2CRQOIybA==\", \"guid\": \"LyXFw7OISM0AAAAAUIca2Q==\", \"operation_type\": 0, \"has_result_set\": true, \"modified_row_count\": null, \"log_context\": null, \"session_guid\": \"694739cedf14c841:dc95b10bf6623f8d\", \"session_id\": 21572, \"session_type\": \"impala\", \"statement_id\": 0, \"has_more_statements\": false, \"statements_count\": 1, \"previous_statement_hash\": \"882afe619c7be12003203e8f8e481713dbdce908cfc5a28313362994\", \"start\": {\"row\": 0, \"column\": 0}, \"end\": {\"row\": 0, \"column\": 1075}, \"statement\": \"select p.rpr_rge_ruc as IE, \\n  g.rge_cgc_cpf as CPF_CNPJ, \\n  g.Rge_Tge_Vtip_Insc as tipo_1_principal_2_outros, \\n  g.rge_nomb as nome, \\n  gen_tipo.tge_nomb_desc as status,\\n  p.rpr_tus_cod_usr_inicio as usuario_que_iniciou_cancelamento,\\n  p.rpr_ind_individual as origem_1_individual_0_massivo,\\n  gen_motivo.tge_nomb_desc as motivo,\\n  p.rpr_dt_inicio as data_inicio,\\n  sc.tsc_nom_sit as situacao_cadastral_atual,\\n  g.rge_codg_mun as codigo_municipio,\\n  mun.tmu_nom_mun as nome_municipio\\nfrom usr_sat_cadastro.ruc_protocolo p \\ninner join usr_sat_cadastro.ruc_general g on (g.rge_ruc = p.rpr_rge_ruc)\\ninner join usr_sat_shared.tab_generica gen_tipo on (gen_tipo.tge_tip_tab = p.rpr_tge_tstatus and gen_tipo.tge_cod_tip_tab = p.rpr_tge_vstatus)\\ninner join usr_sat_shared.tab_generica gen_motivo on (gen_motivo.tge_tip_tab = p.rpr_tge_tmotivo and gen_motivo.tge_cod_tip_tab = p.rpr_tge_vmotivo)\\ninner join usr_sat_cadastro.tab_sit_cad sc on (sc.tsc_sit_cad = g.rge_tsc_sit_cad)\\ninner join usr_sat_shared.tab_munic mun on (mun.tmu_cod_mun = g.rge_codg_mun)\\nwhere p.rpr_tge_vevento = 1\"}, \"meta\": [], \"rows\": 103085, \"hasMore\": true, \"statement_id\": 0, \"statement_range\": {\"start\": {\"row\": 0, \"column\": 0}, \"end\": {\"row\": 0, \"column\": 0}}, \"statements_count\": 1, \"metaFilter\": {\"query\": \"\", \"facets\": {}, \"text\": []}, \"isMetaFilterVisible\": false, \"filteredMetaChecked\": true, \"filteredColumnCount\": 12, \"filteredMeta\": [{\"type\": \"int\", \"name\": \"\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 0}, {\"name\": \"ie\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 1}, {\"name\": \"cpf_cnpj\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 2}, {\"name\": \"tipo_1_principal_2_outros\", \"type\": \"tinyint\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 3}, {\"name\": \"nome\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 4}, {\"name\": \"status\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 5}, {\"name\": \"usuario_que_iniciou_cancelamento\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 6}, {\"name\": \"origem_1_individual_0_massivo\", \"type\": \"tinyint\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 7}, {\"name\": \"motivo\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 8}, {\"name\": \"data_inicio\", \"type\": \"timestamp\", \"comment\": null, \"cssClass\": \"sort-date\", \"checked\": true, \"originalIndex\": 9}, {\"name\": \"situacao_cadastral_atual\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 10}, {\"name\": \"codigo_municipio\", \"type\": \"int\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 11}, {\"name\": \"nome_municipio\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 12}], \"fetchedOnce\": false, \"startTime\": \"2025-10-14T17:32:17.243Z\", \"endTime\": \"2025-10-14T17:32:18.620Z\", \"executionTime\": 1377, \"data\": [], \"explanation\": \"\", \"logs\": \"\", \"logLines\": 4, \"hasSomeResults\": true}, \"showGrid\": true, \"showChart\": false, \"showLogs\": true, \"progress\": 0, \"jobs\": [], \"executeNextTimeout\": -1, \"isLoading\": false, \"resultsKlass\": \"results impala\", \"errorsKlass\": \"results impala alert alert-error\", \"is_redacted\": false, \"chartType\": \"bars\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null, \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartLimits\": [5, 10, 25, 50, 100], \"chartLimit\": null, \"chartX\": \"ie\", \"chartXPivot\": null, \"chartYSingle\": null, \"chartYMulti\": [\"origem_1_individual_0_massivo\"], \"chartData\": [], \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"hideStacked\": true, \"hasDataForChart\": true, \"previousChartOptions\": {\"chartLimit\": null, \"chartX\": null, \"chartXPivot\": null, \"chartYSingle\": null, \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"chartYMulti\": [], \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null}, \"isResultSettingsVisible\": false, \"settingsVisible\": false, \"checkStatusTimeout\": 551, \"getLogsTimeout\": 652, \"topRisk\": null, \"suggestion\": \"\", \"hasSuggestion\": null, \"compatibilityCheckRunning\": false, \"compatibilitySourcePlatforms\": [{\"name\": \"Teradata\", \"value\": \"teradata\"}, {\"name\": \"Oracle\", \"value\": \"oracle\"}, {\"name\": \"Netezza\", \"value\": \"netezza\"}, {\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}, {\"name\": \"DB2\", \"value\": \"db2\"}, {\"name\": \"Greenplum\", \"value\": \"greenplum\"}, {\"name\": \"MySQL\", \"value\": \"mysql\"}, {\"name\": \"PostgreSQL\", \"value\": \"postgresql\"}, {\"name\": \"Informix\", \"value\": \"informix\"}, {\"name\": \"SQL Server\", \"value\": \"sqlserver\"}, {\"name\": \"Sybase\", \"value\": \"sybase\"}, {\"name\": \"Access\", \"value\": \"access\"}, {\"name\": \"Firebird\", \"value\": \"firebird\"}, {\"name\": \"ANSISQL\", \"value\": \"ansisql\"}, {\"name\": \"Generic\", \"value\": \"generic\"}], \"compatibilitySourcePlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"compatibilityTargetPlatforms\": [{\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}], \"compatibilityTargetPlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"showSqlAnalyzer\": false, \"wasBatchExecuted\": false, \"isReady\": true, \"lastExecuted\": 1760463136896, \"lastAceSelectionRowOffset\": 18, \"executingBlockingOperation\": null, \"showLongOperationWarning\": false, \"lastExecutedStatements\": \"select p.rpr_rge_ruc as IE, \\n  g.rge_cgc_cpf as CPF_CNPJ, \\n  g.Rge_Tge_Vtip_Insc as tipo_1_principal_2_outros, \\n  g.rge_nomb as nome, \\n  gen_tipo.tge_nomb_desc as status,\\n  p.rpr_tus_cod_usr_inicio as usuario_que_iniciou_cancelamento,\\n  p.rpr_ind_individual as origem_1_individual_0_massivo,\\n  gen_motivo.tge_nomb_desc as motivo,\\n  p.rpr_dt_inicio as data_inicio,\\n  sc.tsc_nom_sit as situacao_cadastral_atual,\\n  g.rge_codg_mun as codigo_municipio,\\n  mun.tmu_nom_mun as nome_municipio\\nfrom usr_sat_cadastro.ruc_protocolo p \\ninner join usr_sat_cadastro.ruc_general g on (g.rge_ruc = p.rpr_rge_ruc)\\ninner join usr_sat_shared.tab_generica gen_tipo on (gen_tipo.tge_tip_tab = p.rpr_tge_tstatus and gen_tipo.tge_cod_tip_tab = p.rpr_tge_vstatus)\\ninner join usr_sat_shared.tab_generica gen_motivo on (gen_motivo.tge_tip_tab = p.rpr_tge_tmotivo and gen_motivo.tge_cod_tip_tab = p.rpr_tge_vmotivo)\\ninner join usr_sat_cadastro.tab_sit_cad sc on (sc.tsc_sit_cad = g.rge_tsc_sit_cad)\\ninner join usr_sat_shared.tab_munic mun on (mun.tmu_cod_mun = g.rge_codg_mun)\\nwhere p.rpr_tge_vevento = 1\", \"lastExecutedSelectionRange\": {\"start\": {\"row\": 18, \"column\": 27}, \"end\": {\"row\": 18, \"column\": 27}}, \"formatEnabled\": true, \"isFetchingData\": false, \"isCanceling\": false, \"lastCheckStatusRequest\": {\"readyState\": 4, \"responseText\": \"{\\\"status\\\": 0, \\\"query_status\\\": {\\\"status\\\": \\\"available\\\"}}\", \"responseJSON\": {\"status\": 0, \"query_status\": {\"status\": \"available\"}}, \"status\": 200, \"statusText\": \"OK\"}, \"lastGetLogsRequest\": {\"readyState\": 4, \"responseText\": \"{\\\"status\\\": 0, \\\"logs\\\": \\\"Query cd4888b3c3c5252f:d91a875000000000: 85% Complete (6 out of 7)\\\", \\\"progress\\\": 100, \\\"jobs\\\": [{\\\"name\\\": \\\"cd4888b3c3c5252f:d91a875000000000\\\", \\\"url\\\": \\\"/hue/jobbrowser#!id=cd4888b3c3c5252f:d91a875000000000\\\", \\\"started\\\": true, \\\"finished\\\": false, \\\"percentJob\\\": 100}], \\\"isFullLogs\\\": false}\", \"responseJSON\": {\"status\": 0, \"logs\": \"Query cd4888b3c3c5252f:d91a875000000000: 85% Complete (6 out of 7)\", \"progress\": 100, \"jobs\": [{\"name\": \"cd4888b3c3c5252f:d91a875000000000\", \"url\": \"/hue/jobbrowser#!id=cd4888b3c3c5252f:d91a875000000000\", \"started\": true, \"finished\": false, \"percentJob\": 100}], \"isFullLogs\": false}, \"status\": 200, \"statusText\": \"OK\"}}], \"selectedSnippet\": \"impala\", \"creatingSessionLocks\": [], \"sessions\": [], \"directoryUuid\": \"\", \"dependentsCoordinator\": [], \"historyFilter\": \"\", \"historyFilterVisible\": false, \"loadingHistory\": false, \"historyInitialHeight\": 11451, \"forceHistoryInitialHeight\": false, \"historyCurrentPage\": 1, \"historyTotalPages\": 137, \"schedulerViewModel\": null, \"schedulerViewModelIsLoaded\": false, \"isBatchable\": true, \"isExecutingAll\": false, \"executingAllIndex\": 0, \"retryModalConfirm\": null, \"retryModalCancel\": null, \"canSave\": null, \"unloaded\": false, \"updateHistoryFailed\": false, \"viewSchedulerId\": \"\", \"loadingScheduler\": false}",
    "extra": "",
    "search": "select p.rpr_rge_ruc as IE, \n  g.rge_cgc_cpf as CPF_CNPJ, \n  g.Rge_Tge_Vtip_Insc as tipo_1_principal_2_outros, \n  g.rge_nomb as nome, \n  gen_tipo.tge_nomb_desc as status,\n  p.rpr_tus_cod_usr_inicio as usuario_que_iniciou_cancelamento,\n  p.rpr_ind_individual as origem_1_individual_0_massivo,\n  gen_motivo.tge_nomb_desc as motivo,\n  p.rpr_dt_inicio as data_inicio,\n  sc.tsc_nom_sit as situacao_cadastral_atual,\n  g.rge_codg_mun as codigo_municipio,\n  mun.tmu_nom_mun as nome_municipio\nfrom usr_sat_cadastro.ruc_protocolo p \ninner join usr_sat_cadastro.ruc_general g on (g.rge_ruc = p.rpr_rge_ruc)\ninner join usr_sat_shared.tab_generica gen_tipo on (gen_tipo.tge_tip_tab = p.rpr_tge_tstatus and gen_tipo.tge_cod_tip_tab = p.rpr_tge_vstatus)\ninner join usr_sat_shared.tab_generica gen_motivo on (gen_motivo.tge_tip_tab = p.rpr_tge_tmotivo and gen_motivo.tge_cod_tip_tab = p.rpr_tge_vmotivo)\ninner join usr_sat_cadastro.tab_sit_cad sc on (sc.tsc_sit_cad = g.rge_tsc_sit_cad)\ninner join usr_sat_shared.tab_munic mun on (mun.tmu_cod_mun = g.rge_codg_mun)\nwhere p.rpr_tge_vevento = 1",
    "last_modified": "2025-10-14T14:48:10.340",
    "version": 1,
    "is_history": false,
    "is_managed": false,
    "is_trashed": false,
    "parent_directory": [
      "1942b436-4932-433c-8549-8c097875c739",
      1,
      false
    ],
    "dependencies": []
  }
},
{
  "model": "desktop.document2",
  "pk": 164888,
  "fields": {
    "owner": [
      "tsevero"
    ],
    "name": "CRED-CANCEL: Análises",
    "description": "",
    "uuid": "42f9bbc3-b428-e342-b972-b3e0dead3a21",
    "type": "query-impala",
    "connector": null,
    "data": "{\"id\": 164888, \"uuid\": \"169220f7-0c84-4c4a-b149-0a5531a11a71\", \"name\": \"CRED-CANCEL: An\\u00e1lises\", \"description\": \"\", \"type\": \"query-impala\", \"initialType\": \"impala\", \"coordinatorUuid\": null, \"isHistory\": false, \"isManaged\": false, \"parentSavedQueryUuid\": \"42f9bbc3-b428-e342-b972-b3e0dead3a21\", \"isSaved\": true, \"onSuccessUrl\": null, \"pubSubUrl\": null, \"isPresentationModeDefault\": false, \"isPresentationMode\": false, \"isPresentationModeInitialized\": true, \"presentationSnippets\": {}, \"isHidingCode\": false, \"snippets\": [{\"id\": \"e44cc72d-e6da-d4ba-1e75-31ce75457e72\", \"name\": \"\", \"type\": \"impala\", \"connector\": {\"name\": \"Impala\", \"type\": \"impala\", \"id\": \"impala\", \"displayName\": \"Impala\", \"buttonName\": \"Consulta\", \"tooltip\": \"Impala Query\", \"optimizer\": \"off\", \"page\": \"/editor/?type=impala\", \"is_sql\": true, \"is_batchable\": true, \"dialect\": \"impala\", \"dialect_properties\": {}}, \"isSqlDialect\": true, \"dialect\": \"impala\", \"isBatchable\": true, \"autocompleteSettings\": {\"temporaryOnly\": false}, \"aceCursorPosition\": {\"row\": 1060, \"column\": 0}, \"errors\": [{\"message\": \"ParseException: Syntax error in line 938:undefined:\\n-- FIM DO SCRIPT DE AN\\u00c1LISES\\n                            ^\\nEncountered: EOF\\nExpected: ALTER, COMMENT, COMPUTE, COPY, CREATE, DELETE, DESCRIBE, DROP, EXPLAIN, GRANT, INSERT, INVALIDATE, LOAD, REFRESH, REVOKE, SELECT, SET, SHOW, TRUNCATE, UNSET, UPDATE, UPSERT, USE, VALUES, WITH\\n\\n\\nCAUSED BY: Exception: Syntax error\\n\", \"help\": null, \"line\": 937}], \"aceErrorsHolder\": [], \"aceWarningsHolder\": [], \"aceErrors\": [], \"aceWarnings\": [], \"editorMode\": true, \"dbSelectionVisible\": false, \"showExecutionAnalysis\": false, \"namespace\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"status\": \"CREATED\", \"computes\": [{\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"type\": \"direct\", \"credentials\": {}}]}, \"compute\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"namespace\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"interface\": \"impala\", \"type\": \"direct\", \"options\": {}}, \"database\": \"default\", \"currentQueryTab\": \"queryHistory\", \"pinnedContextTabs\": [], \"loadingQueries\": false, \"queriesHasErrors\": false, \"queriesCurrentPage\": 1, \"queriesTotalPages\": 3, \"queriesFilter\": \"\", \"queriesFilterVisible\": false, \"statementType\": \"text\", \"statementTypes\": [\"text\", \"file\"], \"statementPath\": \"\", \"externalStatementLoaded\": false, \"associatedDocumentLoading\": true, \"associatedDocumentUuid\": null, \"statement_raw\": \"-- =============================================================================\\r\\n-- AN\\u00c1LISE COMPLETA DE CR\\u00c9DITOS ICMS ACUMULADOS - VERS\\u00c3O 3.0\\r\\n-- Sistema de Consultas com Dados de Enriquecimento (Cancelamento/Suspeitas)\\r\\n-- Atualizado para trabalhar com an\\u00e1lises de 12 e 60 meses\\r\\n-- Execute cada bloco SEPARADAMENTE, pausando entre execu\\u00e7\\u00f5es\\r\\n-- =============================================================================\\r\\n\\r\\n-- CONFIGURA\\u00c7\\u00c3O INICIAL\\r\\nSET REQUEST_POOL = 'medium';\\r\\nSET MEM_LIMIT = 8G;\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 1: VIS\\u00c3O GERAL DO SISTEMA COM ENRIQUECIMENTO\\r\\n-- Execute este bloco primeiro para ter o panorama geral\\r\\n-- =============================================================================\\r\\n\\r\\n-- 1.1 PANORAMA EXECUTIVO GERAL ENRIQUECIDO\\r\\nSELECT\\r\\n    'PANORAMA GERAL - CR\\u00c9DITOS ICMS' AS categoria,\\r\\n    -- M\\u00e9tricas de Volume\\r\\n    COUNT(DISTINCT nu_cnpj) AS total_empresas_monitoradas,\\r\\n    COUNT(DISTINCT nu_cnpj_grupo) AS total_grupos_economicos,\\r\\n    \\r\\n    -- Distribui\\u00e7\\u00e3o por Risco Original (60 meses)\\r\\n    COUNT(CASE WHEN classificacao_risco_60m = 'CR\\u00cdTICO' THEN 1 END) AS empresas_criticas_60m,\\r\\n    COUNT(CASE WHEN classificacao_risco_60m = 'ALTO' THEN 1 END) AS empresas_alto_risco_60m,\\r\\n    COUNT(CASE WHEN classificacao_risco_12m = 'CR\\u00cdTICO' THEN 1 END) AS empresas_criticas_12m,\\r\\n    COUNT(CASE WHEN classificacao_risco_12m = 'ALTO' THEN 1 END) AS empresas_alto_risco_12m,\\r\\n    \\r\\n    -- Distribui\\u00e7\\u00e3o por Score Combinado (com enriquecimento)\\r\\n    COUNT(CASE WHEN score_risco_combinado_60m >= 120 THEN 1 END) AS empresas_score_60m_120plus,\\r\\n    COUNT(CASE WHEN score_risco_combinado_60m >= 100 THEN 1 END) AS empresas_score_60m_100plus,\\r\\n    COUNT(CASE WHEN score_risco_combinado_12m >= 100 THEN 1 END) AS empresas_score_12m_100plus,\\r\\n    \\r\\n    -- Empresas com Indicadores de Fraude\\r\\n    COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) AS empresas_suspeitas,\\r\\n    COUNT(CASE WHEN flag_tem_declaracoes_zeradas = 1 THEN 1 END) AS empresas_com_decl_zeradas,\\r\\n    COUNT(CASE WHEN flag_tem_omissoes = 1 THEN 1 END) AS empresas_com_omissoes,\\r\\n    COUNT(CASE WHEN sn_cancelado_inex_inativ = 1 THEN 1 END) AS empresas_canceladas_inex_inativ,\\r\\n    COUNT(CASE WHEN qtde_indicios_fraude >= 3 THEN 1 END) AS empresas_3plus_indicios,\\r\\n    \\r\\n    -- Percentuais Cr\\u00edticos\\r\\n    ROUND(COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) * 100.0 / COUNT(*), 2) AS perc_suspeitas,\\r\\n    ROUND(COUNT(CASE WHEN score_risco_combinado_60m >= 120 THEN 1 END) * 100.0 / COUNT(*), 2) AS perc_score_60m_120plus,\\r\\n    \\r\\n    -- M\\u00e9tricas Financeiras\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_credito_acumulado,\\r\\n    ROUND(SUM(CASE WHEN flag_empresa_suspeita = 1 THEN saldo_credor_atual ELSE 0 END), 2) AS credito_empresas_suspeitas,\\r\\n    ROUND(SUM(CASE WHEN score_risco_combinado_60m >= 120 THEN saldo_credor_atual ELSE 0 END), 2) AS credito_score_120plus,\\r\\n    \\r\\n    -- Pagamentos\\r\\n    COUNT(CASE WHEN flag_tem_pagamentos = 1 THEN 1 END) AS empresas_com_pagamentos,\\r\\n    ROUND(SUM(valor_pagtos), 2) AS total_valor_pago,\\r\\n    \\r\\n    -- An\\u00e1lise Temporal\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_periodos_iguais_60m,\\r\\n    ROUND(AVG(valor_igual_total_periodos_12m), 2) AS media_periodos_iguais_12m,\\r\\n    ROUND(AVG(crescimento_saldo_percentual_60m), 2) AS media_crescimento_60m,\\r\\n    ROUND(AVG(crescimento_saldo_percentual_12m), 2) AS media_crescimento_12m,\\r\\n    \\r\\n    -- Data de Atualiza\\u00e7\\u00e3o\\r\\n    CURRENT_TIMESTAMP() AS data_consulta\\r\\nFROM teste.credito_dime_completo;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 1.2 DISTRIBUI\\u00c7\\u00c3O POR FAIXAS DE SCORE COMBINADO 60M (NOVO)\\r\\nSELECT\\r\\n    'DISTRIBUI\\u00c7\\u00c3O POR SCORE COMBINADO 60M' AS categoria,\\r\\n    CASE \\r\\n        WHEN score_risco_combinado_60m >= 150 THEN '150+ (EXTREMO)'\\r\\n        WHEN score_risco_combinado_60m >= 120 THEN '120-149 (MUITO CR\\u00cdTICO)'\\r\\n        WHEN score_risco_combinado_60m >= 85 THEN '85-119 (CR\\u00cdTICO)'\\r\\n        WHEN score_risco_combinado_60m >= 50 THEN '50-84 (ALTO)'\\r\\n        WHEN score_risco_combinado_60m >= 30 THEN '30-49 (M\\u00c9DIO)'\\r\\n        ELSE '0-29 (BAIXO)'\\r\\n    END AS faixa_score_combinado_60m,\\r\\n    \\r\\n    COUNT(*) AS quantidade_empresas,\\r\\n    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER(), 2) AS percentual,\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_credito_faixa,\\r\\n    ROUND(AVG(saldo_credor_atual), 2) AS media_credito_faixa,\\r\\n    \\r\\n    -- Indicadores de Risco\\r\\n    COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) AS qtde_suspeitas,\\r\\n    ROUND(AVG(qtde_indicios_fraude), 2) AS media_indicios_fraude,\\r\\n    COUNT(CASE WHEN flag_tem_declaracoes_zeradas = 1 THEN 1 END) AS qtde_decl_zeradas,\\r\\n    COUNT(CASE WHEN flag_tem_omissoes = 1 THEN 1 END) AS qtde_omissoes,\\r\\n    \\r\\n    -- Compara\\u00e7\\u00e3o com Score Original\\r\\n    ROUND(AVG(score_risco_60m), 2) AS media_score_original_60m,\\r\\n    ROUND(AVG(score_risco_combinado_60m - score_risco_60m), 2) AS media_pontos_adicionados,\\r\\n    \\r\\n    -- Comportamento\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_periodos_iguais,\\r\\n    ROUND(AVG(crescimento_saldo_percentual_60m), 2) AS media_crescimento\\r\\nFROM teste.credito_dime_completo\\r\\nGROUP BY faixa_score_combinado_60m\\r\\nORDER BY MIN(score_risco_combinado_60m) DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 1.3 COMPARATIVO 12M vs 60M POR EMPRESA\\r\\nSELECT\\r\\n    'COMPARATIVO JANELAS TEMPORAIS' AS categoria,\\r\\n    \\r\\n    CASE \\r\\n        WHEN score_risco_combinado_12m >= 100 AND score_risco_combinado_60m >= 120 \\r\\n            THEN 'CR\\u00cdTICO EM AMBAS'\\r\\n        WHEN score_risco_combinado_60m >= 120 AND score_risco_combinado_12m < 100 \\r\\n            THEN 'HIST\\u00d3RICO CR\\u00cdTICO, RECENTE MELHOR'\\r\\n        WHEN score_risco_combinado_12m >= 100 AND score_risco_combinado_60m < 120 \\r\\n            THEN 'RECENTE CR\\u00cdTICO, HIST\\u00d3RICO MELHOR'\\r\\n        WHEN score_risco_combinado_12m >= 70 OR score_risco_combinado_60m >= 85 \\r\\n            THEN 'ALTO RISCO'\\r\\n        ELSE 'BAIXO/M\\u00c9DIO RISCO'\\r\\n    END AS perfil_temporal,\\r\\n    \\r\\n    COUNT(*) AS qtde_empresas,\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_credito,\\r\\n    ROUND(AVG(score_risco_12m), 2) AS media_score_12m,\\r\\n    ROUND(AVG(score_risco_60m), 2) AS media_score_60m,\\r\\n    ROUND(AVG(score_risco_combinado_12m), 2) AS media_score_comb_12m,\\r\\n    ROUND(AVG(score_risco_combinado_60m), 2) AS media_score_comb_60m,\\r\\n    ROUND(AVG(valor_igual_total_periodos_12m), 2) AS media_iguais_12m,\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_iguais_60m,\\r\\n    COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) AS qtde_suspeitas\\r\\nFROM teste.credito_dime_completo\\r\\nGROUP BY perfil_temporal\\r\\nORDER BY qtde_empresas DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 1.4 MATRIZ DE RISCO: SUSPEITAS vs CR\\u00c9DITO (ATUALIZADO)\\r\\nSELECT\\r\\n    'MATRIZ DE RISCO' AS categoria,\\r\\n    CASE \\r\\n        WHEN flag_empresa_suspeita = 1 THEN 'EMPRESA SUSPEITA'\\r\\n        ELSE 'N\\u00c3O SUSPEITA'\\r\\n    END AS status_suspeita,\\r\\n    \\r\\n    CASE\\r\\n        WHEN saldo_credor_atual >= 1000000 THEN 'R$ 1M+'\\r\\n        WHEN saldo_credor_atual >= 500000 THEN 'R$ 500K-1M'\\r\\n        WHEN saldo_credor_atual >= 100000 THEN 'R$ 100K-500K'\\r\\n        WHEN saldo_credor_atual >= 50000 THEN 'R$ 50K-100K'\\r\\n        ELSE 'Abaixo R$ 50K'\\r\\n    END AS faixa_credito,\\r\\n    \\r\\n    COUNT(*) AS qtde_empresas,\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_credito,\\r\\n    ROUND(AVG(score_risco_combinado_60m), 2) AS media_score_combinado_60m,\\r\\n    ROUND(AVG(score_suspeita), 2) AS media_score_suspeita,\\r\\n    COUNT(CASE WHEN sn_cancelado_inex_inativ = 1 THEN 1 END) AS qtde_canceladas,\\r\\n    ROUND(AVG(qtde_indicios_fraude), 2) AS media_indicios,\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_periodos_iguais\\r\\nFROM teste.credito_dime_completo\\r\\nGROUP BY status_suspeita, faixa_credito\\r\\nORDER BY status_suspeita DESC, MIN(saldo_credor_atual) DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 1.5 DISTRIBUI\\u00c7\\u00c3O POR GER\\u00caNCIA REGIONAL COM ENRIQUECIMENTO\\r\\nSELECT\\r\\n    'DISTRIBUI\\u00c7\\u00c3O POR GERFE ENRIQUECIDA' AS categoria,\\r\\n    nm_gerfe,\\r\\n    COUNT(*) AS total_empresas,\\r\\n    \\r\\n    -- Classifica\\u00e7\\u00e3o Original (60m)\\r\\n    COUNT(CASE WHEN classificacao_risco_60m IN ('CR\\u00cdTICO', 'ALTO') THEN 1 END) AS empresas_prioritarias_60m,\\r\\n    COUNT(CASE WHEN classificacao_risco_12m IN ('CR\\u00cdTICO', 'ALTO') THEN 1 END) AS empresas_prioritarias_12m,\\r\\n    \\r\\n    -- Score Combinado\\r\\n    COUNT(CASE WHEN score_risco_combinado_60m >= 120 THEN 1 END) AS empresas_score_60m_120plus,\\r\\n    COUNT(CASE WHEN score_risco_combinado_12m >= 100 THEN 1 END) AS empresas_score_12m_100plus,\\r\\n    \\r\\n    -- Indicadores de Fraude\\r\\n    COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) AS empresas_suspeitas,\\r\\n    COUNT(CASE WHEN qtde_indicios_fraude >= 5 THEN 1 END) AS empresas_5plus_indicios,\\r\\n    COUNT(CASE WHEN flag_tem_declaracoes_zeradas = 1 THEN 1 END) AS empresas_decl_zeradas,\\r\\n    COUNT(CASE WHEN sn_cancelado_inex_inativ = 1 THEN 1 END) AS empresas_canceladas,\\r\\n    \\r\\n    -- Financeiro\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_credito,\\r\\n    ROUND(SUM(CASE WHEN flag_empresa_suspeita = 1 THEN saldo_credor_atual ELSE 0 END), 2) AS credito_suspeitas,\\r\\n    \\r\\n    -- Scores M\\u00e9dios\\r\\n    ROUND(AVG(score_risco_60m), 2) AS score_medio_60m,\\r\\n    ROUND(AVG(score_risco_combinado_60m), 2) AS score_medio_combinado_60m,\\r\\n    \\r\\n    -- Comportamento\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_periodos_iguais_60m,\\r\\n    ROUND(AVG(crescimento_saldo_percentual_60m), 2) AS media_crescimento_60m,\\r\\n    \\r\\n    -- Percentuais\\r\\n    ROUND(COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) * 100.0 / COUNT(*), 2) AS perc_suspeitas\\r\\nFROM teste.credito_dime_completo\\r\\nWHERE nm_gerfe IS NOT NULL\\r\\nGROUP BY nm_gerfe\\r\\nORDER BY empresas_suspeitas DESC, credito_suspeitas DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 2: AN\\u00c1LISE DE SUSPEITAS E FRAUDES (ATUALIZADO)\\r\\n-- =============================================================================\\r\\n\\r\\n-- 2.1 PANORAMA DE EMPRESAS SUSPEITAS\\r\\nSELECT\\r\\n    'PANORAMA EMPRESAS SUSPEITAS' AS categoria,\\r\\n    \\r\\n    -- Por C\\u00f3digo de Situa\\u00e7\\u00e3o\\r\\n    cd_situacao_suspeita,\\r\\n    COUNT(*) AS qtde_empresas,\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_credito,\\r\\n    ROUND(AVG(saldo_credor_atual), 2) AS media_credito,\\r\\n    ROUND(AVG(score_suspeita), 2) AS media_score_suspeita,\\r\\n    ROUND(AVG(score_risco_combinado_60m), 2) AS media_score_combinado_60m,\\r\\n    ROUND(AVG(score_risco_combinado_12m), 2) AS media_score_combinado_12m,\\r\\n    ROUND(AVG(qtde_indicios_fraude), 2) AS media_indicios,\\r\\n    \\r\\n    -- Comportamento Temporal\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_periodos_iguais_60m,\\r\\n    ROUND(AVG(valor_igual_total_periodos_12m), 2) AS media_periodos_iguais_12m,\\r\\n    ROUND(AVG(qtde_ultimos_12m_iguais), 2) AS media_ultimos_12m_iguais,\\r\\n    COUNT(CASE WHEN sn_cancelado_inex_inativ = 1 THEN 1 END) AS qtde_canceladas,\\r\\n    \\r\\n    -- Movimenta\\u00e7\\u00e3o NFe\\r\\n    ROUND(SUM(vl_nfes_saida_suspeita), 2) AS total_nfe_saida,\\r\\n    ROUND(SUM(vl_nfes_entrada_suspeita), 2) AS total_nfe_entrada,\\r\\n    \\r\\n    -- Declara\\u00e7\\u00f5es\\r\\n    ROUND(AVG(periodos_omissos_normal + periodos_omissos_simples), 2) AS media_omissoes,\\r\\n    ROUND(AVG(periodos_zerados_normal + periodos_zerados_simples), 2) AS media_zerados\\r\\nFROM teste.credito_dime_completo\\r\\nWHERE flag_empresa_suspeita = 1\\r\\nGROUP BY cd_situacao_suspeita\\r\\nORDER BY qtde_empresas DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 2.2 TOP 50 EMPRESAS MAIS SUSPEITAS (ATUALIZADO)\\r\\nSELECT\\r\\n    'TOP 50 EMPRESAS SUSPEITAS' AS categoria,\\r\\n    ROW_NUMBER() OVER (ORDER BY score_risco_combinado_60m DESC, qtde_indicios_fraude DESC) AS ranking,\\r\\n    \\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    nm_fantasia,\\r\\n    de_cnae,\\r\\n    nm_gerfe,\\r\\n    \\r\\n    -- Scores Temporais\\r\\n    score_risco_12m AS score_original_12m,\\r\\n    score_risco_60m AS score_original_60m,\\r\\n    score_risco_combinado_12m,\\r\\n    score_risco_combinado_60m,\\r\\n    score_suspeita,\\r\\n    \\r\\n    -- Cr\\u00e9dito\\r\\n    saldo_credor_atual,\\r\\n    crescimento_saldo_percentual_60m,\\r\\n    crescimento_saldo_percentual_12m,\\r\\n    \\r\\n    -- Indicadores de Fraude\\r\\n    cd_situacao_suspeita,\\r\\n    qtde_indicios_fraude,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    qt_motivos,\\r\\n    \\r\\n    -- Comportamento Temporal\\r\\n    valor_igual_total_periodos_60m,\\r\\n    valor_igual_total_periodos_12m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    flag_tem_declaracoes_zeradas,\\r\\n    flag_tem_omissoes,\\r\\n    periodos_zerados_normal + periodos_zerados_simples AS total_periodos_zerados,\\r\\n    periodos_omissos_normal + periodos_omissos_simples AS total_periodos_omissos,\\r\\n    \\r\\n    -- Noteiras\\r\\n    qt_clientes_noteiras,\\r\\n    qt_fornecedoras_noteiras,\\r\\n    \\r\\n    -- DFe\\r\\n    sn_suspenso_dfe,\\r\\n    \\r\\n    -- Meses Declarados\\r\\n    qtde_meses_declarados_60m,\\r\\n    qtde_meses_declarados_12m\\r\\nFROM teste.credito_dime_completo\\r\\nWHERE flag_empresa_suspeita = 1\\r\\nORDER BY score_risco_combinado_60m DESC, qtde_indicios_fraude DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 2.3 AN\\u00c1LISE DE IND\\u00cdCIOS DE FRAUDE (ATUALIZADO)\\r\\nSELECT\\r\\n    'AN\\u00c1LISE IND\\u00cdCIOS DE FRAUDE' AS categoria,\\r\\n    \\r\\n    CASE\\r\\n        WHEN qtde_indicios_fraude >= 15 THEN '15+ ind\\u00edcios (EXTREMO)'\\r\\n        WHEN qtde_indicios_fraude >= 10 THEN '10-14 ind\\u00edcios (MUITO ALTO)'\\r\\n        WHEN qtde_indicios_fraude >= 7 THEN '7-9 ind\\u00edcios (ALTO)'\\r\\n        WHEN qtde_indicios_fraude >= 5 THEN '5-6 ind\\u00edcios (M\\u00c9DIO-ALTO)'\\r\\n        WHEN qtde_indicios_fraude >= 3 THEN '3-4 ind\\u00edcios (M\\u00c9DIO)'\\r\\n        WHEN qtde_indicios_fraude >= 1 THEN '1-2 ind\\u00edcios (BAIXO)'\\r\\n        ELSE 'Sem ind\\u00edcios'\\r\\n    END AS faixa_indicios,\\r\\n    \\r\\n    COUNT(*) AS qtde_empresas,\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_credito,\\r\\n    ROUND(AVG(score_risco_combinado_60m), 2) AS media_score_combinado_60m,\\r\\n    ROUND(AVG(score_risco_combinado_12m), 2) AS media_score_combinado_12m,\\r\\n    ROUND(AVG(score_suspeita), 2) AS media_score_suspeita,\\r\\n    COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) AS qtde_marcadas_suspeitas,\\r\\n    COUNT(CASE WHEN sn_cancelado_inex_inativ = 1 THEN 1 END) AS qtde_canceladas,\\r\\n    ROUND(AVG(soma_score_indicios), 2) AS media_soma_score_indicios,\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_periodos_iguais_60m\\r\\nFROM teste.credito_dime_completo\\r\\nGROUP BY faixa_indicios\\r\\nORDER BY MIN(qtde_indicios_fraude) DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 2.4 DECLARA\\u00c7\\u00d5ES ZERADAS E OMISS\\u00d5ES (ATUALIZADO)\\r\\nSELECT\\r\\n    'AN\\u00c1LISE DECLARA\\u00c7\\u00d5ES ZERADAS E OMISS\\u00d5ES' AS categoria,\\r\\n    \\r\\n    CASE\\r\\n        WHEN (periodos_zerados_normal + periodos_zerados_simples) >= 12 THEN '12+ per\\u00edodos zerados'\\r\\n        WHEN (periodos_zerados_normal + periodos_zerados_simples) >= 6 THEN '6-11 per\\u00edodos zerados'\\r\\n        WHEN (periodos_zerados_normal + periodos_zerados_simples) >= 1 THEN '1-5 per\\u00edodos zerados'\\r\\n        ELSE 'Sem per\\u00edodos zerados'\\r\\n    END AS faixa_zerados,\\r\\n    \\r\\n    CASE\\r\\n        WHEN (periodos_omissos_normal + periodos_omissos_simples) >= 6 THEN '6+ per\\u00edodos omissos'\\r\\n        WHEN (periodos_omissos_normal + periodos_omissos_simples) >= 3 THEN '3-5 per\\u00edodos omissos'\\r\\n        WHEN (periodos_omissos_normal + periodos_omissos_simples) >= 1 THEN '1-2 per\\u00edodos omissos'\\r\\n        ELSE 'Sem omiss\\u00f5es'\\r\\n    END AS faixa_omissoes,\\r\\n    \\r\\n    COUNT(*) AS qtde_empresas,\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_credito,\\r\\n    ROUND(AVG(score_risco_combinado_60m), 2) AS media_score_combinado_60m,\\r\\n    COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) AS qtde_suspeitas,\\r\\n    ROUND(AVG(qtde_indicios_fraude), 2) AS media_indicios,\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_periodos_iguais_60m\\r\\nFROM teste.credito_dime_completo\\r\\nWHERE flag_tem_declaracoes_zeradas = 1 OR flag_tem_omissoes = 1\\r\\nGROUP BY faixa_zerados, faixa_omissoes\\r\\nORDER BY qtde_empresas DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 2.5 EMPRESAS COM M\\u00daLTIPLOS SINAIS DE ALERTA (ATUALIZADO)\\r\\nWITH alertas_calc AS (\\r\\n    SELECT\\r\\n        *,\\r\\n        (CASE WHEN flag_empresa_suspeita = 1 THEN 1 ELSE 0 END +\\r\\n         CASE WHEN flag_tem_declaracoes_zeradas = 1 THEN 1 ELSE 0 END +\\r\\n         CASE WHEN flag_tem_omissoes = 1 THEN 1 ELSE 0 END +\\r\\n         CASE WHEN sn_cancelado_inex_inativ = 1 THEN 1 ELSE 0 END +\\r\\n         CASE WHEN qtde_indicios_fraude >= 5 THEN 1 ELSE 0 END +\\r\\n         CASE WHEN qtde_ultimos_12m_iguais >= 12 THEN 1 ELSE 0 END +\\r\\n         CASE WHEN valor_igual_total_periodos_60m >= 36 THEN 1 ELSE 0 END +\\r\\n         CASE WHEN crescimento_saldo_percentual_60m > 500 THEN 1 ELSE 0 END) AS qtde_alertas\\r\\n    FROM teste.credito_dime_completo\\r\\n    WHERE (\\r\\n        flag_empresa_suspeita = 1 OR\\r\\n        flag_tem_declaracoes_zeradas = 1 OR\\r\\n        flag_tem_omissoes = 1 OR\\r\\n        sn_cancelado_inex_inativ = 1 OR\\r\\n        qtde_indicios_fraude >= 3\\r\\n    )\\r\\n)\\r\\nSELECT\\r\\n    'M\\u00daLTIPLOS SINAIS DE ALERTA' AS categoria,\\r\\n    qtde_alertas,\\r\\n    COUNT(*) AS qtde_empresas,\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_credito,\\r\\n    ROUND(AVG(saldo_credor_atual), 2) AS media_credito,\\r\\n    ROUND(AVG(score_risco_combinado_60m), 2) AS media_score_combinado_60m,\\r\\n    ROUND(AVG(score_risco_combinado_12m), 2) AS media_score_combinado_12m,\\r\\n    COUNT(CASE WHEN saldo_credor_atual > 500000 THEN 1 END) AS qtde_alto_valor,\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_periodos_iguais_60m\\r\\nFROM alertas_calc\\r\\nWHERE qtde_alertas >= 2\\r\\nGROUP BY qtde_alertas\\r\\nORDER BY qtde_alertas DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 3: TOP EMPRESAS - RANKINGS COM ENRIQUECIMENTO\\r\\n-- =============================================================================\\r\\n\\r\\n-- 3.1 TOP 100 POR SCORE COMBINADO 60M (ATUALIZADO)\\r\\nSELECT\\r\\n    'TOP 100 POR SCORE COMBINADO 60M' AS categoria,\\r\\n    ROW_NUMBER() OVER (ORDER BY score_risco_combinado_60m DESC, saldo_credor_atual DESC) AS ranking,\\r\\n    \\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    nm_fantasia,\\r\\n    de_cnae,\\r\\n    nm_gerfe,\\r\\n    \\r\\n    -- Scores Temporais\\r\\n    score_risco_12m,\\r\\n    score_risco_60m,\\r\\n    score_risco_combinado_12m,\\r\\n    score_risco_combinado_60m,\\r\\n    (score_risco_combinado_60m - score_risco_60m) AS pontos_enriquecimento_60m,\\r\\n    score_suspeita,\\r\\n    \\r\\n    -- Cr\\u00e9dito\\r\\n    saldo_credor_atual,\\r\\n    valor_igual_total_periodos_60m,\\r\\n    valor_igual_total_periodos_12m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    crescimento_saldo_percentual_60m,\\r\\n    crescimento_saldo_percentual_12m,\\r\\n    \\r\\n    -- Flags de Alerta\\r\\n    flag_empresa_suspeita,\\r\\n    flag_tem_declaracoes_zeradas,\\r\\n    flag_tem_omissoes,\\r\\n    qtde_indicios_fraude,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    \\r\\n    -- Complementar\\r\\n    cd_situacao_suspeita,\\r\\n    vl_credito_presumido_60m,\\r\\n    vl_credito_presumido_12m,\\r\\n    \\r\\n    -- Meses\\r\\n    qtde_meses_declarados_60m,\\r\\n    qtde_meses_declarados_12m\\r\\nFROM teste.credito_dime_completo\\r\\nORDER BY score_risco_combinado_60m DESC, saldo_credor_atual DESC\\r\\nLIMIT 100;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 3.2 EMPRESAS CR\\u00cdTICAS SEM MOVIMENTA\\u00c7\\u00c3O FISCAL (ATUALIZADO)\\r\\nSELECT\\r\\n    'CR\\u00cdTICAS SEM MOVIMENTA\\u00c7\\u00c3O' AS categoria,\\r\\n    ROW_NUMBER() OVER (ORDER BY cd.score_risco_combinado_60m DESC) AS ranking,\\r\\n    \\r\\n    cd.nu_cnpj,\\r\\n    cd.nm_razao_social,\\r\\n    cd.de_cnae,\\r\\n    cd.nm_gerfe,\\r\\n    cd.saldo_credor_atual,\\r\\n    cd.score_risco_combinado_60m,\\r\\n    cd.score_risco_combinado_12m,\\r\\n    cd.valor_igual_total_periodos_60m,\\r\\n    cd.qtde_ultimos_12m_iguais,\\r\\n    \\r\\n    -- Indicadores de Fraude\\r\\n    cd.flag_empresa_suspeita,\\r\\n    cd.qtde_indicios_fraude,\\r\\n    cd.cd_situacao_suspeita,\\r\\n    cd.sn_cancelado_inex_inativ,\\r\\n    \\r\\n    -- Declara\\u00e7\\u00f5es\\r\\n    cd.total_vl_faturamento AS fat_normal,\\r\\n    cd.total_vl_rec_bruta AS rec_bruta_simples,\\r\\n    cd.nfes_emitidas_normal,\\r\\n    cd.nfes_emitidas_simples,\\r\\n    (cd.periodos_zerados_normal + cd.periodos_zerados_simples) AS total_zerados,\\r\\n    (cd.periodos_omissos_normal + cd.periodos_omissos_simples) AS total_omissos,\\r\\n    \\r\\n    -- Movimenta\\u00e7\\u00e3o Setorial\\r\\n    (COALESCE(txt.vl_entradas_textil, 0) + COALESCE(txt.vl_saidas_textil, 0) +\\r\\n     COALESCE(mm.vl_entradas_metalmec, 0) + COALESCE(mm.vl_saidas_metalmec, 0) +\\r\\n     COALESCE(tech.vl_entradas_tech, 0) + COALESCE(tech.vl_saidas_tech, 0)) AS movto_total_setores\\r\\nFROM teste.credito_dime_completo cd\\r\\nLEFT JOIN teste.credito_dime_textil txt ON cd.nu_cnpj = txt.nu_cnpj\\r\\nLEFT JOIN teste.credito_dime_metalmec mm ON cd.nu_cnpj = mm.nu_cnpj\\r\\nLEFT JOIN teste.credito_dime_tech tech ON cd.nu_cnpj = tech.nu_cnpj\\r\\nWHERE cd.score_risco_combinado_60m >= 85\\r\\nAND cd.saldo_credor_atual > 100000\\r\\nAND (\\r\\n    ((cd.nfes_emitidas_normal + cd.nfes_emitidas_simples) < 10) OR\\r\\n    ((COALESCE(txt.vl_entradas_textil, 0) + COALESCE(txt.vl_saidas_textil, 0) +\\r\\n     COALESCE(mm.vl_entradas_metalmec, 0) + COALESCE(mm.vl_saidas_metalmec, 0) +\\r\\n     COALESCE(tech.vl_entradas_tech, 0) + COALESCE(tech.vl_saidas_tech, 0)) < 10000)\\r\\n)\\r\\nORDER BY cd.score_risco_combinado_60m DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 3.3 EMPRESAS COM ALTO CR\\u00c9DITO E CANCELAMENTO/INEXIST\\u00caNCIA (ATUALIZADO)\\r\\nSELECT\\r\\n    'ALTO CR\\u00c9DITO + CANCELAMENTO' AS categoria,\\r\\n    ROW_NUMBER() OVER (ORDER BY saldo_credor_atual DESC) AS ranking,\\r\\n    \\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    nm_fantasia,\\r\\n    de_cnae,\\r\\n    nm_gerfe,\\r\\n    nm_sit_cadastral,\\r\\n    \\r\\n    saldo_credor_atual,\\r\\n    score_risco_combinado_60m,\\r\\n    score_risco_combinado_12m,\\r\\n    \\r\\n    -- Status de Suspeita\\r\\n    cd_situacao_suspeita,\\r\\n    dt_situacao_suspeita,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    dt_inicio_protoc_cancelamento,\\r\\n    \\r\\n    -- Ind\\u00edcios\\r\\n    qtde_indicios_fraude,\\r\\n    soma_score_indicios,\\r\\n    \\r\\n    -- Comportamento Fiscal\\r\\n    valor_igual_total_periodos_60m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    nfes_emitidas_normal + nfes_emitidas_simples AS total_nfes,\\r\\n    periodos_zerados_normal + periodos_zerados_simples AS total_zerados,\\r\\n    \\r\\n    -- Crescimento\\r\\n    crescimento_saldo_percentual_60m,\\r\\n    crescimento_saldo_percentual_12m,\\r\\n    \\r\\n    -- Observa\\u00e7\\u00f5es\\r\\n    tx_obs_situacao_suspeita\\r\\nFROM teste.credito_dime_completo\\r\\nWHERE sn_cancelado_inex_inativ = 1\\r\\nAND saldo_credor_atual > 50000\\r\\nORDER BY saldo_credor_atual DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 3.4 NOTEIRAS - EMPRESAS COM MUITOS CLIENTES/FORNECEDORES NOTEIROS (ATUALIZADO)\\r\\nSELECT\\r\\n    'EMPRESAS COM NOTEIRAS' AS categoria,\\r\\n    \\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    de_cnae,\\r\\n    nm_gerfe,\\r\\n    saldo_credor_atual,\\r\\n    score_risco_combinado_60m,\\r\\n    score_risco_combinado_12m,\\r\\n    \\r\\n    -- Noteiras\\r\\n    qt_clientes_noteiras,\\r\\n    qt_fornecedoras_noteiras,\\r\\n    (qt_clientes_noteiras + qt_fornecedoras_noteiras) AS total_noteiras,\\r\\n    \\r\\n    -- Movimenta\\u00e7\\u00e3o\\r\\n    vl_nfes_saida_suspeita,\\r\\n    vl_nfes_entrada_suspeita,\\r\\n    \\r\\n    -- Indicadores\\r\\n    flag_empresa_suspeita,\\r\\n    qtde_indicios_fraude,\\r\\n    cd_situacao_suspeita,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    \\r\\n    -- Comportamento\\r\\n    valor_igual_total_periodos_60m,\\r\\n    qtde_ultimos_12m_iguais\\r\\nFROM teste.credito_dime_completo\\r\\nWHERE (qt_clientes_noteiras + qt_fornecedoras_noteiras) >= 5\\r\\nAND saldo_credor_atual > 50000\\r\\nORDER BY (qt_clientes_noteiras + qt_fornecedoras_noteiras) DESC, saldo_credor_atual DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 4: AN\\u00c1LISE DETALHADA - SETOR T\\u00caXTIL COM ENRIQUECIMENTO\\r\\n-- =============================================================================\\r\\n\\r\\n-- 4.1 OVERVIEW SETOR T\\u00caXTIL COM ENRIQUECIMENTO (ATUALIZADO)\\r\\nSELECT\\r\\n    'OVERVIEW T\\u00caXTIL ENRIQUECIDO' AS categoria,\\r\\n    classificacao_risco_combinado_60m,\\r\\n    \\r\\n    -- Quantidades\\r\\n    COUNT(*) AS qtde_empresas,\\r\\n    COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) AS qtde_suspeitas,\\r\\n    COUNT(CASE WHEN qtde_indicios_fraude >= 3 THEN 1 END) AS qtde_3plus_indicios,\\r\\n    \\r\\n    -- Financeiro\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_saldo_credor,\\r\\n    ROUND(AVG(saldo_credor_atual), 2) AS media_saldo_credor,\\r\\n    ROUND(SUM(vl_entradas_textil), 2) AS total_entradas,\\r\\n    ROUND(SUM(vl_saidas_textil), 2) AS total_saidas,\\r\\n    \\r\\n    -- Movimenta\\u00e7\\u00e3o\\r\\n    ROUND(AVG(dias_movimento_textil), 2) AS media_dias_movimento,\\r\\n    COUNT(CASE WHEN vl_saidas_textil = 0 AND vl_entradas_textil > 10000 THEN 1 END) AS qtde_so_compra,\\r\\n    \\r\\n    -- Scores\\r\\n    ROUND(AVG(score_risco_textil_combinado), 2) AS media_score_combinado,\\r\\n    ROUND(AVG(score_suspeita), 2) AS media_score_suspeita,\\r\\n    \\r\\n    -- Comportamento\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_periodos_iguais_60m\\r\\nFROM teste.credito_dime_textil\\r\\nWHERE flag_setor_textil = 1\\r\\nAND vl_entradas_textil > 1000\\r\\nGROUP BY classificacao_risco_combinado_60m\\r\\nORDER BY\\r\\n    CASE classificacao_risco_combinado_60m\\r\\n        WHEN 'CR\\u00cdTICO' THEN 1\\r\\n        WHEN 'ALTO' THEN 2\\r\\n        WHEN 'M\\u00c9DIO' THEN 3\\r\\n        WHEN 'BAIXO' THEN 4\\r\\n    END;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 4.2 TOP 50 T\\u00caXTEIS SUSPEITAS (ATUALIZADO)\\r\\nSELECT\\r\\n    'TOP 50 T\\u00caXTIL SUSPEITAS' AS categoria,\\r\\n    ROW_NUMBER() OVER (ORDER BY score_risco_textil_combinado DESC) AS ranking,\\r\\n    \\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    de_cnae,\\r\\n    nm_gerfe,\\r\\n    \\r\\n    -- Financeiro\\r\\n    saldo_credor_atual,\\r\\n    vl_entradas_textil,\\r\\n    vl_saidas_textil,\\r\\n    indice_entrada_saida_textil,\\r\\n    \\r\\n    -- Scores\\r\\n    score_risco_60m AS score_original_60m,\\r\\n    score_risco_textil_combinado,\\r\\n    score_suspeita,\\r\\n    \\r\\n    -- Indicadores de Fraude\\r\\n    flag_empresa_suspeita,\\r\\n    qtde_indicios_fraude,\\r\\n    cd_situacao_suspeita,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    \\r\\n    -- Comportamento\\r\\n    valor_igual_total_periodos_60m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    dias_movimento_textil,\\r\\n    qtde_ncm_distintos_textil,\\r\\n    \\r\\n    -- Crescimento\\r\\n    crescimento_saldo_percentual_60m,\\r\\n    \\r\\n    -- Padr\\u00e3o\\r\\n    CASE \\r\\n        WHEN vl_saidas_textil = 0 THEN 'SO COMPRA'\\r\\n        WHEN vl_entradas_textil > vl_saidas_textil * 3 THEN 'COMPRA 3X+ VENDE'\\r\\n        WHEN vl_saidas_textil > vl_entradas_textil * 3 THEN 'VENDE 3X+ COMPRA'\\r\\n        ELSE 'EQUILIBRADO'\\r\\n    END AS padrao_movimento\\r\\nFROM teste.credito_dime_textil\\r\\nWHERE flag_setor_textil = 1\\r\\nAND vl_entradas_textil > 10000\\r\\nAND (\\r\\n    flag_empresa_suspeita = 1 OR\\r\\n    score_risco_textil_combinado >= 85 OR\\r\\n    qtde_indicios_fraude >= 3\\r\\n)\\r\\nORDER BY score_risco_textil_combinado DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 5: AN\\u00c1LISE DETALHADA - SETOR METAL-MEC\\u00c2NICO COM ENRIQUECIMENTO\\r\\n-- =============================================================================\\r\\n\\r\\n-- 5.1 TOP 50 METAL-MEC\\u00c2NICO SUSPEITAS (ATUALIZADO)\\r\\nSELECT\\r\\n    'TOP 50 METAL-MEC SUSPEITAS' AS categoria,\\r\\n    ROW_NUMBER() OVER (ORDER BY score_risco_metalmec_combinado DESC) AS ranking,\\r\\n    \\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    de_cnae,\\r\\n    nm_gerfe,\\r\\n    \\r\\n    -- Financeiro\\r\\n    saldo_credor_atual,\\r\\n    vl_entradas_metalmec,\\r\\n    vl_saidas_metalmec,\\r\\n    vl_capitulo_84,\\r\\n    vl_capitulo_85,\\r\\n    perc_cap84,\\r\\n    \\r\\n    -- Scores\\r\\n    score_risco_60m AS score_original_60m,\\r\\n    score_risco_metalmec_combinado,\\r\\n    score_suspeita,\\r\\n    \\r\\n    -- Indicadores de Fraude\\r\\n    flag_empresa_suspeita,\\r\\n    qtde_indicios_fraude,\\r\\n    cd_situacao_suspeita,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    \\r\\n    -- Comportamento\\r\\n    valor_igual_total_periodos_60m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    dias_movimento_metalmec,\\r\\n    qtde_ncm_distintos_metalmec,\\r\\n    \\r\\n    -- Crescimento\\r\\n    crescimento_saldo_percentual_60m\\r\\nFROM teste.credito_dime_metalmec\\r\\nWHERE flag_setor_metalmec = 1\\r\\nAND vl_entradas_metalmec > 10000\\r\\nAND (\\r\\n    flag_empresa_suspeita = 1 OR\\r\\n    score_risco_metalmec_combinado >= 85 OR\\r\\n    qtde_indicios_fraude >= 3\\r\\n)\\r\\nORDER BY score_risco_metalmec_combinado DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 6: AN\\u00c1LISE DETALHADA - SETOR TECNOLOGIA COM ENRIQUECIMENTO\\r\\n-- =============================================================================\\r\\n\\r\\n-- 6.1 TOP 50 TECNOLOGIA SUSPEITAS (ATUALIZADO)\\r\\nSELECT\\r\\n    'TOP 50 TECH SUSPEITAS' AS categoria,\\r\\n    ROW_NUMBER() OVER (ORDER BY score_risco_tech_combinado DESC) AS ranking,\\r\\n    \\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    de_cnae,\\r\\n    nm_gerfe,\\r\\n    \\r\\n    -- Financeiro\\r\\n    saldo_credor_atual,\\r\\n    vl_entradas_tech,\\r\\n    vl_saidas_tech,\\r\\n    vl_computadores,\\r\\n    vl_partes_computadores,\\r\\n    vl_telecom,\\r\\n    \\r\\n    -- Scores\\r\\n    score_risco_60m AS score_original_60m,\\r\\n    score_risco_tech_combinado,\\r\\n    score_suspeita,\\r\\n    \\r\\n    -- Indicadores de Fraude\\r\\n    flag_empresa_suspeita,\\r\\n    qtde_indicios_fraude,\\r\\n    cd_situacao_suspeita,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    \\r\\n    -- Comportamento\\r\\n    valor_igual_total_periodos_60m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    dias_movimento_tech,\\r\\n    qtde_ncm_distintos_tech,\\r\\n    \\r\\n    -- Crescimento\\r\\n    crescimento_saldo_percentual_60m\\r\\nFROM teste.credito_dime_tech\\r\\nWHERE flag_setor_tech = 1\\r\\nAND vl_entradas_tech > 10000\\r\\nAND (\\r\\n    flag_empresa_suspeita = 1 OR\\r\\n    score_risco_tech_combinado >= 85 OR\\r\\n    qtde_indicios_fraude >= 3\\r\\n)\\r\\nORDER BY score_risco_tech_combinado DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 7: AN\\u00c1LISE INDIVIDUAL - FICHA COMPLETA COM ENRIQUECIMENTO\\r\\n-- SUBSTITUA '00000000000000' PELO CNPJ DESEJADO\\r\\n-- =============================================================================\\r\\n\\r\\n-- 7.1 FICHA COMPLETA ENRIQUECIDA (ATUALIZADO)\\r\\nWITH empresa_base AS (\\r\\n    SELECT * FROM teste.credito_dime_completo WHERE nu_cnpj = '00000000000000'\\r\\n),\\r\\nempresa_textil AS (\\r\\n    SELECT * FROM teste.credito_dime_textil WHERE nu_cnpj = '00000000000000'\\r\\n),\\r\\nempresa_metalmec AS (\\r\\n    SELECT * FROM teste.credito_dime_metalmec WHERE nu_cnpj = '00000000000000'\\r\\n),\\r\\nempresa_tech AS (\\r\\n    SELECT * FROM teste.credito_dime_tech WHERE nu_cnpj = '00000000000000'\\r\\n)\\r\\nSELECT\\r\\n    'FICHA COMPLETA EMPRESA' AS categoria,\\r\\n    -- IDENTIFICA\\u00c7\\u00c3O\\r\\n    eb.nu_cnpj,\\r\\n    eb.nm_razao_social,\\r\\n    eb.nm_fantasia,\\r\\n    eb.de_cnae,\\r\\n    eb.nm_gerfe,\\r\\n    eb.nm_sit_cadastral,\\r\\n    \\r\\n    -- RISCO - 12 MESES\\r\\n    eb.score_risco_12m,\\r\\n    eb.score_risco_combinado_12m,\\r\\n    eb.classificacao_risco_12m,\\r\\n    \\r\\n    -- RISCO - 60 MESES\\r\\n    eb.score_risco_60m,\\r\\n    eb.score_risco_combinado_60m,\\r\\n    eb.classificacao_risco_60m,\\r\\n    \\r\\n    -- CR\\u00c9DITO\\r\\n    eb.saldo_credor_atual,\\r\\n    eb.crescimento_saldo_percentual_60m,\\r\\n    eb.crescimento_saldo_percentual_12m,\\r\\n    eb.valor_igual_total_periodos_60m,\\r\\n    eb.valor_igual_total_periodos_12m,\\r\\n    eb.qtde_ultimos_12m_iguais,\\r\\n    eb.vl_credito_presumido_60m,\\r\\n    eb.vl_credito_presumido_12m,\\r\\n    \\r\\n    -- INDICADORES DE FRAUDE\\r\\n    eb.flag_empresa_suspeita,\\r\\n    eb.cd_situacao_suspeita,\\r\\n    eb.score_suspeita,\\r\\n    eb.qtde_indicios_fraude,\\r\\n    eb.soma_score_indicios,\\r\\n    eb.sn_cancelado_inex_inativ,\\r\\n    eb.qt_motivos,\\r\\n    \\r\\n    -- DECLARA\\u00c7\\u00d5ES\\r\\n    eb.flag_tem_pagamentos,\\r\\n    eb.quantidade_pagtos,\\r\\n    eb.valor_pagtos,\\r\\n    eb.flag_tem_declaracoes_zeradas,\\r\\n    eb.flag_tem_omissoes,\\r\\n    eb.periodos_zerados_normal + eb.periodos_zerados_simples AS total_zerados,\\r\\n    eb.periodos_omissos_normal + eb.periodos_omissos_simples AS total_omissos,\\r\\n    eb.nfes_emitidas_normal + eb.nfes_emitidas_simples AS total_nfes,\\r\\n    \\r\\n    -- MESES DECLARADOS\\r\\n    eb.qtde_meses_declarados_60m,\\r\\n    eb.qtde_meses_declarados_12m,\\r\\n    \\r\\n    -- NOTEIRAS\\r\\n    eb.qt_clientes_noteiras,\\r\\n    eb.qt_fornecedoras_noteiras,\\r\\n    eb.sn_suspenso_dfe,\\r\\n    \\r\\n    -- SETORES\\r\\n    CASE WHEN et.flag_setor_textil = 1 THEN 'SIM' ELSE 'NAO' END AS opera_textil,\\r\\n    et.vl_entradas_textil,\\r\\n    et.vl_saidas_textil,\\r\\n    et.score_risco_textil_combinado,\\r\\n    CASE WHEN em.flag_setor_metalmec = 1 THEN 'SIM' ELSE 'NAO' END AS opera_metalmec,\\r\\n    em.vl_entradas_metalmec,\\r\\n    em.vl_saidas_metalmec,\\r\\n    em.score_risco_metalmec_combinado,\\r\\n    CASE WHEN etch.flag_setor_tech = 1 THEN 'SIM' ELSE 'NAO' END AS opera_tech,\\r\\n    etch.vl_entradas_tech,\\r\\n    etch.vl_saidas_tech,\\r\\n    etch.score_risco_tech_combinado,\\r\\n    \\r\\n    -- OBSERVA\\u00c7\\u00d5ES\\r\\n    eb.tx_obs_situacao_suspeita\\r\\nFROM empresa_base eb\\r\\nLEFT JOIN empresa_textil et ON eb.nu_cnpj = et.nu_cnpj\\r\\nLEFT JOIN empresa_metalmec em ON eb.nu_cnpj = em.nu_cnpj\\r\\nLEFT JOIN empresa_tech etch ON eb.nu_cnpj = etch.nu_cnpj;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 8: ALERTAS E MONITORAMENTO COM ENRIQUECIMENTO\\r\\n-- =============================================================================\\r\\n\\r\\n-- 8.1 DASHBOARD EXECUTIVO ENRIQUECIDO (ATUALIZADO)\\r\\nSELECT\\r\\n    'DASHBOARD EXECUTIVO' AS categoria,\\r\\n    \\r\\n    -- M\\u00e9tricas Principais\\r\\n    COUNT(DISTINCT nu_cnpj) AS total_empresas,\\r\\n    \\r\\n    -- Risco Combinado 60M\\r\\n    COUNT(CASE WHEN score_risco_combinado_60m >= 150 THEN 1 END) AS empresas_score_60m_150plus,\\r\\n    COUNT(CASE WHEN score_risco_combinado_60m >= 120 THEN 1 END) AS empresas_score_60m_120plus,\\r\\n    COUNT(CASE WHEN score_risco_combinado_60m >= 85 THEN 1 END) AS empresas_score_60m_85plus,\\r\\n    \\r\\n    -- Risco Combinado 12M\\r\\n    COUNT(CASE WHEN score_risco_combinado_12m >= 100 THEN 1 END) AS empresas_score_12m_100plus,\\r\\n    COUNT(CASE WHEN score_risco_combinado_12m >= 70 THEN 1 END) AS empresas_score_12m_70plus,\\r\\n    \\r\\n    -- Suspeitas e Fraudes\\r\\n    COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) AS empresas_suspeitas,\\r\\n    COUNT(CASE WHEN qtde_indicios_fraude >= 5 THEN 1 END) AS empresas_5plus_indicios,\\r\\n    COUNT(CASE WHEN sn_cancelado_inex_inativ = 1 THEN 1 END) AS empresas_canceladas,\\r\\n    COUNT(CASE WHEN flag_tem_declaracoes_zeradas = 1 THEN 1 END) AS empresas_decl_zeradas,\\r\\n    \\r\\n    -- Percentuais\\r\\n    ROUND(COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) * 100.0 / COUNT(*), 2) AS perc_suspeitas,\\r\\n    ROUND(COUNT(CASE WHEN score_risco_combinado_60m >= 120 THEN 1 END) * 100.0 / COUNT(*), 2) AS perc_score_60m_120plus,\\r\\n    \\r\\n    -- Financeiro\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS receita_total_monitorada,\\r\\n    ROUND(SUM(CASE WHEN flag_empresa_suspeita = 1 THEN saldo_credor_atual ELSE 0 END), 2) AS receita_empresas_suspeitas,\\r\\n    \\r\\n    -- Alertas Comportamentais\\r\\n    COUNT(CASE WHEN qtde_ultimos_12m_iguais >= 12 THEN 1 END) AS alertas_congelamento_12m,\\r\\n    COUNT(CASE WHEN valor_igual_total_periodos_60m >= 48 THEN 1 END) AS alertas_congelamento_60m,\\r\\n    COUNT(CASE WHEN crescimento_saldo_percentual_60m > 500 THEN 1 END) AS alertas_crescimento_explosivo,\\r\\n    COUNT(CASE WHEN (qt_clientes_noteiras + qt_fornecedoras_noteiras) >= 10 THEN 1 END) AS alertas_muitas_noteiras,\\r\\n    \\r\\n    -- Timestamp\\r\\n    CURRENT_TIMESTAMP() AS data_atualizacao\\r\\nFROM teste.credito_dime_completo;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 8.2 ALERTAS AUTOM\\u00c1TICOS PRIORIT\\u00c1RIOS ENRIQUECIDOS (ATUALIZADO)\\r\\nSELECT\\r\\n    'ALERTAS AUTOM\\u00c1TICOS' AS categoria,\\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    nm_gerfe,\\r\\n    score_risco_combinado_60m,\\r\\n    score_risco_combinado_12m,\\r\\n    saldo_credor_atual,\\r\\n    \\r\\n    -- Tipo de Alerta (Priorizado)\\r\\n    CASE \\r\\n        WHEN sn_cancelado_inex_inativ = 1 AND saldo_credor_atual > 100000\\r\\n            THEN 'CR\\u00cdTICO: Cancelada/Inexistente com Alto Cr\\u00e9dito'\\r\\n        \\r\\n        WHEN flag_empresa_suspeita = 1 AND qtde_indicios_fraude >= 15\\r\\n            THEN 'CR\\u00cdTICO: Suspeita com 15+ Ind\\u00edcios de Fraude'\\r\\n        \\r\\n        WHEN score_risco_combinado_60m >= 150\\r\\n            THEN 'CR\\u00cdTICO: Score Combinado 60M >= 150 (Extremo)'\\r\\n        \\r\\n        WHEN qtde_indicios_fraude >= 10 AND saldo_credor_atual > 500000\\r\\n            THEN 'CR\\u00cdTICO: 10+ Ind\\u00edcios + Alto Cr\\u00e9dito'\\r\\n        \\r\\n        WHEN flag_empresa_suspeita = 1 AND flag_tem_declaracoes_zeradas = 1 AND flag_tem_omissoes = 1\\r\\n            THEN 'ALTO: Suspeita + Zeradas + Omiss\\u00f5es'\\r\\n        \\r\\n        WHEN score_risco_combinado_60m >= 120\\r\\n            THEN 'ALTO: Score Combinado 60M >= 120'\\r\\n        \\r\\n        WHEN (qt_clientes_noteiras + qt_fornecedoras_noteiras) >= 15\\r\\n            THEN 'ALTO: 15+ Noteiras no Relacionamento'\\r\\n        \\r\\n        WHEN valor_igual_total_periodos_60m >= 48 AND score_suspeita > 80\\r\\n            THEN 'ALTO: Congelado 48m+ + Score Suspeita Alto'\\r\\n        \\r\\n        WHEN qtde_ultimos_12m_iguais >= 12 AND score_risco_combinado_12m >= 100\\r\\n            THEN 'ALTO: \\u00daltimos 12m Congelados + Score 12M Alto'\\r\\n        \\r\\n        ELSE 'M\\u00c9DIO: Monitoramento Cont\\u00ednuo'\\r\\n    END AS tipo_alerta,\\r\\n    \\r\\n    -- Prioridade\\r\\n    CASE \\r\\n        WHEN sn_cancelado_inex_inativ = 1 OR qtde_indicios_fraude >= 15 OR score_risco_combinado_60m >= 150 THEN 1\\r\\n        WHEN flag_empresa_suspeita = 1 AND qtde_indicios_fraude >= 10 THEN 1\\r\\n        WHEN score_risco_combinado_60m >= 120 OR (qt_clientes_noteiras + qt_fornecedoras_noteiras) >= 15 THEN 2\\r\\n        WHEN qtde_indicios_fraude >= 5 OR score_risco_combinado_12m >= 100 THEN 2\\r\\n        ELSE 3\\r\\n    END AS prioridade,\\r\\n    \\r\\n    -- Indicadores Detalhados\\r\\n    flag_empresa_suspeita,\\r\\n    cd_situacao_suspeita,\\r\\n    qtde_indicios_fraude,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    valor_igual_total_periodos_60m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    flag_tem_declaracoes_zeradas,\\r\\n    flag_tem_omissoes,\\r\\n    (qt_clientes_noteiras + qt_fornecedoras_noteiras) AS total_noteiras,\\r\\n    crescimento_saldo_percentual_60m,\\r\\n    crescimento_saldo_percentual_12m\\r\\nFROM teste.credito_dime_completo\\r\\nWHERE (\\r\\n    score_risco_combinado_60m >= 85 OR\\r\\n    score_risco_combinado_12m >= 70 OR\\r\\n    flag_empresa_suspeita = 1 OR\\r\\n    qtde_indicios_fraude >= 3 OR\\r\\n    sn_cancelado_inex_inativ = 1 OR\\r\\n    qtde_ultimos_12m_iguais >= 12 OR\\r\\n    valor_igual_total_periodos_60m >= 36 OR\\r\\n    (qt_clientes_noteiras + qt_fornecedoras_noteiras) >= 10\\r\\n)\\r\\nORDER BY prioridade, score_risco_combinado_60m DESC\\r\\nLIMIT 200;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 8.3 AN\\u00c1LISE DE EVOLU\\u00c7\\u00c3O TEMPORAL - EMPRESAS QUE PIORARAM (NOVO)\\r\\nSELECT\\r\\n    'EMPRESAS COM PIORA RECENTE' AS categoria,\\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    nm_gerfe,\\r\\n    \\r\\n    -- Comparativo de Scores\\r\\n    score_risco_12m,\\r\\n    score_risco_60m,\\r\\n    score_risco_combinado_12m,\\r\\n    score_risco_combinado_60m,\\r\\n    (score_risco_combinado_12m - score_risco_combinado_60m) AS diferenca_scores,\\r\\n    \\r\\n    -- Cr\\u00e9dito\\r\\n    saldo_credor_atual,\\r\\n    crescimento_saldo_percentual_12m,\\r\\n    crescimento_saldo_percentual_60m,\\r\\n    \\r\\n    -- Comportamento\\r\\n    valor_igual_total_periodos_12m,\\r\\n    valor_igual_total_periodos_60m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    \\r\\n    -- Indicadores\\r\\n    flag_empresa_suspeita,\\r\\n    qtde_indicios_fraude,\\r\\n    sn_cancelado_inex_inativ\\r\\nFROM teste.credito_dime_completo\\r\\nWHERE score_risco_combinado_12m > score_risco_combinado_60m + 20\\r\\nAND saldo_credor_atual > 50000\\r\\nORDER BY (score_risco_combinado_12m - score_risco_combinado_60m) DESC\\r\\nLIMIT 50;\", \"statementsList\": [\"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 2.5 EMPRESAS COM M\\u00daLTIPLOS SINAIS DE ALERTA (ATUALIZADO)\\r\\nWITH alertas_calc AS (\\r\\n    SELECT\\r\\n        *,\\r\\n        (CASE WHEN flag_empresa_suspeita = 1 THEN 1 ELSE 0 END +\\r\\n         CASE WHEN flag_tem_declaracoes_zeradas = 1 THEN 1 ELSE 0 END +\\r\\n         CASE WHEN flag_tem_omissoes = 1 THEN 1 ELSE 0 END +\\r\\n         CASE WHEN sn_cancelado_inex_inativ = 1 THEN 1 ELSE 0 END +\\r\\n         CASE WHEN qtde_indicios_fraude >= 5 THEN 1 ELSE 0 END +\\r\\n         CASE WHEN qtde_ultimos_12m_iguais >= 12 THEN 1 ELSE 0 END +\\r\\n         CASE WHEN valor_igual_total_periodos_60m >= 36 THEN 1 ELSE 0 END +\\r\\n         CASE WHEN crescimento_saldo_percentual_60m > 500 THEN 1 ELSE 0 END) AS qtde_alertas\\r\\n    FROM teste.credito_dime_completo\\r\\n    WHERE (\\r\\n        flag_empresa_suspeita = 1 OR\\r\\n        flag_tem_declaracoes_zeradas = 1 OR\\r\\n        flag_tem_omissoes = 1 OR\\r\\n        sn_cancelado_inex_inativ = 1 OR\\r\\n        qtde_indicios_fraude >= 3\\r\\n    )\\r\\n)\\r\\nSELECT\\r\\n    'M\\u00daLTIPLOS SINAIS DE ALERTA' AS categoria,\\r\\n    qtde_alertas,\\r\\n    COUNT(*) AS qtde_empresas,\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_credito,\\r\\n    ROUND(AVG(saldo_credor_atual), 2) AS media_credito,\\r\\n    ROUND(AVG(score_risco_combinado_60m), 2) AS media_score_combinado_60m,\\r\\n    ROUND(AVG(score_risco_combinado_12m), 2) AS media_score_combinado_12m,\\r\\n    COUNT(CASE WHEN saldo_credor_atual > 500000 THEN 1 END) AS qtde_alto_valor,\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_periodos_iguais_60m\\r\\nFROM alertas_calc\\r\\nWHERE qtde_alertas >= 2\\r\\nGROUP BY qtde_alertas\\r\\nORDER BY qtde_alertas DESC;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 3: TOP EMPRESAS - RANKINGS COM ENRIQUECIMENTO\\r\\n-- =============================================================================\\r\\n\\r\\n-- 3.1 TOP 100 POR SCORE COMBINADO 60M (ATUALIZADO)\\r\\nSELECT\\r\\n    'TOP 100 POR SCORE COMBINADO 60M' AS categoria,\\r\\n    ROW_NUMBER() OVER (ORDER BY score_risco_combinado_60m DESC, saldo_credor_atual DESC) AS ranking,\\r\\n    \\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    nm_fantasia,\\r\\n    de_cnae,\\r\\n    nm_gerfe,\\r\\n    \\r\\n    -- Scores Temporais\\r\\n    score_risco_12m,\\r\\n    score_risco_60m,\\r\\n    score_risco_combinado_12m,\\r\\n    score_risco_combinado_60m,\\r\\n    (score_risco_combinado_60m - score_risco_60m) AS pontos_enriquecimento_60m,\\r\\n    score_suspeita,\\r\\n    \\r\\n    -- Cr\\u00e9dito\\r\\n    saldo_credor_atual,\\r\\n    valor_igual_total_periodos_60m,\\r\\n    valor_igual_total_periodos_12m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    crescimento_saldo_percentual_60m,\\r\\n    crescimento_saldo_percentual_12m,\\r\\n    \\r\\n    -- Flags de Alerta\\r\\n    flag_empresa_suspeita,\\r\\n    flag_tem_declaracoes_zeradas,\\r\\n    flag_tem_omissoes,\\r\\n    qtde_indicios_fraude,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    \\r\\n    -- Complementar\\r\\n    cd_situacao_suspeita,\\r\\n    vl_credito_presumido_60m,\\r\\n    vl_credito_presumido_12m,\\r\\n    \\r\\n    -- Meses\\r\\n    qtde_meses_declarados_60m,\\r\\n    qtde_meses_declarados_12m\\r\\nFROM teste.credito_dime_completo\\r\\nORDER BY score_risco_combinado_60m DESC, saldo_credor_atual DESC\\r\\nLIMIT 100;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 3.2 EMPRESAS CR\\u00cdTICAS SEM MOVIMENTA\\u00c7\\u00c3O FISCAL (ATUALIZADO)\\r\\nSELECT\\r\\n    'CR\\u00cdTICAS SEM MOVIMENTA\\u00c7\\u00c3O' AS categoria,\\r\\n    ROW_NUMBER() OVER (ORDER BY cd.score_risco_combinado_60m DESC) AS ranking,\\r\\n    \\r\\n    cd.nu_cnpj,\\r\\n    cd.nm_razao_social,\\r\\n    cd.de_cnae,\\r\\n    cd.nm_gerfe,\\r\\n    cd.saldo_credor_atual,\\r\\n    cd.score_risco_combinado_60m,\\r\\n    cd.score_risco_combinado_12m,\\r\\n    cd.valor_igual_total_periodos_60m,\\r\\n    cd.qtde_ultimos_12m_iguais,\\r\\n    \\r\\n    -- Indicadores de Fraude\\r\\n    cd.flag_empresa_suspeita,\\r\\n    cd.qtde_indicios_fraude,\\r\\n    cd.cd_situacao_suspeita,\\r\\n    cd.sn_cancelado_inex_inativ,\\r\\n    \\r\\n    -- Declara\\u00e7\\u00f5es\\r\\n    cd.total_vl_faturamento AS fat_normal,\\r\\n    cd.total_vl_rec_bruta AS rec_bruta_simples,\\r\\n    cd.nfes_emitidas_normal,\\r\\n    cd.nfes_emitidas_simples,\\r\\n    (cd.periodos_zerados_normal + cd.periodos_zerados_simples) AS total_zerados,\\r\\n    (cd.periodos_omissos_normal + cd.periodos_omissos_simples) AS total_omissos,\\r\\n    \\r\\n    -- Movimenta\\u00e7\\u00e3o Setorial\\r\\n    (COALESCE(txt.vl_entradas_textil, 0) + COALESCE(txt.vl_saidas_textil, 0) +\\r\\n     COALESCE(mm.vl_entradas_metalmec, 0) + COALESCE(mm.vl_saidas_metalmec, 0) +\\r\\n     COALESCE(tech.vl_entradas_tech, 0) + COALESCE(tech.vl_saidas_tech, 0)) AS movto_total_setores\\r\\nFROM teste.credito_dime_completo cd\\r\\nLEFT JOIN teste.credito_dime_textil txt ON cd.nu_cnpj = txt.nu_cnpj\\r\\nLEFT JOIN teste.credito_dime_metalmec mm ON cd.nu_cnpj = mm.nu_cnpj\\r\\nLEFT JOIN teste.credito_dime_tech tech ON cd.nu_cnpj = tech.nu_cnpj\\r\\nWHERE cd.score_risco_combinado_60m >= 85\\r\\nAND cd.saldo_credor_atual > 100000\\r\\nAND (\\r\\n    ((cd.nfes_emitidas_normal + cd.nfes_emitidas_simples) < 10) OR\\r\\n    ((COALESCE(txt.vl_entradas_textil, 0) + COALESCE(txt.vl_saidas_textil, 0) +\\r\\n     COALESCE(mm.vl_entradas_metalmec, 0) + COALESCE(mm.vl_saidas_metalmec, 0) +\\r\\n     COALESCE(tech.vl_entradas_tech, 0) + COALESCE(tech.vl_saidas_tech, 0)) < 10000)\\r\\n)\\r\\nORDER BY cd.score_risco_combinado_60m DESC\\r\\nLIMIT 50;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 3.3 EMPRESAS COM ALTO CR\\u00c9DITO E CANCELAMENTO/INEXIST\\u00caNCIA (ATUALIZADO)\\r\\nSELECT\\r\\n    'ALTO CR\\u00c9DITO + CANCELAMENTO' AS categoria,\\r\\n    ROW_NUMBER() OVER (ORDER BY saldo_credor_atual DESC) AS ranking,\\r\\n    \\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    nm_fantasia,\\r\\n    de_cnae,\\r\\n    nm_gerfe,\\r\\n    nm_sit_cadastral,\\r\\n    \\r\\n    saldo_credor_atual,\\r\\n    score_risco_combinado_60m,\\r\\n    score_risco_combinado_12m,\\r\\n    \\r\\n    -- Status de Suspeita\\r\\n    cd_situacao_suspeita,\\r\\n    dt_situacao_suspeita,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    dt_inicio_protoc_cancelamento,\\r\\n    \\r\\n    -- Ind\\u00edcios\\r\\n    qtde_indicios_fraude,\\r\\n    soma_score_indicios,\\r\\n    \\r\\n    -- Comportamento Fiscal\\r\\n    valor_igual_total_periodos_60m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    nfes_emitidas_normal + nfes_emitidas_simples AS total_nfes,\\r\\n    periodos_zerados_normal + periodos_zerados_simples AS total_zerados,\\r\\n    \\r\\n    -- Crescimento\\r\\n    crescimento_saldo_percentual_60m,\\r\\n    crescimento_saldo_percentual_12m,\\r\\n    \\r\\n    -- Observa\\u00e7\\u00f5es\\r\\n    tx_obs_situacao_suspeita\\r\\nFROM teste.credito_dime_completo\\r\\nWHERE sn_cancelado_inex_inativ = 1\\r\\nAND saldo_credor_atual > 50000\\r\\nORDER BY saldo_credor_atual DESC\\r\\nLIMIT 50;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 3.4 NOTEIRAS - EMPRESAS COM MUITOS CLIENTES/FORNECEDORES NOTEIROS (ATUALIZADO)\\r\\nSELECT\\r\\n    'EMPRESAS COM NOTEIRAS' AS categoria,\\r\\n    \\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    de_cnae,\\r\\n    nm_gerfe,\\r\\n    saldo_credor_atual,\\r\\n    score_risco_combinado_60m,\\r\\n    score_risco_combinado_12m,\\r\\n    \\r\\n    -- Noteiras\\r\\n    qt_clientes_noteiras,\\r\\n    qt_fornecedoras_noteiras,\\r\\n    (qt_clientes_noteiras + qt_fornecedoras_noteiras) AS total_noteiras,\\r\\n    \\r\\n    -- Movimenta\\u00e7\\u00e3o\\r\\n    vl_nfes_saida_suspeita,\\r\\n    vl_nfes_entrada_suspeita,\\r\\n    \\r\\n    -- Indicadores\\r\\n    flag_empresa_suspeita,\\r\\n    qtde_indicios_fraude,\\r\\n    cd_situacao_suspeita,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    \\r\\n    -- Comportamento\\r\\n    valor_igual_total_periodos_60m,\\r\\n    qtde_ultimos_12m_iguais\\r\\nFROM teste.credito_dime_completo\\r\\nWHERE (qt_clientes_noteiras + qt_fornecedoras_noteiras) >= 5\\r\\nAND saldo_credor_atual > 50000\\r\\nORDER BY (qt_clientes_noteiras + qt_fornecedoras_noteiras) DESC, saldo_credor_atual DESC\\r\\nLIMIT 50;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 4: AN\\u00c1LISE DETALHADA - SETOR T\\u00caXTIL COM ENRIQUECIMENTO\\r\\n-- =============================================================================\\r\\n\\r\\n-- 4.1 OVERVIEW SETOR T\\u00caXTIL COM ENRIQUECIMENTO (ATUALIZADO)\\r\\nSELECT\\r\\n    'OVERVIEW T\\u00caXTIL ENRIQUECIDO' AS categoria,\\r\\n    classificacao_risco_combinado_60m,\\r\\n    \\r\\n    -- Quantidades\\r\\n    COUNT(*) AS qtde_empresas,\\r\\n    COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) AS qtde_suspeitas,\\r\\n    COUNT(CASE WHEN qtde_indicios_fraude >= 3 THEN 1 END) AS qtde_3plus_indicios,\\r\\n    \\r\\n    -- Financeiro\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_saldo_credor,\\r\\n    ROUND(AVG(saldo_credor_atual), 2) AS media_saldo_credor,\\r\\n    ROUND(SUM(vl_entradas_textil), 2) AS total_entradas,\\r\\n    ROUND(SUM(vl_saidas_textil), 2) AS total_saidas,\\r\\n    \\r\\n    -- Movimenta\\u00e7\\u00e3o\\r\\n    ROUND(AVG(dias_movimento_textil), 2) AS media_dias_movimento,\\r\\n    COUNT(CASE WHEN vl_saidas_textil = 0 AND vl_entradas_textil > 10000 THEN 1 END) AS qtde_so_compra,\\r\\n    \\r\\n    -- Scores\\r\\n    ROUND(AVG(score_risco_textil_combinado), 2) AS media_score_combinado,\\r\\n    ROUND(AVG(score_suspeita), 2) AS media_score_suspeita,\\r\\n    \\r\\n    -- Comportamento\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_periodos_iguais_60m\\r\\nFROM teste.credito_dime_textil\\r\\nWHERE flag_setor_textil = 1\\r\\nAND vl_entradas_textil > 1000\\r\\nGROUP BY classificacao_risco_combinado_60m\\r\\nORDER BY\\r\\n    CASE classificacao_risco_combinado_60m\\r\\n        WHEN 'CR\\u00cdTICO' THEN 1\\r\\n        WHEN 'ALTO' THEN 2\\r\\n        WHEN 'M\\u00c9DIO' THEN 3\\r\\n        WHEN 'BAIXO' THEN 4\\r\\n    END;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 4.2 TOP 50 T\\u00caXTEIS SUSPEITAS (ATUALIZADO)\\r\\nSELECT\\r\\n    'TOP 50 T\\u00caXTIL SUSPEITAS' AS categoria,\\r\\n    ROW_NUMBER() OVER (ORDER BY score_risco_textil_combinado DESC) AS ranking,\\r\\n    \\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    de_cnae,\\r\\n    nm_gerfe,\\r\\n    \\r\\n    -- Financeiro\\r\\n    saldo_credor_atual,\\r\\n    vl_entradas_textil,\\r\\n    vl_saidas_textil,\\r\\n    indice_entrada_saida_textil,\\r\\n    \\r\\n    -- Scores\\r\\n    score_risco_60m AS score_original_60m,\\r\\n    score_risco_textil_combinado,\\r\\n    score_suspeita,\\r\\n    \\r\\n    -- Indicadores de Fraude\\r\\n    flag_empresa_suspeita,\\r\\n    qtde_indicios_fraude,\\r\\n    cd_situacao_suspeita,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    \\r\\n    -- Comportamento\\r\\n    valor_igual_total_periodos_60m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    dias_movimento_textil,\\r\\n    qtde_ncm_distintos_textil,\\r\\n    \\r\\n    -- Crescimento\\r\\n    crescimento_saldo_percentual_60m,\\r\\n    \\r\\n    -- Padr\\u00e3o\\r\\n    CASE \\r\\n        WHEN vl_saidas_textil = 0 THEN 'SO COMPRA'\\r\\n        WHEN vl_entradas_textil > vl_saidas_textil * 3 THEN 'COMPRA 3X+ VENDE'\\r\\n        WHEN vl_saidas_textil > vl_entradas_textil * 3 THEN 'VENDE 3X+ COMPRA'\\r\\n        ELSE 'EQUILIBRADO'\\r\\n    END AS padrao_movimento\\r\\nFROM teste.credito_dime_textil\\r\\nWHERE flag_setor_textil = 1\\r\\nAND vl_entradas_textil > 10000\\r\\nAND (\\r\\n    flag_empresa_suspeita = 1 OR\\r\\n    score_risco_textil_combinado >= 85 OR\\r\\n    qtde_indicios_fraude >= 3\\r\\n)\\r\\nORDER BY score_risco_textil_combinado DESC\\r\\nLIMIT 50;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 5: AN\\u00c1LISE DETALHADA - SETOR METAL-MEC\\u00c2NICO COM ENRIQUECIMENTO\\r\\n-- =============================================================================\\r\\n\\r\\n-- 5.1 TOP 50 METAL-MEC\\u00c2NICO SUSPEITAS (ATUALIZADO)\\r\\nSELECT\\r\\n    'TOP 50 METAL-MEC SUSPEITAS' AS categoria,\\r\\n    ROW_NUMBER() OVER (ORDER BY score_risco_metalmec_combinado DESC) AS ranking,\\r\\n    \\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    de_cnae,\\r\\n    nm_gerfe,\\r\\n    \\r\\n    -- Financeiro\\r\\n    saldo_credor_atual,\\r\\n    vl_entradas_metalmec,\\r\\n    vl_saidas_metalmec,\\r\\n    vl_capitulo_84,\\r\\n    vl_capitulo_85,\\r\\n    perc_cap84,\\r\\n    \\r\\n    -- Scores\\r\\n    score_risco_60m AS score_original_60m,\\r\\n    score_risco_metalmec_combinado,\\r\\n    score_suspeita,\\r\\n    \\r\\n    -- Indicadores de Fraude\\r\\n    flag_empresa_suspeita,\\r\\n    qtde_indicios_fraude,\\r\\n    cd_situacao_suspeita,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    \\r\\n    -- Comportamento\\r\\n    valor_igual_total_periodos_60m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    dias_movimento_metalmec,\\r\\n    qtde_ncm_distintos_metalmec,\\r\\n    \\r\\n    -- Crescimento\\r\\n    crescimento_saldo_percentual_60m\\r\\nFROM teste.credito_dime_metalmec\\r\\nWHERE flag_setor_metalmec = 1\\r\\nAND vl_entradas_metalmec > 10000\\r\\nAND (\\r\\n    flag_empresa_suspeita = 1 OR\\r\\n    score_risco_metalmec_combinado >= 85 OR\\r\\n    qtde_indicios_fraude >= 3\\r\\n)\\r\\nORDER BY score_risco_metalmec_combinado DESC\\r\\nLIMIT 50;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 6: AN\\u00c1LISE DETALHADA - SETOR TECNOLOGIA COM ENRIQUECIMENTO\\r\\n-- =============================================================================\\r\\n\\r\\n-- 6.1 TOP 50 TECNOLOGIA SUSPEITAS (ATUALIZADO)\\r\\nSELECT\\r\\n    'TOP 50 TECH SUSPEITAS' AS categoria,\\r\\n    ROW_NUMBER() OVER (ORDER BY score_risco_tech_combinado DESC) AS ranking,\\r\\n    \\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    de_cnae,\\r\\n    nm_gerfe,\\r\\n    \\r\\n    -- Financeiro\\r\\n    saldo_credor_atual,\\r\\n    vl_entradas_tech,\\r\\n    vl_saidas_tech,\\r\\n    vl_computadores,\\r\\n    vl_partes_computadores,\\r\\n    vl_telecom,\\r\\n    \\r\\n    -- Scores\\r\\n    score_risco_60m AS score_original_60m,\\r\\n    score_risco_tech_combinado,\\r\\n    score_suspeita,\\r\\n    \\r\\n    -- Indicadores de Fraude\\r\\n    flag_empresa_suspeita,\\r\\n    qtde_indicios_fraude,\\r\\n    cd_situacao_suspeita,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    \\r\\n    -- Comportamento\\r\\n    valor_igual_total_periodos_60m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    dias_movimento_tech,\\r\\n    qtde_ncm_distintos_tech,\\r\\n    \\r\\n    -- Crescimento\\r\\n    crescimento_saldo_percentual_60m\\r\\nFROM teste.credito_dime_tech\\r\\nWHERE flag_setor_tech = 1\\r\\nAND vl_entradas_tech > 10000\\r\\nAND (\\r\\n    flag_empresa_suspeita = 1 OR\\r\\n    score_risco_tech_combinado >= 85 OR\\r\\n    qtde_indicios_fraude >= 3\\r\\n)\\r\\nORDER BY score_risco_tech_combinado DESC\\r\\nLIMIT 50;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 7: AN\\u00c1LISE INDIVIDUAL - FICHA COMPLETA COM ENRIQUECIMENTO\\r\\n-- SUBSTITUA '00000000000000' PELO CNPJ DESEJADO\\r\\n-- =============================================================================\\r\\n\\r\\n-- 7.1 FICHA COMPLETA ENRIQUECIDA (ATUALIZADO)\\r\\nWITH empresa_base AS (\\r\\n    SELECT * FROM teste.credito_dime_completo WHERE nu_cnpj = '00000000000000'\\r\\n),\\r\\nempresa_textil AS (\\r\\n    SELECT * FROM teste.credito_dime_textil WHERE nu_cnpj = '00000000000000'\\r\\n),\\r\\nempresa_metalmec AS (\\r\\n    SELECT * FROM teste.credito_dime_metalmec WHERE nu_cnpj = '00000000000000'\\r\\n),\\r\\nempresa_tech AS (\\r\\n    SELECT * FROM teste.credito_dime_tech WHERE nu_cnpj = '00000000000000'\\r\\n)\\r\\nSELECT\\r\\n    'FICHA COMPLETA EMPRESA' AS categoria,\\r\\n    -- IDENTIFICA\\u00c7\\u00c3O\\r\\n    eb.nu_cnpj,\\r\\n    eb.nm_razao_social,\\r\\n    eb.nm_fantasia,\\r\\n    eb.de_cnae,\\r\\n    eb.nm_gerfe,\\r\\n    eb.nm_sit_cadastral,\\r\\n    \\r\\n    -- RISCO - 12 MESES\\r\\n    eb.score_risco_12m,\\r\\n    eb.score_risco_combinado_12m,\\r\\n    eb.classificacao_risco_12m,\\r\\n    \\r\\n    -- RISCO - 60 MESES\\r\\n    eb.score_risco_60m,\\r\\n    eb.score_risco_combinado_60m,\\r\\n    eb.classificacao_risco_60m,\\r\\n    \\r\\n    -- CR\\u00c9DITO\\r\\n    eb.saldo_credor_atual,\\r\\n    eb.crescimento_saldo_percentual_60m,\\r\\n    eb.crescimento_saldo_percentual_12m,\\r\\n    eb.valor_igual_total_periodos_60m,\\r\\n    eb.valor_igual_total_periodos_12m,\\r\\n    eb.qtde_ultimos_12m_iguais,\\r\\n    eb.vl_credito_presumido_60m,\\r\\n    eb.vl_credito_presumido_12m,\\r\\n    \\r\\n    -- INDICADORES DE FRAUDE\\r\\n    eb.flag_empresa_suspeita,\\r\\n    eb.cd_situacao_suspeita,\\r\\n    eb.score_suspeita,\\r\\n    eb.qtde_indicios_fraude,\\r\\n    eb.soma_score_indicios,\\r\\n    eb.sn_cancelado_inex_inativ,\\r\\n    eb.qt_motivos,\\r\\n    \\r\\n    -- DECLARA\\u00c7\\u00d5ES\\r\\n    eb.flag_tem_pagamentos,\\r\\n    eb.quantidade_pagtos,\\r\\n    eb.valor_pagtos,\\r\\n    eb.flag_tem_declaracoes_zeradas,\\r\\n    eb.flag_tem_omissoes,\\r\\n    eb.periodos_zerados_normal + eb.periodos_zerados_simples AS total_zerados,\\r\\n    eb.periodos_omissos_normal + eb.periodos_omissos_simples AS total_omissos,\\r\\n    eb.nfes_emitidas_normal + eb.nfes_emitidas_simples AS total_nfes,\\r\\n    \\r\\n    -- MESES DECLARADOS\\r\\n    eb.qtde_meses_declarados_60m,\\r\\n    eb.qtde_meses_declarados_12m,\\r\\n    \\r\\n    -- NOTEIRAS\\r\\n    eb.qt_clientes_noteiras,\\r\\n    eb.qt_fornecedoras_noteiras,\\r\\n    eb.sn_suspenso_dfe,\\r\\n    \\r\\n    -- SETORES\\r\\n    CASE WHEN et.flag_setor_textil = 1 THEN 'SIM' ELSE 'NAO' END AS opera_textil,\\r\\n    et.vl_entradas_textil,\\r\\n    et.vl_saidas_textil,\\r\\n    et.score_risco_textil_combinado,\\r\\n    CASE WHEN em.flag_setor_metalmec = 1 THEN 'SIM' ELSE 'NAO' END AS opera_metalmec,\\r\\n    em.vl_entradas_metalmec,\\r\\n    em.vl_saidas_metalmec,\\r\\n    em.score_risco_metalmec_combinado,\\r\\n    CASE WHEN etch.flag_setor_tech = 1 THEN 'SIM' ELSE 'NAO' END AS opera_tech,\\r\\n    etch.vl_entradas_tech,\\r\\n    etch.vl_saidas_tech,\\r\\n    etch.score_risco_tech_combinado,\\r\\n    \\r\\n    -- OBSERVA\\u00c7\\u00d5ES\\r\\n    eb.tx_obs_situacao_suspeita\\r\\nFROM empresa_base eb\\r\\nLEFT JOIN empresa_textil et ON eb.nu_cnpj = et.nu_cnpj\\r\\nLEFT JOIN empresa_metalmec em ON eb.nu_cnpj = em.nu_cnpj\\r\\nLEFT JOIN empresa_tech etch ON eb.nu_cnpj = etch.nu_cnpj;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 8: ALERTAS E MONITORAMENTO COM ENRIQUECIMENTO\\r\\n-- =============================================================================\\r\\n\\r\\n-- 8.1 DASHBOARD EXECUTIVO ENRIQUECIDO (ATUALIZADO)\\r\\nSELECT\\r\\n    'DASHBOARD EXECUTIVO' AS categoria,\\r\\n    \\r\\n    -- M\\u00e9tricas Principais\\r\\n    COUNT(DISTINCT nu_cnpj) AS total_empresas,\\r\\n    \\r\\n    -- Risco Combinado 60M\\r\\n    COUNT(CASE WHEN score_risco_combinado_60m >= 150 THEN 1 END) AS empresas_score_60m_150plus,\\r\\n    COUNT(CASE WHEN score_risco_combinado_60m >= 120 THEN 1 END) AS empresas_score_60m_120plus,\\r\\n    COUNT(CASE WHEN score_risco_combinado_60m >= 85 THEN 1 END) AS empresas_score_60m_85plus,\\r\\n    \\r\\n    -- Risco Combinado 12M\\r\\n    COUNT(CASE WHEN score_risco_combinado_12m >= 100 THEN 1 END) AS empresas_score_12m_100plus,\\r\\n    COUNT(CASE WHEN score_risco_combinado_12m >= 70 THEN 1 END) AS empresas_score_12m_70plus,\\r\\n    \\r\\n    -- Suspeitas e Fraudes\\r\\n    COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) AS empresas_suspeitas,\\r\\n    COUNT(CASE WHEN qtde_indicios_fraude >= 5 THEN 1 END) AS empresas_5plus_indicios,\\r\\n    COUNT(CASE WHEN sn_cancelado_inex_inativ = 1 THEN 1 END) AS empresas_canceladas,\\r\\n    COUNT(CASE WHEN flag_tem_declaracoes_zeradas = 1 THEN 1 END) AS empresas_decl_zeradas,\\r\\n    \\r\\n    -- Percentuais\\r\\n    ROUND(COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) * 100.0 / COUNT(*), 2) AS perc_suspeitas,\\r\\n    ROUND(COUNT(CASE WHEN score_risco_combinado_60m >= 120 THEN 1 END) * 100.0 / COUNT(*), 2) AS perc_score_60m_120plus,\\r\\n    \\r\\n    -- Financeiro\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS receita_total_monitorada,\\r\\n    ROUND(SUM(CASE WHEN flag_empresa_suspeita = 1 THEN saldo_credor_atual ELSE 0 END), 2) AS receita_empresas_suspeitas,\\r\\n    \\r\\n    -- Alertas Comportamentais\\r\\n    COUNT(CASE WHEN qtde_ultimos_12m_iguais >= 12 THEN 1 END) AS alertas_congelamento_12m,\\r\\n    COUNT(CASE WHEN valor_igual_total_periodos_60m >= 48 THEN 1 END) AS alertas_congelamento_60m,\\r\\n    COUNT(CASE WHEN crescimento_saldo_percentual_60m > 500 THEN 1 END) AS alertas_crescimento_explosivo,\\r\\n    COUNT(CASE WHEN (qt_clientes_noteiras + qt_fornecedoras_noteiras) >= 10 THEN 1 END) AS alertas_muitas_noteiras,\\r\\n    \\r\\n    -- Timestamp\\r\\n    CURRENT_TIMESTAMP() AS data_atualizacao\\r\\nFROM teste.credito_dime_completo;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 8.2 ALERTAS AUTOM\\u00c1TICOS PRIORIT\\u00c1RIOS ENRIQUECIDOS (ATUALIZADO)\\r\\nSELECT\\r\\n    'ALERTAS AUTOM\\u00c1TICOS' AS categoria,\\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    nm_gerfe,\\r\\n    score_risco_combinado_60m,\\r\\n    score_risco_combinado_12m,\\r\\n    saldo_credor_atual,\\r\\n    \\r\\n    -- Tipo de Alerta (Priorizado)\\r\\n    CASE \\r\\n        WHEN sn_cancelado_inex_inativ = 1 AND saldo_credor_atual > 100000\\r\\n            THEN 'CR\\u00cdTICO: Cancelada/Inexistente com Alto Cr\\u00e9dito'\\r\\n        \\r\\n        WHEN flag_empresa_suspeita = 1 AND qtde_indicios_fraude >= 15\\r\\n            THEN 'CR\\u00cdTICO: Suspeita com 15+ Ind\\u00edcios de Fraude'\\r\\n        \\r\\n        WHEN score_risco_combinado_60m >= 150\\r\\n            THEN 'CR\\u00cdTICO: Score Combinado 60M >= 150 (Extremo)'\\r\\n        \\r\\n        WHEN qtde_indicios_fraude >= 10 AND saldo_credor_atual > 500000\\r\\n            THEN 'CR\\u00cdTICO: 10+ Ind\\u00edcios + Alto Cr\\u00e9dito'\\r\\n        \\r\\n        WHEN flag_empresa_suspeita = 1 AND flag_tem_declaracoes_zeradas = 1 AND flag_tem_omissoes = 1\\r\\n            THEN 'ALTO: Suspeita + Zeradas + Omiss\\u00f5es'\\r\\n        \\r\\n        WHEN score_risco_combinado_60m >= 120\\r\\n            THEN 'ALTO: Score Combinado 60M >= 120'\\r\\n        \\r\\n        WHEN (qt_clientes_noteiras + qt_fornecedoras_noteiras) >= 15\\r\\n            THEN 'ALTO: 15+ Noteiras no Relacionamento'\\r\\n        \\r\\n        WHEN valor_igual_total_periodos_60m >= 48 AND score_suspeita > 80\\r\\n            THEN 'ALTO: Congelado 48m+ + Score Suspeita Alto'\\r\\n        \\r\\n        WHEN qtde_ultimos_12m_iguais >= 12 AND score_risco_combinado_12m >= 100\\r\\n            THEN 'ALTO: \\u00daltimos 12m Congelados + Score 12M Alto'\\r\\n        \\r\\n        ELSE 'M\\u00c9DIO: Monitoramento Cont\\u00ednuo'\\r\\n    END AS tipo_alerta,\\r\\n    \\r\\n    -- Prioridade\\r\\n    CASE \\r\\n        WHEN sn_cancelado_inex_inativ = 1 OR qtde_indicios_fraude >= 15 OR score_risco_combinado_60m >= 150 THEN 1\\r\\n        WHEN flag_empresa_suspeita = 1 AND qtde_indicios_fraude >= 10 THEN 1\\r\\n        WHEN score_risco_combinado_60m >= 120 OR (qt_clientes_noteiras + qt_fornecedoras_noteiras) >= 15 THEN 2\\r\\n        WHEN qtde_indicios_fraude >= 5 OR score_risco_combinado_12m >= 100 THEN 2\\r\\n        ELSE 3\\r\\n    END AS prioridade,\\r\\n    \\r\\n    -- Indicadores Detalhados\\r\\n    flag_empresa_suspeita,\\r\\n    cd_situacao_suspeita,\\r\\n    qtde_indicios_fraude,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    valor_igual_total_periodos_60m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    flag_tem_declaracoes_zeradas,\\r\\n    flag_tem_omissoes,\\r\\n    (qt_clientes_noteiras + qt_fornecedoras_noteiras) AS total_noteiras,\\r\\n    crescimento_saldo_percentual_60m,\\r\\n    crescimento_saldo_percentual_12m\\r\\nFROM teste.credito_dime_completo\\r\\nWHERE (\\r\\n    score_risco_combinado_60m >= 85 OR\\r\\n    score_risco_combinado_12m >= 70 OR\\r\\n    flag_empresa_suspeita = 1 OR\\r\\n    qtde_indicios_fraude >= 3 OR\\r\\n    sn_cancelado_inex_inativ = 1 OR\\r\\n    qtde_ultimos_12m_iguais >= 12 OR\\r\\n    valor_igual_total_periodos_60m >= 36 OR\\r\\n    (qt_clientes_noteiras + qt_fornecedoras_noteiras) >= 10\\r\\n)\\r\\nORDER BY prioridade, score_risco_combinado_60m DESC\\r\\nLIMIT 200;\", \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 8.3 AN\\u00c1LISE DE EVOLU\\u00c7\\u00c3O TEMPORAL - EMPRESAS QUE PIORARAM (NOVO)\\r\\nSELECT\\r\\n    'EMPRESAS COM PIORA RECENTE' AS categoria,\\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    nm_gerfe,\\r\\n    \\r\\n    -- Comparativo de Scores\\r\\n    score_risco_12m,\\r\\n    score_risco_60m,\\r\\n    score_risco_combinado_12m,\\r\\n    score_risco_combinado_60m,\\r\\n    (score_risco_combinado_12m - score_risco_combinado_60m) AS diferenca_scores,\\r\\n    \\r\\n    -- Cr\\u00e9dito\\r\\n    saldo_credor_atual,\\r\\n    crescimento_saldo_percentual_12m,\\r\\n    crescimento_saldo_percentual_60m,\\r\\n    \\r\\n    -- Comportamento\\r\\n    valor_igual_total_periodos_12m,\\r\\n    valor_igual_total_periodos_60m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    \\r\\n    -- Indicadores\\r\\n    flag_empresa_suspeita,\\r\\n    qtde_indicios_fraude,\\r\\n    sn_cancelado_inex_inativ\\r\\nFROM teste.credito_dime_completo\\r\\nWHERE score_risco_combinado_12m > score_risco_combinado_60m + 20\\r\\nAND saldo_credor_atual > 50000\\r\\nORDER BY (score_risco_combinado_12m - score_risco_combinado_60m) DESC\\r\\nLIMIT 50;\"], \"aceSize\": 100, \"status\": \"failed\", \"statusForButtons\": \"executed\", \"properties\": {\"settings\": []}, \"viewSettings\": {\"placeHolder\": \"Exemplo: SELECT * FROM tablename ou pressione CTRL + espa\\u00e7o\", \"sqlDialect\": true}, \"variables\": [], \"hasCurlyBracketParameters\": true, \"variableNames\": [], \"variableValues\": {}, \"statement\": \"\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 8: ALERTAS E MONITORAMENTO COM ENRIQUECIMENTO\\r\\n-- =============================================================================\\r\\n\\r\\n-- 8.1 DASHBOARD EXECUTIVO ENRIQUECIDO (ATUALIZADO)\\r\\nSELECT\\r\\n    'DASHBOARD EXECUTIVO' AS categoria,\\r\\n    \\r\\n    -- M\\u00e9tricas Principais\\r\\n    COUNT(DISTINCT nu_cnpj) AS total_empresas,\\r\\n    \\r\\n    -- Risco Combinado 60M\\r\\n    COUNT(CASE WHEN score_risco_combinado_60m >= 150 THEN 1 END) AS empresas_score_60m_150plus,\\r\\n    COUNT(CASE WHEN score_risco_combinado_60m >= 120 THEN 1 END) AS empresas_score_60m_120plus,\\r\\n    COUNT(CASE WHEN score_risco_combinado_60m >= 85 THEN 1 END) AS empresas_score_60m_85plus,\\r\\n    \\r\\n    -- Risco Combinado 12M\\r\\n    COUNT(CASE WHEN score_risco_combinado_12m >= 100 THEN 1 END) AS empresas_score_12m_100plus,\\r\\n    COUNT(CASE WHEN score_risco_combinado_12m >= 70 THEN 1 END) AS empresas_score_12m_70plus,\\r\\n    \\r\\n    -- Suspeitas e Fraudes\\r\\n    COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) AS empresas_suspeitas,\\r\\n    COUNT(CASE WHEN qtde_indicios_fraude >= 5 THEN 1 END) AS empresas_5plus_indicios,\\r\\n    COUNT(CASE WHEN sn_cancelado_inex_inativ = 1 THEN 1 END) AS empresas_canceladas,\\r\\n    COUNT(CASE WHEN flag_tem_declaracoes_zeradas = 1 THEN 1 END) AS empresas_decl_zeradas,\\r\\n    \\r\\n    -- Percentuais\\r\\n    ROUND(COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) * 100.0 / COUNT(*), 2) AS perc_suspeitas,\\r\\n    ROUND(COUNT(CASE WHEN score_risco_combinado_60m >= 120 THEN 1 END) * 100.0 / COUNT(*), 2) AS perc_score_60m_120plus,\\r\\n    \\r\\n    -- Financeiro\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS receita_total_monitorada,\\r\\n    ROUND(SUM(CASE WHEN flag_empresa_suspeita = 1 THEN saldo_credor_atual ELSE 0 END), 2) AS receita_empresas_suspeitas,\\r\\n    \\r\\n    -- Alertas Comportamentais\\r\\n    COUNT(CASE WHEN qtde_ultimos_12m_iguais >= 12 THEN 1 END) AS alertas_congelamento_12m,\\r\\n    COUNT(CASE WHEN valor_igual_total_periodos_60m >= 48 THEN 1 END) AS alertas_congelamento_60m,\\r\\n    COUNT(CASE WHEN crescimento_saldo_percentual_60m > 500 THEN 1 END) AS alertas_crescimento_explosivo,\\r\\n    COUNT(CASE WHEN (qt_clientes_noteiras + qt_fornecedoras_noteiras) >= 10 THEN 1 END) AS alertas_muitas_noteiras,\\r\\n    \\r\\n    -- Timestamp\\r\\n    CURRENT_TIMESTAMP() AS data_atualizacao\\r\\nFROM teste.credito_dime_completo;\", \"result\": {\"id\": \"b27b6667-eb6e-bdc0-d44e-d16e3c8b5672\", \"type\": \"table\", \"hasResultset\": true, \"handle\": {\"has_more_statements\": true, \"statement_id\": 23, \"statements_count\": 25, \"previous_statement_hash\": \"23490acbf1167982caa90eaf03b52932c1206052b44751da613ce7f1\"}, \"meta\": [], \"rows\": 50, \"hasMore\": false, \"statement_id\": 23, \"statement_range\": {\"start\": {\"row\": 0, \"column\": 0}, \"end\": {\"row\": 0, \"column\": 0}}, \"statements_count\": 25, \"metaFilter\": {\"query\": \"\", \"facets\": {}, \"text\": []}, \"isMetaFilterVisible\": false, \"filteredMetaChecked\": true, \"filteredColumnCount\": -1, \"filteredMeta\": [], \"fetchedOnce\": false, \"startTime\": \"2025-10-30T20:48:58.927Z\", \"endTime\": \"2025-10-30T20:48:58.927Z\", \"executionTime\": 0, \"data\": [], \"explanation\": \"\", \"logs\": \"\", \"logLines\": 0, \"hasSomeResults\": false}, \"showGrid\": true, \"showChart\": false, \"showLogs\": true, \"progress\": 0, \"jobs\": [], \"executeNextTimeout\": 52719, \"isLoading\": false, \"resultsKlass\": \"results impala\", \"errorsKlass\": \"results impala alert alert-error\", \"is_redacted\": false, \"chartType\": \"bars\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null, \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartLimits\": [5, 10, 25, 50, 100], \"chartLimit\": null, \"chartX\": null, \"chartXPivot\": null, \"chartYSingle\": null, \"chartYMulti\": [], \"chartData\": [], \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"hideStacked\": true, \"hasDataForChart\": false, \"previousChartOptions\": {\"chartLimit\": null, \"chartX\": \"categoria\", \"chartXPivot\": null, \"chartYSingle\": null, \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"chartYMulti\": [\"score_risco_combinado_12m\"], \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null}, \"isResultSettingsVisible\": false, \"settingsVisible\": false, \"checkStatusTimeout\": null, \"getLogsTimeout\": null, \"topRisk\": null, \"suggestion\": \"\", \"hasSuggestion\": null, \"compatibilityCheckRunning\": false, \"compatibilitySourcePlatforms\": [{\"name\": \"Teradata\", \"value\": \"teradata\"}, {\"name\": \"Oracle\", \"value\": \"oracle\"}, {\"name\": \"Netezza\", \"value\": \"netezza\"}, {\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}, {\"name\": \"DB2\", \"value\": \"db2\"}, {\"name\": \"Greenplum\", \"value\": \"greenplum\"}, {\"name\": \"MySQL\", \"value\": \"mysql\"}, {\"name\": \"PostgreSQL\", \"value\": \"postgresql\"}, {\"name\": \"Informix\", \"value\": \"informix\"}, {\"name\": \"SQL Server\", \"value\": \"sqlserver\"}, {\"name\": \"Sybase\", \"value\": \"sybase\"}, {\"name\": \"Access\", \"value\": \"access\"}, {\"name\": \"Firebird\", \"value\": \"firebird\"}, {\"name\": \"ANSISQL\", \"value\": \"ansisql\"}, {\"name\": \"Generic\", \"value\": \"generic\"}], \"compatibilitySourcePlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"compatibilityTargetPlatforms\": [{\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}], \"compatibilityTargetPlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"showSqlAnalyzer\": false, \"wasBatchExecuted\": false, \"isReady\": true, \"lastExecuted\": 1761857338909, \"lastAceSelectionRowOffset\": 0, \"executingBlockingOperation\": null, \"showLongOperationWarning\": false, \"lastExecutedStatements\": \"-- =============================================================================\\r\\n-- AN\\u00c1LISE COMPLETA DE CR\\u00c9DITOS ICMS ACUMULADOS - VERS\\u00c3O 3.0\\r\\n-- Sistema de Consultas com Dados de Enriquecimento (Cancelamento/Suspeitas)\\r\\n-- Atualizado para trabalhar com an\\u00e1lises de 12 e 60 meses\\r\\n-- Execute cada bloco SEPARADAMENTE, pausando entre execu\\u00e7\\u00f5es\\r\\n-- =============================================================================\\r\\n\\r\\n-- CONFIGURA\\u00c7\\u00c3O INICIAL\\r\\nSET REQUEST_POOL = 'medium';\\r\\nSET MEM_LIMIT = 8G;\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 1: VIS\\u00c3O GERAL DO SISTEMA COM ENRIQUECIMENTO\\r\\n-- Execute este bloco primeiro para ter o panorama geral\\r\\n-- =============================================================================\\r\\n\\r\\n-- 1.1 PANORAMA EXECUTIVO GERAL ENRIQUECIDO\\r\\nSELECT\\r\\n    'PANORAMA GERAL - CR\\u00c9DITOS ICMS' AS categoria,\\r\\n    -- M\\u00e9tricas de Volume\\r\\n    COUNT(DISTINCT nu_cnpj) AS total_empresas_monitoradas,\\r\\n    COUNT(DISTINCT nu_cnpj_grupo) AS total_grupos_economicos,\\r\\n    \\r\\n    -- Distribui\\u00e7\\u00e3o por Risco Original (60 meses)\\r\\n    COUNT(CASE WHEN classificacao_risco_60m = 'CR\\u00cdTICO' THEN 1 END) AS empresas_criticas_60m,\\r\\n    COUNT(CASE WHEN classificacao_risco_60m = 'ALTO' THEN 1 END) AS empresas_alto_risco_60m,\\r\\n    COUNT(CASE WHEN classificacao_risco_12m = 'CR\\u00cdTICO' THEN 1 END) AS empresas_criticas_12m,\\r\\n    COUNT(CASE WHEN classificacao_risco_12m = 'ALTO' THEN 1 END) AS empresas_alto_risco_12m,\\r\\n    \\r\\n    -- Distribui\\u00e7\\u00e3o por Score Combinado (com enriquecimento)\\r\\n    COUNT(CASE WHEN score_risco_combinado_60m >= 120 THEN 1 END) AS empresas_score_60m_120plus,\\r\\n    COUNT(CASE WHEN score_risco_combinado_60m >= 100 THEN 1 END) AS empresas_score_60m_100plus,\\r\\n    COUNT(CASE WHEN score_risco_combinado_12m >= 100 THEN 1 END) AS empresas_score_12m_100plus,\\r\\n    \\r\\n    -- Empresas com Indicadores de Fraude\\r\\n    COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) AS empresas_suspeitas,\\r\\n    COUNT(CASE WHEN flag_tem_declaracoes_zeradas = 1 THEN 1 END) AS empresas_com_decl_zeradas,\\r\\n    COUNT(CASE WHEN flag_tem_omissoes = 1 THEN 1 END) AS empresas_com_omissoes,\\r\\n    COUNT(CASE WHEN sn_cancelado_inex_inativ = 1 THEN 1 END) AS empresas_canceladas_inex_inativ,\\r\\n    COUNT(CASE WHEN qtde_indicios_fraude >= 3 THEN 1 END) AS empresas_3plus_indicios,\\r\\n    \\r\\n    -- Percentuais Cr\\u00edticos\\r\\n    ROUND(COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) * 100.0 / COUNT(*), 2) AS perc_suspeitas,\\r\\n    ROUND(COUNT(CASE WHEN score_risco_combinado_60m >= 120 THEN 1 END) * 100.0 / COUNT(*), 2) AS perc_score_60m_120plus,\\r\\n    \\r\\n    -- M\\u00e9tricas Financeiras\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_credito_acumulado,\\r\\n    ROUND(SUM(CASE WHEN flag_empresa_suspeita = 1 THEN saldo_credor_atual ELSE 0 END), 2) AS credito_empresas_suspeitas,\\r\\n    ROUND(SUM(CASE WHEN score_risco_combinado_60m >= 120 THEN saldo_credor_atual ELSE 0 END), 2) AS credito_score_120plus,\\r\\n    \\r\\n    -- Pagamentos\\r\\n    COUNT(CASE WHEN flag_tem_pagamentos = 1 THEN 1 END) AS empresas_com_pagamentos,\\r\\n    ROUND(SUM(valor_pagtos), 2) AS total_valor_pago,\\r\\n    \\r\\n    -- An\\u00e1lise Temporal\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_periodos_iguais_60m,\\r\\n    ROUND(AVG(valor_igual_total_periodos_12m), 2) AS media_periodos_iguais_12m,\\r\\n    ROUND(AVG(crescimento_saldo_percentual_60m), 2) AS media_crescimento_60m,\\r\\n    ROUND(AVG(crescimento_saldo_percentual_12m), 2) AS media_crescimento_12m,\\r\\n    \\r\\n    -- Data de Atualiza\\u00e7\\u00e3o\\r\\n    CURRENT_TIMESTAMP() AS data_consulta\\r\\nFROM teste.credito_dime_completo;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 1.2 DISTRIBUI\\u00c7\\u00c3O POR FAIXAS DE SCORE COMBINADO 60M (NOVO)\\r\\nSELECT\\r\\n    'DISTRIBUI\\u00c7\\u00c3O POR SCORE COMBINADO 60M' AS categoria,\\r\\n    CASE \\r\\n        WHEN score_risco_combinado_60m >= 150 THEN '150+ (EXTREMO)'\\r\\n        WHEN score_risco_combinado_60m >= 120 THEN '120-149 (MUITO CR\\u00cdTICO)'\\r\\n        WHEN score_risco_combinado_60m >= 85 THEN '85-119 (CR\\u00cdTICO)'\\r\\n        WHEN score_risco_combinado_60m >= 50 THEN '50-84 (ALTO)'\\r\\n        WHEN score_risco_combinado_60m >= 30 THEN '30-49 (M\\u00c9DIO)'\\r\\n        ELSE '0-29 (BAIXO)'\\r\\n    END AS faixa_score_combinado_60m,\\r\\n    \\r\\n    COUNT(*) AS quantidade_empresas,\\r\\n    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER(), 2) AS percentual,\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_credito_faixa,\\r\\n    ROUND(AVG(saldo_credor_atual), 2) AS media_credito_faixa,\\r\\n    \\r\\n    -- Indicadores de Risco\\r\\n    COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) AS qtde_suspeitas,\\r\\n    ROUND(AVG(qtde_indicios_fraude), 2) AS media_indicios_fraude,\\r\\n    COUNT(CASE WHEN flag_tem_declaracoes_zeradas = 1 THEN 1 END) AS qtde_decl_zeradas,\\r\\n    COUNT(CASE WHEN flag_tem_omissoes = 1 THEN 1 END) AS qtde_omissoes,\\r\\n    \\r\\n    -- Compara\\u00e7\\u00e3o com Score Original\\r\\n    ROUND(AVG(score_risco_60m), 2) AS media_score_original_60m,\\r\\n    ROUND(AVG(score_risco_combinado_60m - score_risco_60m), 2) AS media_pontos_adicionados,\\r\\n    \\r\\n    -- Comportamento\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_periodos_iguais,\\r\\n    ROUND(AVG(crescimento_saldo_percentual_60m), 2) AS media_crescimento\\r\\nFROM teste.credito_dime_completo\\r\\nGROUP BY faixa_score_combinado_60m\\r\\nORDER BY MIN(score_risco_combinado_60m) DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 1.3 COMPARATIVO 12M vs 60M POR EMPRESA\\r\\nSELECT\\r\\n    'COMPARATIVO JANELAS TEMPORAIS' AS categoria,\\r\\n    \\r\\n    CASE \\r\\n        WHEN score_risco_combinado_12m >= 100 AND score_risco_combinado_60m >= 120 \\r\\n            THEN 'CR\\u00cdTICO EM AMBAS'\\r\\n        WHEN score_risco_combinado_60m >= 120 AND score_risco_combinado_12m < 100 \\r\\n            THEN 'HIST\\u00d3RICO CR\\u00cdTICO, RECENTE MELHOR'\\r\\n        WHEN score_risco_combinado_12m >= 100 AND score_risco_combinado_60m < 120 \\r\\n            THEN 'RECENTE CR\\u00cdTICO, HIST\\u00d3RICO MELHOR'\\r\\n        WHEN score_risco_combinado_12m >= 70 OR score_risco_combinado_60m >= 85 \\r\\n            THEN 'ALTO RISCO'\\r\\n        ELSE 'BAIXO/M\\u00c9DIO RISCO'\\r\\n    END AS perfil_temporal,\\r\\n    \\r\\n    COUNT(*) AS qtde_empresas,\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_credito,\\r\\n    ROUND(AVG(score_risco_12m), 2) AS media_score_12m,\\r\\n    ROUND(AVG(score_risco_60m), 2) AS media_score_60m,\\r\\n    ROUND(AVG(score_risco_combinado_12m), 2) AS media_score_comb_12m,\\r\\n    ROUND(AVG(score_risco_combinado_60m), 2) AS media_score_comb_60m,\\r\\n    ROUND(AVG(valor_igual_total_periodos_12m), 2) AS media_iguais_12m,\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_iguais_60m,\\r\\n    COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) AS qtde_suspeitas\\r\\nFROM teste.credito_dime_completo\\r\\nGROUP BY perfil_temporal\\r\\nORDER BY qtde_empresas DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 1.4 MATRIZ DE RISCO: SUSPEITAS vs CR\\u00c9DITO (ATUALIZADO)\\r\\nSELECT\\r\\n    'MATRIZ DE RISCO' AS categoria,\\r\\n    CASE \\r\\n        WHEN flag_empresa_suspeita = 1 THEN 'EMPRESA SUSPEITA'\\r\\n        ELSE 'N\\u00c3O SUSPEITA'\\r\\n    END AS status_suspeita,\\r\\n    \\r\\n    CASE\\r\\n        WHEN saldo_credor_atual >= 1000000 THEN 'R$ 1M+'\\r\\n        WHEN saldo_credor_atual >= 500000 THEN 'R$ 500K-1M'\\r\\n        WHEN saldo_credor_atual >= 100000 THEN 'R$ 100K-500K'\\r\\n        WHEN saldo_credor_atual >= 50000 THEN 'R$ 50K-100K'\\r\\n        ELSE 'Abaixo R$ 50K'\\r\\n    END AS faixa_credito,\\r\\n    \\r\\n    COUNT(*) AS qtde_empresas,\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_credito,\\r\\n    ROUND(AVG(score_risco_combinado_60m), 2) AS media_score_combinado_60m,\\r\\n    ROUND(AVG(score_suspeita), 2) AS media_score_suspeita,\\r\\n    COUNT(CASE WHEN sn_cancelado_inex_inativ = 1 THEN 1 END) AS qtde_canceladas,\\r\\n    ROUND(AVG(qtde_indicios_fraude), 2) AS media_indicios,\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_periodos_iguais\\r\\nFROM teste.credito_dime_completo\\r\\nGROUP BY status_suspeita, faixa_credito\\r\\nORDER BY status_suspeita DESC, MIN(saldo_credor_atual) DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 1.5 DISTRIBUI\\u00c7\\u00c3O POR GER\\u00caNCIA REGIONAL COM ENRIQUECIMENTO\\r\\nSELECT\\r\\n    'DISTRIBUI\\u00c7\\u00c3O POR GERFE ENRIQUECIDA' AS categoria,\\r\\n    nm_gerfe,\\r\\n    COUNT(*) AS total_empresas,\\r\\n    \\r\\n    -- Classifica\\u00e7\\u00e3o Original (60m)\\r\\n    COUNT(CASE WHEN classificacao_risco_60m IN ('CR\\u00cdTICO', 'ALTO') THEN 1 END) AS empresas_prioritarias_60m,\\r\\n    COUNT(CASE WHEN classificacao_risco_12m IN ('CR\\u00cdTICO', 'ALTO') THEN 1 END) AS empresas_prioritarias_12m,\\r\\n    \\r\\n    -- Score Combinado\\r\\n    COUNT(CASE WHEN score_risco_combinado_60m >= 120 THEN 1 END) AS empresas_score_60m_120plus,\\r\\n    COUNT(CASE WHEN score_risco_combinado_12m >= 100 THEN 1 END) AS empresas_score_12m_100plus,\\r\\n    \\r\\n    -- Indicadores de Fraude\\r\\n    COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) AS empresas_suspeitas,\\r\\n    COUNT(CASE WHEN qtde_indicios_fraude >= 5 THEN 1 END) AS empresas_5plus_indicios,\\r\\n    COUNT(CASE WHEN flag_tem_declaracoes_zeradas = 1 THEN 1 END) AS empresas_decl_zeradas,\\r\\n    COUNT(CASE WHEN sn_cancelado_inex_inativ = 1 THEN 1 END) AS empresas_canceladas,\\r\\n    \\r\\n    -- Financeiro\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_credito,\\r\\n    ROUND(SUM(CASE WHEN flag_empresa_suspeita = 1 THEN saldo_credor_atual ELSE 0 END), 2) AS credito_suspeitas,\\r\\n    \\r\\n    -- Scores M\\u00e9dios\\r\\n    ROUND(AVG(score_risco_60m), 2) AS score_medio_60m,\\r\\n    ROUND(AVG(score_risco_combinado_60m), 2) AS score_medio_combinado_60m,\\r\\n    \\r\\n    -- Comportamento\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_periodos_iguais_60m,\\r\\n    ROUND(AVG(crescimento_saldo_percentual_60m), 2) AS media_crescimento_60m,\\r\\n    \\r\\n    -- Percentuais\\r\\n    ROUND(COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) * 100.0 / COUNT(*), 2) AS perc_suspeitas\\r\\nFROM teste.credito_dime_completo\\r\\nWHERE nm_gerfe IS NOT NULL\\r\\nGROUP BY nm_gerfe\\r\\nORDER BY empresas_suspeitas DESC, credito_suspeitas DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 2: AN\\u00c1LISE DE SUSPEITAS E FRAUDES (ATUALIZADO)\\r\\n-- =============================================================================\\r\\n\\r\\n-- 2.1 PANORAMA DE EMPRESAS SUSPEITAS\\r\\nSELECT\\r\\n    'PANORAMA EMPRESAS SUSPEITAS' AS categoria,\\r\\n    \\r\\n    -- Por C\\u00f3digo de Situa\\u00e7\\u00e3o\\r\\n    cd_situacao_suspeita,\\r\\n    COUNT(*) AS qtde_empresas,\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_credito,\\r\\n    ROUND(AVG(saldo_credor_atual), 2) AS media_credito,\\r\\n    ROUND(AVG(score_suspeita), 2) AS media_score_suspeita,\\r\\n    ROUND(AVG(score_risco_combinado_60m), 2) AS media_score_combinado_60m,\\r\\n    ROUND(AVG(score_risco_combinado_12m), 2) AS media_score_combinado_12m,\\r\\n    ROUND(AVG(qtde_indicios_fraude), 2) AS media_indicios,\\r\\n    \\r\\n    -- Comportamento Temporal\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_periodos_iguais_60m,\\r\\n    ROUND(AVG(valor_igual_total_periodos_12m), 2) AS media_periodos_iguais_12m,\\r\\n    ROUND(AVG(qtde_ultimos_12m_iguais), 2) AS media_ultimos_12m_iguais,\\r\\n    COUNT(CASE WHEN sn_cancelado_inex_inativ = 1 THEN 1 END) AS qtde_canceladas,\\r\\n    \\r\\n    -- Movimenta\\u00e7\\u00e3o NFe\\r\\n    ROUND(SUM(vl_nfes_saida_suspeita), 2) AS total_nfe_saida,\\r\\n    ROUND(SUM(vl_nfes_entrada_suspeita), 2) AS total_nfe_entrada,\\r\\n    \\r\\n    -- Declara\\u00e7\\u00f5es\\r\\n    ROUND(AVG(periodos_omissos_normal + periodos_omissos_simples), 2) AS media_omissoes,\\r\\n    ROUND(AVG(periodos_zerados_normal + periodos_zerados_simples), 2) AS media_zerados\\r\\nFROM teste.credito_dime_completo\\r\\nWHERE flag_empresa_suspeita = 1\\r\\nGROUP BY cd_situacao_suspeita\\r\\nORDER BY qtde_empresas DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 2.2 TOP 50 EMPRESAS MAIS SUSPEITAS (ATUALIZADO)\\r\\nSELECT\\r\\n    'TOP 50 EMPRESAS SUSPEITAS' AS categoria,\\r\\n    ROW_NUMBER() OVER (ORDER BY score_risco_combinado_60m DESC, qtde_indicios_fraude DESC) AS ranking,\\r\\n    \\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    nm_fantasia,\\r\\n    de_cnae,\\r\\n    nm_gerfe,\\r\\n    \\r\\n    -- Scores Temporais\\r\\n    score_risco_12m AS score_original_12m,\\r\\n    score_risco_60m AS score_original_60m,\\r\\n    score_risco_combinado_12m,\\r\\n    score_risco_combinado_60m,\\r\\n    score_suspeita,\\r\\n    \\r\\n    -- Cr\\u00e9dito\\r\\n    saldo_credor_atual,\\r\\n    crescimento_saldo_percentual_60m,\\r\\n    crescimento_saldo_percentual_12m,\\r\\n    \\r\\n    -- Indicadores de Fraude\\r\\n    cd_situacao_suspeita,\\r\\n    qtde_indicios_fraude,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    qt_motivos,\\r\\n    \\r\\n    -- Comportamento Temporal\\r\\n    valor_igual_total_periodos_60m,\\r\\n    valor_igual_total_periodos_12m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    flag_tem_declaracoes_zeradas,\\r\\n    flag_tem_omissoes,\\r\\n    periodos_zerados_normal + periodos_zerados_simples AS total_periodos_zerados,\\r\\n    periodos_omissos_normal + periodos_omissos_simples AS total_periodos_omissos,\\r\\n    \\r\\n    -- Noteiras\\r\\n    qt_clientes_noteiras,\\r\\n    qt_fornecedoras_noteiras,\\r\\n    \\r\\n    -- DFe\\r\\n    sn_suspenso_dfe,\\r\\n    \\r\\n    -- Meses Declarados\\r\\n    qtde_meses_declarados_60m,\\r\\n    qtde_meses_declarados_12m\\r\\nFROM teste.credito_dime_completo\\r\\nWHERE flag_empresa_suspeita = 1\\r\\nORDER BY score_risco_combinado_60m DESC, qtde_indicios_fraude DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 2.3 AN\\u00c1LISE DE IND\\u00cdCIOS DE FRAUDE (ATUALIZADO)\\r\\nSELECT\\r\\n    'AN\\u00c1LISE IND\\u00cdCIOS DE FRAUDE' AS categoria,\\r\\n    \\r\\n    CASE\\r\\n        WHEN qtde_indicios_fraude >= 15 THEN '15+ ind\\u00edcios (EXTREMO)'\\r\\n        WHEN qtde_indicios_fraude >= 10 THEN '10-14 ind\\u00edcios (MUITO ALTO)'\\r\\n        WHEN qtde_indicios_fraude >= 7 THEN '7-9 ind\\u00edcios (ALTO)'\\r\\n        WHEN qtde_indicios_fraude >= 5 THEN '5-6 ind\\u00edcios (M\\u00c9DIO-ALTO)'\\r\\n        WHEN qtde_indicios_fraude >= 3 THEN '3-4 ind\\u00edcios (M\\u00c9DIO)'\\r\\n        WHEN qtde_indicios_fraude >= 1 THEN '1-2 ind\\u00edcios (BAIXO)'\\r\\n        ELSE 'Sem ind\\u00edcios'\\r\\n    END AS faixa_indicios,\\r\\n    \\r\\n    COUNT(*) AS qtde_empresas,\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_credito,\\r\\n    ROUND(AVG(score_risco_combinado_60m), 2) AS media_score_combinado_60m,\\r\\n    ROUND(AVG(score_risco_combinado_12m), 2) AS media_score_combinado_12m,\\r\\n    ROUND(AVG(score_suspeita), 2) AS media_score_suspeita,\\r\\n    COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) AS qtde_marcadas_suspeitas,\\r\\n    COUNT(CASE WHEN sn_cancelado_inex_inativ = 1 THEN 1 END) AS qtde_canceladas,\\r\\n    ROUND(AVG(soma_score_indicios), 2) AS media_soma_score_indicios,\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_periodos_iguais_60m\\r\\nFROM teste.credito_dime_completo\\r\\nGROUP BY faixa_indicios\\r\\nORDER BY MIN(qtde_indicios_fraude) DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 2.4 DECLARA\\u00c7\\u00d5ES ZERADAS E OMISS\\u00d5ES (ATUALIZADO)\\r\\nSELECT\\r\\n    'AN\\u00c1LISE DECLARA\\u00c7\\u00d5ES ZERADAS E OMISS\\u00d5ES' AS categoria,\\r\\n    \\r\\n    CASE\\r\\n        WHEN (periodos_zerados_normal + periodos_zerados_simples) >= 12 THEN '12+ per\\u00edodos zerados'\\r\\n        WHEN (periodos_zerados_normal + periodos_zerados_simples) >= 6 THEN '6-11 per\\u00edodos zerados'\\r\\n        WHEN (periodos_zerados_normal + periodos_zerados_simples) >= 1 THEN '1-5 per\\u00edodos zerados'\\r\\n        ELSE 'Sem per\\u00edodos zerados'\\r\\n    END AS faixa_zerados,\\r\\n    \\r\\n    CASE\\r\\n        WHEN (periodos_omissos_normal + periodos_omissos_simples) >= 6 THEN '6+ per\\u00edodos omissos'\\r\\n        WHEN (periodos_omissos_normal + periodos_omissos_simples) >= 3 THEN '3-5 per\\u00edodos omissos'\\r\\n        WHEN (periodos_omissos_normal + periodos_omissos_simples) >= 1 THEN '1-2 per\\u00edodos omissos'\\r\\n        ELSE 'Sem omiss\\u00f5es'\\r\\n    END AS faixa_omissoes,\\r\\n    \\r\\n    COUNT(*) AS qtde_empresas,\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_credito,\\r\\n    ROUND(AVG(score_risco_combinado_60m), 2) AS media_score_combinado_60m,\\r\\n    COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) AS qtde_suspeitas,\\r\\n    ROUND(AVG(qtde_indicios_fraude), 2) AS media_indicios,\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_periodos_iguais_60m\\r\\nFROM teste.credito_dime_completo\\r\\nWHERE flag_tem_declaracoes_zeradas = 1 OR flag_tem_omissoes = 1\\r\\nGROUP BY faixa_zerados, faixa_omissoes\\r\\nORDER BY qtde_empresas DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 2.5 EMPRESAS COM M\\u00daLTIPLOS SINAIS DE ALERTA (ATUALIZADO)\\r\\nWITH alertas_calc AS (\\r\\n    SELECT\\r\\n        *,\\r\\n        (CASE WHEN flag_empresa_suspeita = 1 THEN 1 ELSE 0 END +\\r\\n         CASE WHEN flag_tem_declaracoes_zeradas = 1 THEN 1 ELSE 0 END +\\r\\n         CASE WHEN flag_tem_omissoes = 1 THEN 1 ELSE 0 END +\\r\\n         CASE WHEN sn_cancelado_inex_inativ = 1 THEN 1 ELSE 0 END +\\r\\n         CASE WHEN qtde_indicios_fraude >= 5 THEN 1 ELSE 0 END +\\r\\n         CASE WHEN qtde_ultimos_12m_iguais >= 12 THEN 1 ELSE 0 END +\\r\\n         CASE WHEN valor_igual_total_periodos_60m >= 36 THEN 1 ELSE 0 END +\\r\\n         CASE WHEN crescimento_saldo_percentual_60m > 500 THEN 1 ELSE 0 END) AS qtde_alertas\\r\\n    FROM teste.credito_dime_completo\\r\\n    WHERE (\\r\\n        flag_empresa_suspeita = 1 OR\\r\\n        flag_tem_declaracoes_zeradas = 1 OR\\r\\n        flag_tem_omissoes = 1 OR\\r\\n        sn_cancelado_inex_inativ = 1 OR\\r\\n        qtde_indicios_fraude >= 3\\r\\n    )\\r\\n)\\r\\nSELECT\\r\\n    'M\\u00daLTIPLOS SINAIS DE ALERTA' AS categoria,\\r\\n    qtde_alertas,\\r\\n    COUNT(*) AS qtde_empresas,\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_credito,\\r\\n    ROUND(AVG(saldo_credor_atual), 2) AS media_credito,\\r\\n    ROUND(AVG(score_risco_combinado_60m), 2) AS media_score_combinado_60m,\\r\\n    ROUND(AVG(score_risco_combinado_12m), 2) AS media_score_combinado_12m,\\r\\n    COUNT(CASE WHEN saldo_credor_atual > 500000 THEN 1 END) AS qtde_alto_valor,\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_periodos_iguais_60m\\r\\nFROM alertas_calc\\r\\nWHERE qtde_alertas >= 2\\r\\nGROUP BY qtde_alertas\\r\\nORDER BY qtde_alertas DESC;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 3: TOP EMPRESAS - RANKINGS COM ENRIQUECIMENTO\\r\\n-- =============================================================================\\r\\n\\r\\n-- 3.1 TOP 100 POR SCORE COMBINADO 60M (ATUALIZADO)\\r\\nSELECT\\r\\n    'TOP 100 POR SCORE COMBINADO 60M' AS categoria,\\r\\n    ROW_NUMBER() OVER (ORDER BY score_risco_combinado_60m DESC, saldo_credor_atual DESC) AS ranking,\\r\\n    \\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    nm_fantasia,\\r\\n    de_cnae,\\r\\n    nm_gerfe,\\r\\n    \\r\\n    -- Scores Temporais\\r\\n    score_risco_12m,\\r\\n    score_risco_60m,\\r\\n    score_risco_combinado_12m,\\r\\n    score_risco_combinado_60m,\\r\\n    (score_risco_combinado_60m - score_risco_60m) AS pontos_enriquecimento_60m,\\r\\n    score_suspeita,\\r\\n    \\r\\n    -- Cr\\u00e9dito\\r\\n    saldo_credor_atual,\\r\\n    valor_igual_total_periodos_60m,\\r\\n    valor_igual_total_periodos_12m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    crescimento_saldo_percentual_60m,\\r\\n    crescimento_saldo_percentual_12m,\\r\\n    \\r\\n    -- Flags de Alerta\\r\\n    flag_empresa_suspeita,\\r\\n    flag_tem_declaracoes_zeradas,\\r\\n    flag_tem_omissoes,\\r\\n    qtde_indicios_fraude,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    \\r\\n    -- Complementar\\r\\n    cd_situacao_suspeita,\\r\\n    vl_credito_presumido_60m,\\r\\n    vl_credito_presumido_12m,\\r\\n    \\r\\n    -- Meses\\r\\n    qtde_meses_declarados_60m,\\r\\n    qtde_meses_declarados_12m\\r\\nFROM teste.credito_dime_completo\\r\\nORDER BY score_risco_combinado_60m DESC, saldo_credor_atual DESC\\r\\nLIMIT 100;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 3.2 EMPRESAS CR\\u00cdTICAS SEM MOVIMENTA\\u00c7\\u00c3O FISCAL (ATUALIZADO)\\r\\nSELECT\\r\\n    'CR\\u00cdTICAS SEM MOVIMENTA\\u00c7\\u00c3O' AS categoria,\\r\\n    ROW_NUMBER() OVER (ORDER BY cd.score_risco_combinado_60m DESC) AS ranking,\\r\\n    \\r\\n    cd.nu_cnpj,\\r\\n    cd.nm_razao_social,\\r\\n    cd.de_cnae,\\r\\n    cd.nm_gerfe,\\r\\n    cd.saldo_credor_atual,\\r\\n    cd.score_risco_combinado_60m,\\r\\n    cd.score_risco_combinado_12m,\\r\\n    cd.valor_igual_total_periodos_60m,\\r\\n    cd.qtde_ultimos_12m_iguais,\\r\\n    \\r\\n    -- Indicadores de Fraude\\r\\n    cd.flag_empresa_suspeita,\\r\\n    cd.qtde_indicios_fraude,\\r\\n    cd.cd_situacao_suspeita,\\r\\n    cd.sn_cancelado_inex_inativ,\\r\\n    \\r\\n    -- Declara\\u00e7\\u00f5es\\r\\n    cd.total_vl_faturamento AS fat_normal,\\r\\n    cd.total_vl_rec_bruta AS rec_bruta_simples,\\r\\n    cd.nfes_emitidas_normal,\\r\\n    cd.nfes_emitidas_simples,\\r\\n    (cd.periodos_zerados_normal + cd.periodos_zerados_simples) AS total_zerados,\\r\\n    (cd.periodos_omissos_normal + cd.periodos_omissos_simples) AS total_omissos,\\r\\n    \\r\\n    -- Movimenta\\u00e7\\u00e3o Setorial\\r\\n    (COALESCE(txt.vl_entradas_textil, 0) + COALESCE(txt.vl_saidas_textil, 0) +\\r\\n     COALESCE(mm.vl_entradas_metalmec, 0) + COALESCE(mm.vl_saidas_metalmec, 0) +\\r\\n     COALESCE(tech.vl_entradas_tech, 0) + COALESCE(tech.vl_saidas_tech, 0)) AS movto_total_setores\\r\\nFROM teste.credito_dime_completo cd\\r\\nLEFT JOIN teste.credito_dime_textil txt ON cd.nu_cnpj = txt.nu_cnpj\\r\\nLEFT JOIN teste.credito_dime_metalmec mm ON cd.nu_cnpj = mm.nu_cnpj\\r\\nLEFT JOIN teste.credito_dime_tech tech ON cd.nu_cnpj = tech.nu_cnpj\\r\\nWHERE cd.score_risco_combinado_60m >= 85\\r\\nAND cd.saldo_credor_atual > 100000\\r\\nAND (\\r\\n    ((cd.nfes_emitidas_normal + cd.nfes_emitidas_simples) < 10) OR\\r\\n    ((COALESCE(txt.vl_entradas_textil, 0) + COALESCE(txt.vl_saidas_textil, 0) +\\r\\n     COALESCE(mm.vl_entradas_metalmec, 0) + COALESCE(mm.vl_saidas_metalmec, 0) +\\r\\n     COALESCE(tech.vl_entradas_tech, 0) + COALESCE(tech.vl_saidas_tech, 0)) < 10000)\\r\\n)\\r\\nORDER BY cd.score_risco_combinado_60m DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 3.3 EMPRESAS COM ALTO CR\\u00c9DITO E CANCELAMENTO/INEXIST\\u00caNCIA (ATUALIZADO)\\r\\nSELECT\\r\\n    'ALTO CR\\u00c9DITO + CANCELAMENTO' AS categoria,\\r\\n    ROW_NUMBER() OVER (ORDER BY saldo_credor_atual DESC) AS ranking,\\r\\n    \\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    nm_fantasia,\\r\\n    de_cnae,\\r\\n    nm_gerfe,\\r\\n    nm_sit_cadastral,\\r\\n    \\r\\n    saldo_credor_atual,\\r\\n    score_risco_combinado_60m,\\r\\n    score_risco_combinado_12m,\\r\\n    \\r\\n    -- Status de Suspeita\\r\\n    cd_situacao_suspeita,\\r\\n    dt_situacao_suspeita,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    dt_inicio_protoc_cancelamento,\\r\\n    \\r\\n    -- Ind\\u00edcios\\r\\n    qtde_indicios_fraude,\\r\\n    soma_score_indicios,\\r\\n    \\r\\n    -- Comportamento Fiscal\\r\\n    valor_igual_total_periodos_60m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    nfes_emitidas_normal + nfes_emitidas_simples AS total_nfes,\\r\\n    periodos_zerados_normal + periodos_zerados_simples AS total_zerados,\\r\\n    \\r\\n    -- Crescimento\\r\\n    crescimento_saldo_percentual_60m,\\r\\n    crescimento_saldo_percentual_12m,\\r\\n    \\r\\n    -- Observa\\u00e7\\u00f5es\\r\\n    tx_obs_situacao_suspeita\\r\\nFROM teste.credito_dime_completo\\r\\nWHERE sn_cancelado_inex_inativ = 1\\r\\nAND saldo_credor_atual > 50000\\r\\nORDER BY saldo_credor_atual DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 3.4 NOTEIRAS - EMPRESAS COM MUITOS CLIENTES/FORNECEDORES NOTEIROS (ATUALIZADO)\\r\\nSELECT\\r\\n    'EMPRESAS COM NOTEIRAS' AS categoria,\\r\\n    \\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    de_cnae,\\r\\n    nm_gerfe,\\r\\n    saldo_credor_atual,\\r\\n    score_risco_combinado_60m,\\r\\n    score_risco_combinado_12m,\\r\\n    \\r\\n    -- Noteiras\\r\\n    qt_clientes_noteiras,\\r\\n    qt_fornecedoras_noteiras,\\r\\n    (qt_clientes_noteiras + qt_fornecedoras_noteiras) AS total_noteiras,\\r\\n    \\r\\n    -- Movimenta\\u00e7\\u00e3o\\r\\n    vl_nfes_saida_suspeita,\\r\\n    vl_nfes_entrada_suspeita,\\r\\n    \\r\\n    -- Indicadores\\r\\n    flag_empresa_suspeita,\\r\\n    qtde_indicios_fraude,\\r\\n    cd_situacao_suspeita,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    \\r\\n    -- Comportamento\\r\\n    valor_igual_total_periodos_60m,\\r\\n    qtde_ultimos_12m_iguais\\r\\nFROM teste.credito_dime_completo\\r\\nWHERE (qt_clientes_noteiras + qt_fornecedoras_noteiras) >= 5\\r\\nAND saldo_credor_atual > 50000\\r\\nORDER BY (qt_clientes_noteiras + qt_fornecedoras_noteiras) DESC, saldo_credor_atual DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 4: AN\\u00c1LISE DETALHADA - SETOR T\\u00caXTIL COM ENRIQUECIMENTO\\r\\n-- =============================================================================\\r\\n\\r\\n-- 4.1 OVERVIEW SETOR T\\u00caXTIL COM ENRIQUECIMENTO (ATUALIZADO)\\r\\nSELECT\\r\\n    'OVERVIEW T\\u00caXTIL ENRIQUECIDO' AS categoria,\\r\\n    classificacao_risco_combinado_60m,\\r\\n    \\r\\n    -- Quantidades\\r\\n    COUNT(*) AS qtde_empresas,\\r\\n    COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) AS qtde_suspeitas,\\r\\n    COUNT(CASE WHEN qtde_indicios_fraude >= 3 THEN 1 END) AS qtde_3plus_indicios,\\r\\n    \\r\\n    -- Financeiro\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS total_saldo_credor,\\r\\n    ROUND(AVG(saldo_credor_atual), 2) AS media_saldo_credor,\\r\\n    ROUND(SUM(vl_entradas_textil), 2) AS total_entradas,\\r\\n    ROUND(SUM(vl_saidas_textil), 2) AS total_saidas,\\r\\n    \\r\\n    -- Movimenta\\u00e7\\u00e3o\\r\\n    ROUND(AVG(dias_movimento_textil), 2) AS media_dias_movimento,\\r\\n    COUNT(CASE WHEN vl_saidas_textil = 0 AND vl_entradas_textil > 10000 THEN 1 END) AS qtde_so_compra,\\r\\n    \\r\\n    -- Scores\\r\\n    ROUND(AVG(score_risco_textil_combinado), 2) AS media_score_combinado,\\r\\n    ROUND(AVG(score_suspeita), 2) AS media_score_suspeita,\\r\\n    \\r\\n    -- Comportamento\\r\\n    ROUND(AVG(valor_igual_total_periodos_60m), 2) AS media_periodos_iguais_60m\\r\\nFROM teste.credito_dime_textil\\r\\nWHERE flag_setor_textil = 1\\r\\nAND vl_entradas_textil > 1000\\r\\nGROUP BY classificacao_risco_combinado_60m\\r\\nORDER BY\\r\\n    CASE classificacao_risco_combinado_60m\\r\\n        WHEN 'CR\\u00cdTICO' THEN 1\\r\\n        WHEN 'ALTO' THEN 2\\r\\n        WHEN 'M\\u00c9DIO' THEN 3\\r\\n        WHEN 'BAIXO' THEN 4\\r\\n    END;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 4.2 TOP 50 T\\u00caXTEIS SUSPEITAS (ATUALIZADO)\\r\\nSELECT\\r\\n    'TOP 50 T\\u00caXTIL SUSPEITAS' AS categoria,\\r\\n    ROW_NUMBER() OVER (ORDER BY score_risco_textil_combinado DESC) AS ranking,\\r\\n    \\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    de_cnae,\\r\\n    nm_gerfe,\\r\\n    \\r\\n    -- Financeiro\\r\\n    saldo_credor_atual,\\r\\n    vl_entradas_textil,\\r\\n    vl_saidas_textil,\\r\\n    indice_entrada_saida_textil,\\r\\n    \\r\\n    -- Scores\\r\\n    score_risco_60m AS score_original_60m,\\r\\n    score_risco_textil_combinado,\\r\\n    score_suspeita,\\r\\n    \\r\\n    -- Indicadores de Fraude\\r\\n    flag_empresa_suspeita,\\r\\n    qtde_indicios_fraude,\\r\\n    cd_situacao_suspeita,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    \\r\\n    -- Comportamento\\r\\n    valor_igual_total_periodos_60m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    dias_movimento_textil,\\r\\n    qtde_ncm_distintos_textil,\\r\\n    \\r\\n    -- Crescimento\\r\\n    crescimento_saldo_percentual_60m,\\r\\n    \\r\\n    -- Padr\\u00e3o\\r\\n    CASE \\r\\n        WHEN vl_saidas_textil = 0 THEN 'SO COMPRA'\\r\\n        WHEN vl_entradas_textil > vl_saidas_textil * 3 THEN 'COMPRA 3X+ VENDE'\\r\\n        WHEN vl_saidas_textil > vl_entradas_textil * 3 THEN 'VENDE 3X+ COMPRA'\\r\\n        ELSE 'EQUILIBRADO'\\r\\n    END AS padrao_movimento\\r\\nFROM teste.credito_dime_textil\\r\\nWHERE flag_setor_textil = 1\\r\\nAND vl_entradas_textil > 10000\\r\\nAND (\\r\\n    flag_empresa_suspeita = 1 OR\\r\\n    score_risco_textil_combinado >= 85 OR\\r\\n    qtde_indicios_fraude >= 3\\r\\n)\\r\\nORDER BY score_risco_textil_combinado DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 5: AN\\u00c1LISE DETALHADA - SETOR METAL-MEC\\u00c2NICO COM ENRIQUECIMENTO\\r\\n-- =============================================================================\\r\\n\\r\\n-- 5.1 TOP 50 METAL-MEC\\u00c2NICO SUSPEITAS (ATUALIZADO)\\r\\nSELECT\\r\\n    'TOP 50 METAL-MEC SUSPEITAS' AS categoria,\\r\\n    ROW_NUMBER() OVER (ORDER BY score_risco_metalmec_combinado DESC) AS ranking,\\r\\n    \\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    de_cnae,\\r\\n    nm_gerfe,\\r\\n    \\r\\n    -- Financeiro\\r\\n    saldo_credor_atual,\\r\\n    vl_entradas_metalmec,\\r\\n    vl_saidas_metalmec,\\r\\n    vl_capitulo_84,\\r\\n    vl_capitulo_85,\\r\\n    perc_cap84,\\r\\n    \\r\\n    -- Scores\\r\\n    score_risco_60m AS score_original_60m,\\r\\n    score_risco_metalmec_combinado,\\r\\n    score_suspeita,\\r\\n    \\r\\n    -- Indicadores de Fraude\\r\\n    flag_empresa_suspeita,\\r\\n    qtde_indicios_fraude,\\r\\n    cd_situacao_suspeita,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    \\r\\n    -- Comportamento\\r\\n    valor_igual_total_periodos_60m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    dias_movimento_metalmec,\\r\\n    qtde_ncm_distintos_metalmec,\\r\\n    \\r\\n    -- Crescimento\\r\\n    crescimento_saldo_percentual_60m\\r\\nFROM teste.credito_dime_metalmec\\r\\nWHERE flag_setor_metalmec = 1\\r\\nAND vl_entradas_metalmec > 10000\\r\\nAND (\\r\\n    flag_empresa_suspeita = 1 OR\\r\\n    score_risco_metalmec_combinado >= 85 OR\\r\\n    qtde_indicios_fraude >= 3\\r\\n)\\r\\nORDER BY score_risco_metalmec_combinado DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 6: AN\\u00c1LISE DETALHADA - SETOR TECNOLOGIA COM ENRIQUECIMENTO\\r\\n-- =============================================================================\\r\\n\\r\\n-- 6.1 TOP 50 TECNOLOGIA SUSPEITAS (ATUALIZADO)\\r\\nSELECT\\r\\n    'TOP 50 TECH SUSPEITAS' AS categoria,\\r\\n    ROW_NUMBER() OVER (ORDER BY score_risco_tech_combinado DESC) AS ranking,\\r\\n    \\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    de_cnae,\\r\\n    nm_gerfe,\\r\\n    \\r\\n    -- Financeiro\\r\\n    saldo_credor_atual,\\r\\n    vl_entradas_tech,\\r\\n    vl_saidas_tech,\\r\\n    vl_computadores,\\r\\n    vl_partes_computadores,\\r\\n    vl_telecom,\\r\\n    \\r\\n    -- Scores\\r\\n    score_risco_60m AS score_original_60m,\\r\\n    score_risco_tech_combinado,\\r\\n    score_suspeita,\\r\\n    \\r\\n    -- Indicadores de Fraude\\r\\n    flag_empresa_suspeita,\\r\\n    qtde_indicios_fraude,\\r\\n    cd_situacao_suspeita,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    \\r\\n    -- Comportamento\\r\\n    valor_igual_total_periodos_60m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    dias_movimento_tech,\\r\\n    qtde_ncm_distintos_tech,\\r\\n    \\r\\n    -- Crescimento\\r\\n    crescimento_saldo_percentual_60m\\r\\nFROM teste.credito_dime_tech\\r\\nWHERE flag_setor_tech = 1\\r\\nAND vl_entradas_tech > 10000\\r\\nAND (\\r\\n    flag_empresa_suspeita = 1 OR\\r\\n    score_risco_tech_combinado >= 85 OR\\r\\n    qtde_indicios_fraude >= 3\\r\\n)\\r\\nORDER BY score_risco_tech_combinado DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 7: AN\\u00c1LISE INDIVIDUAL - FICHA COMPLETA COM ENRIQUECIMENTO\\r\\n-- SUBSTITUA '00000000000000' PELO CNPJ DESEJADO\\r\\n-- =============================================================================\\r\\n\\r\\n-- 7.1 FICHA COMPLETA ENRIQUECIDA (ATUALIZADO)\\r\\nWITH empresa_base AS (\\r\\n    SELECT * FROM teste.credito_dime_completo WHERE nu_cnpj = '00000000000000'\\r\\n),\\r\\nempresa_textil AS (\\r\\n    SELECT * FROM teste.credito_dime_textil WHERE nu_cnpj = '00000000000000'\\r\\n),\\r\\nempresa_metalmec AS (\\r\\n    SELECT * FROM teste.credito_dime_metalmec WHERE nu_cnpj = '00000000000000'\\r\\n),\\r\\nempresa_tech AS (\\r\\n    SELECT * FROM teste.credito_dime_tech WHERE nu_cnpj = '00000000000000'\\r\\n)\\r\\nSELECT\\r\\n    'FICHA COMPLETA EMPRESA' AS categoria,\\r\\n    -- IDENTIFICA\\u00c7\\u00c3O\\r\\n    eb.nu_cnpj,\\r\\n    eb.nm_razao_social,\\r\\n    eb.nm_fantasia,\\r\\n    eb.de_cnae,\\r\\n    eb.nm_gerfe,\\r\\n    eb.nm_sit_cadastral,\\r\\n    \\r\\n    -- RISCO - 12 MESES\\r\\n    eb.score_risco_12m,\\r\\n    eb.score_risco_combinado_12m,\\r\\n    eb.classificacao_risco_12m,\\r\\n    \\r\\n    -- RISCO - 60 MESES\\r\\n    eb.score_risco_60m,\\r\\n    eb.score_risco_combinado_60m,\\r\\n    eb.classificacao_risco_60m,\\r\\n    \\r\\n    -- CR\\u00c9DITO\\r\\n    eb.saldo_credor_atual,\\r\\n    eb.crescimento_saldo_percentual_60m,\\r\\n    eb.crescimento_saldo_percentual_12m,\\r\\n    eb.valor_igual_total_periodos_60m,\\r\\n    eb.valor_igual_total_periodos_12m,\\r\\n    eb.qtde_ultimos_12m_iguais,\\r\\n    eb.vl_credito_presumido_60m,\\r\\n    eb.vl_credito_presumido_12m,\\r\\n    \\r\\n    -- INDICADORES DE FRAUDE\\r\\n    eb.flag_empresa_suspeita,\\r\\n    eb.cd_situacao_suspeita,\\r\\n    eb.score_suspeita,\\r\\n    eb.qtde_indicios_fraude,\\r\\n    eb.soma_score_indicios,\\r\\n    eb.sn_cancelado_inex_inativ,\\r\\n    eb.qt_motivos,\\r\\n    \\r\\n    -- DECLARA\\u00c7\\u00d5ES\\r\\n    eb.flag_tem_pagamentos,\\r\\n    eb.quantidade_pagtos,\\r\\n    eb.valor_pagtos,\\r\\n    eb.flag_tem_declaracoes_zeradas,\\r\\n    eb.flag_tem_omissoes,\\r\\n    eb.periodos_zerados_normal + eb.periodos_zerados_simples AS total_zerados,\\r\\n    eb.periodos_omissos_normal + eb.periodos_omissos_simples AS total_omissos,\\r\\n    eb.nfes_emitidas_normal + eb.nfes_emitidas_simples AS total_nfes,\\r\\n    \\r\\n    -- MESES DECLARADOS\\r\\n    eb.qtde_meses_declarados_60m,\\r\\n    eb.qtde_meses_declarados_12m,\\r\\n    \\r\\n    -- NOTEIRAS\\r\\n    eb.qt_clientes_noteiras,\\r\\n    eb.qt_fornecedoras_noteiras,\\r\\n    eb.sn_suspenso_dfe,\\r\\n    \\r\\n    -- SETORES\\r\\n    CASE WHEN et.flag_setor_textil = 1 THEN 'SIM' ELSE 'NAO' END AS opera_textil,\\r\\n    et.vl_entradas_textil,\\r\\n    et.vl_saidas_textil,\\r\\n    et.score_risco_textil_combinado,\\r\\n    CASE WHEN em.flag_setor_metalmec = 1 THEN 'SIM' ELSE 'NAO' END AS opera_metalmec,\\r\\n    em.vl_entradas_metalmec,\\r\\n    em.vl_saidas_metalmec,\\r\\n    em.score_risco_metalmec_combinado,\\r\\n    CASE WHEN etch.flag_setor_tech = 1 THEN 'SIM' ELSE 'NAO' END AS opera_tech,\\r\\n    etch.vl_entradas_tech,\\r\\n    etch.vl_saidas_tech,\\r\\n    etch.score_risco_tech_combinado,\\r\\n    \\r\\n    -- OBSERVA\\u00c7\\u00d5ES\\r\\n    eb.tx_obs_situacao_suspeita\\r\\nFROM empresa_base eb\\r\\nLEFT JOIN empresa_textil et ON eb.nu_cnpj = et.nu_cnpj\\r\\nLEFT JOIN empresa_metalmec em ON eb.nu_cnpj = em.nu_cnpj\\r\\nLEFT JOIN empresa_tech etch ON eb.nu_cnpj = etch.nu_cnpj;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- M\\u00d3DULO 8: ALERTAS E MONITORAMENTO COM ENRIQUECIMENTO\\r\\n-- =============================================================================\\r\\n\\r\\n-- 8.1 DASHBOARD EXECUTIVO ENRIQUECIDO (ATUALIZADO)\\r\\nSELECT\\r\\n    'DASHBOARD EXECUTIVO' AS categoria,\\r\\n    \\r\\n    -- M\\u00e9tricas Principais\\r\\n    COUNT(DISTINCT nu_cnpj) AS total_empresas,\\r\\n    \\r\\n    -- Risco Combinado 60M\\r\\n    COUNT(CASE WHEN score_risco_combinado_60m >= 150 THEN 1 END) AS empresas_score_60m_150plus,\\r\\n    COUNT(CASE WHEN score_risco_combinado_60m >= 120 THEN 1 END) AS empresas_score_60m_120plus,\\r\\n    COUNT(CASE WHEN score_risco_combinado_60m >= 85 THEN 1 END) AS empresas_score_60m_85plus,\\r\\n    \\r\\n    -- Risco Combinado 12M\\r\\n    COUNT(CASE WHEN score_risco_combinado_12m >= 100 THEN 1 END) AS empresas_score_12m_100plus,\\r\\n    COUNT(CASE WHEN score_risco_combinado_12m >= 70 THEN 1 END) AS empresas_score_12m_70plus,\\r\\n    \\r\\n    -- Suspeitas e Fraudes\\r\\n    COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) AS empresas_suspeitas,\\r\\n    COUNT(CASE WHEN qtde_indicios_fraude >= 5 THEN 1 END) AS empresas_5plus_indicios,\\r\\n    COUNT(CASE WHEN sn_cancelado_inex_inativ = 1 THEN 1 END) AS empresas_canceladas,\\r\\n    COUNT(CASE WHEN flag_tem_declaracoes_zeradas = 1 THEN 1 END) AS empresas_decl_zeradas,\\r\\n    \\r\\n    -- Percentuais\\r\\n    ROUND(COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) * 100.0 / COUNT(*), 2) AS perc_suspeitas,\\r\\n    ROUND(COUNT(CASE WHEN score_risco_combinado_60m >= 120 THEN 1 END) * 100.0 / COUNT(*), 2) AS perc_score_60m_120plus,\\r\\n    \\r\\n    -- Financeiro\\r\\n    ROUND(SUM(saldo_credor_atual), 2) AS receita_total_monitorada,\\r\\n    ROUND(SUM(CASE WHEN flag_empresa_suspeita = 1 THEN saldo_credor_atual ELSE 0 END), 2) AS receita_empresas_suspeitas,\\r\\n    \\r\\n    -- Alertas Comportamentais\\r\\n    COUNT(CASE WHEN qtde_ultimos_12m_iguais >= 12 THEN 1 END) AS alertas_congelamento_12m,\\r\\n    COUNT(CASE WHEN valor_igual_total_periodos_60m >= 48 THEN 1 END) AS alertas_congelamento_60m,\\r\\n    COUNT(CASE WHEN crescimento_saldo_percentual_60m > 500 THEN 1 END) AS alertas_crescimento_explosivo,\\r\\n    COUNT(CASE WHEN (qt_clientes_noteiras + qt_fornecedoras_noteiras) >= 10 THEN 1 END) AS alertas_muitas_noteiras,\\r\\n    \\r\\n    -- Timestamp\\r\\n    CURRENT_TIMESTAMP() AS data_atualizacao\\r\\nFROM teste.credito_dime_completo;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 8.2 ALERTAS AUTOM\\u00c1TICOS PRIORIT\\u00c1RIOS ENRIQUECIDOS (ATUALIZADO)\\r\\nSELECT\\r\\n    'ALERTAS AUTOM\\u00c1TICOS' AS categoria,\\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    nm_gerfe,\\r\\n    score_risco_combinado_60m,\\r\\n    score_risco_combinado_12m,\\r\\n    saldo_credor_atual,\\r\\n    \\r\\n    -- Tipo de Alerta (Priorizado)\\r\\n    CASE \\r\\n        WHEN sn_cancelado_inex_inativ = 1 AND saldo_credor_atual > 100000\\r\\n            THEN 'CR\\u00cdTICO: Cancelada/Inexistente com Alto Cr\\u00e9dito'\\r\\n        \\r\\n        WHEN flag_empresa_suspeita = 1 AND qtde_indicios_fraude >= 15\\r\\n            THEN 'CR\\u00cdTICO: Suspeita com 15+ Ind\\u00edcios de Fraude'\\r\\n        \\r\\n        WHEN score_risco_combinado_60m >= 150\\r\\n            THEN 'CR\\u00cdTICO: Score Combinado 60M >= 150 (Extremo)'\\r\\n        \\r\\n        WHEN qtde_indicios_fraude >= 10 AND saldo_credor_atual > 500000\\r\\n            THEN 'CR\\u00cdTICO: 10+ Ind\\u00edcios + Alto Cr\\u00e9dito'\\r\\n        \\r\\n        WHEN flag_empresa_suspeita = 1 AND flag_tem_declaracoes_zeradas = 1 AND flag_tem_omissoes = 1\\r\\n            THEN 'ALTO: Suspeita + Zeradas + Omiss\\u00f5es'\\r\\n        \\r\\n        WHEN score_risco_combinado_60m >= 120\\r\\n            THEN 'ALTO: Score Combinado 60M >= 120'\\r\\n        \\r\\n        WHEN (qt_clientes_noteiras + qt_fornecedoras_noteiras) >= 15\\r\\n            THEN 'ALTO: 15+ Noteiras no Relacionamento'\\r\\n        \\r\\n        WHEN valor_igual_total_periodos_60m >= 48 AND score_suspeita > 80\\r\\n            THEN 'ALTO: Congelado 48m+ + Score Suspeita Alto'\\r\\n        \\r\\n        WHEN qtde_ultimos_12m_iguais >= 12 AND score_risco_combinado_12m >= 100\\r\\n            THEN 'ALTO: \\u00daltimos 12m Congelados + Score 12M Alto'\\r\\n        \\r\\n        ELSE 'M\\u00c9DIO: Monitoramento Cont\\u00ednuo'\\r\\n    END AS tipo_alerta,\\r\\n    \\r\\n    -- Prioridade\\r\\n    CASE \\r\\n        WHEN sn_cancelado_inex_inativ = 1 OR qtde_indicios_fraude >= 15 OR score_risco_combinado_60m >= 150 THEN 1\\r\\n        WHEN flag_empresa_suspeita = 1 AND qtde_indicios_fraude >= 10 THEN 1\\r\\n        WHEN score_risco_combinado_60m >= 120 OR (qt_clientes_noteiras + qt_fornecedoras_noteiras) >= 15 THEN 2\\r\\n        WHEN qtde_indicios_fraude >= 5 OR score_risco_combinado_12m >= 100 THEN 2\\r\\n        ELSE 3\\r\\n    END AS prioridade,\\r\\n    \\r\\n    -- Indicadores Detalhados\\r\\n    flag_empresa_suspeita,\\r\\n    cd_situacao_suspeita,\\r\\n    qtde_indicios_fraude,\\r\\n    sn_cancelado_inex_inativ,\\r\\n    valor_igual_total_periodos_60m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    flag_tem_declaracoes_zeradas,\\r\\n    flag_tem_omissoes,\\r\\n    (qt_clientes_noteiras + qt_fornecedoras_noteiras) AS total_noteiras,\\r\\n    crescimento_saldo_percentual_60m,\\r\\n    crescimento_saldo_percentual_12m\\r\\nFROM teste.credito_dime_completo\\r\\nWHERE (\\r\\n    score_risco_combinado_60m >= 85 OR\\r\\n    score_risco_combinado_12m >= 70 OR\\r\\n    flag_empresa_suspeita = 1 OR\\r\\n    qtde_indicios_fraude >= 3 OR\\r\\n    sn_cancelado_inex_inativ = 1 OR\\r\\n    qtde_ultimos_12m_iguais >= 12 OR\\r\\n    valor_igual_total_periodos_60m >= 36 OR\\r\\n    (qt_clientes_noteiras + qt_fornecedoras_noteiras) >= 10\\r\\n)\\r\\nORDER BY prioridade, score_risco_combinado_60m DESC\\r\\nLIMIT 200;\\r\\n\\r\\n-- PAUSA AQUI\\r\\n\\r\\n-- =============================================================================\\r\\n-- 8.3 AN\\u00c1LISE DE EVOLU\\u00c7\\u00c3O TEMPORAL - EMPRESAS QUE PIORARAM (NOVO)\\r\\nSELECT\\r\\n    'EMPRESAS COM PIORA RECENTE' AS categoria,\\r\\n    nu_cnpj,\\r\\n    nm_razao_social,\\r\\n    nm_gerfe,\\r\\n    \\r\\n    -- Comparativo de Scores\\r\\n    score_risco_12m,\\r\\n    score_risco_60m,\\r\\n    score_risco_combinado_12m,\\r\\n    score_risco_combinado_60m,\\r\\n    (score_risco_combinado_12m - score_risco_combinado_60m) AS diferenca_scores,\\r\\n    \\r\\n    -- Cr\\u00e9dito\\r\\n    saldo_credor_atual,\\r\\n    crescimento_saldo_percentual_12m,\\r\\n    crescimento_saldo_percentual_60m,\\r\\n    \\r\\n    -- Comportamento\\r\\n    valor_igual_total_periodos_12m,\\r\\n    valor_igual_total_periodos_60m,\\r\\n    qtde_ultimos_12m_iguais,\\r\\n    \\r\\n    -- Indicadores\\r\\n    flag_empresa_suspeita,\\r\\n    qtde_indicios_fraude,\\r\\n    sn_cancelado_inex_inativ\\r\\nFROM teste.credito_dime_completo\\r\\nWHERE score_risco_combinado_12m > score_risco_combinado_60m + 20\\r\\nAND saldo_credor_atual > 50000\\r\\nORDER BY (score_risco_combinado_12m - score_risco_combinado_60m) DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- FIM DO SCRIPT DE AN\\u00c1LISES\", \"lastExecutedSelectionRange\": {\"start\": {\"row\": 0, \"column\": 0}, \"end\": {\"row\": 1060, \"column\": 28}}, \"formatEnabled\": true, \"isFetchingData\": false, \"isCanceling\": false, \"aceAutoExpand\": false, \"lastCheckStatusRequest\": {\"readyState\": 4, \"responseText\": \"{\\\"status\\\": 0, \\\"query_status\\\": {\\\"status\\\": \\\"available\\\"}}\", \"responseJSON\": {\"status\": 0, \"query_status\": {\"status\": \"available\"}}, \"status\": 200, \"statusText\": \"OK\"}, \"lastGetLogsRequest\": {\"readyState\": 4, \"responseText\": \"{\\\"status\\\": 0, \\\"logs\\\": \\\"Query 784356f2f8839bcd:753e97b700000000 100% Complete (8 out of 8)\\\", \\\"progress\\\": 100, \\\"jobs\\\": [{\\\"name\\\": \\\"784356f2f8839bcd:753e97b700000000\\\", \\\"url\\\": \\\"/hue/jobbrowser#!id=784356f2f8839bcd:753e97b700000000\\\", \\\"started\\\": true, \\\"finished\\\": false, \\\"percentJob\\\": 100}], \\\"isFullLogs\\\": false}\", \"responseJSON\": {\"status\": 0, \"logs\": \"Query 784356f2f8839bcd:753e97b700000000 100% Complete (8 out of 8)\", \"progress\": 100, \"jobs\": [{\"name\": \"784356f2f8839bcd:753e97b700000000\", \"url\": \"/hue/jobbrowser#!id=784356f2f8839bcd:753e97b700000000\", \"started\": true, \"finished\": false, \"percentJob\": 100}], \"isFullLogs\": false}, \"status\": 200, \"statusText\": \"OK\"}}], \"selectedSnippet\": \"impala\", \"creatingSessionLocks\": [], \"sessions\": [], \"directoryUuid\": \"\", \"dependentsCoordinator\": [], \"historyFilter\": \"\", \"historyFilterVisible\": false, \"loadingHistory\": false, \"historyInitialHeight\": 10585.6, \"forceHistoryInitialHeight\": false, \"historyCurrentPage\": 1, \"historyTotalPages\": 176, \"schedulerViewModel\": null, \"schedulerViewModelIsLoaded\": false, \"isBatchable\": true, \"isExecutingAll\": false, \"executingAllIndex\": 0, \"retryModalConfirm\": null, \"retryModalCancel\": null, \"canSave\": true, \"unloaded\": false, \"updateHistoryFailed\": false, \"viewSchedulerId\": \"\", \"loadingScheduler\": false}",
    "extra": "",
    "search": "-- =============================================================================\r\n-- ANÁLISE COMPLETA DE CRÉDITOS ICMS ACUMULADOS - VERSÃO 3.0\r\n-- Sistema de Consultas com Dados de Enriquecimento (Cancelamento/Suspeitas)\r\n-- Atualizado para trabalhar com análises de 12 e 60 meses\r\n-- Execute cada bloco SEPARADAMENTE, pausando entre execuções\r\n-- =============================================================================\r\n\r\n-- CONFIGURAÇÃO INICIAL\r\nSET REQUEST_POOL = 'medium';\r\nSET MEM_LIMIT = 8G;\r\n\r\n-- =============================================================================\r\n-- MÓDULO 1: VISÃO GERAL DO SISTEMA COM ENRIQUECIMENTO\r\n-- Execute este bloco primeiro para ter o panorama geral\r\n-- =============================================================================\r\n\r\n-- 1.1 PANORAMA EXECUTIVO GERAL ENRIQUECIDO\r\nSELECT\r\n    'PANORAMA GERAL - CRÉDITOS ICMS' AS categoria,\r\n    -- Métricas de Volume\r\n    COUNT(DISTINCT nu_cnpj) AS total_empresas_monitoradas,\r\n    COUNT(DISTINCT nu_cnpj_grupo) AS total_grupos_economicos,\r\n    \r\n    -- Distribuição por Risco Original (60 meses)\r\n    COUNT(CASE WHEN classificacao_risco_60m = 'CRÍTICO' THEN 1 END) AS empresas_criticas_60m,\r\n    COUNT(CASE WHEN classificacao_risco_60m = 'ALTO' THEN 1 END) AS empresas_alto_risco_60m,\r\n    COUNT(CASE WHEN classificacao_risco_12m = 'CRÍTICO' THEN 1 END) AS empresas_criticas_12m,\r\n    COUNT(CASE WHEN classificacao_risco_12m = 'ALTO' THEN 1 END) AS empresas_alto_risco_12m,\r\n    \r\n    -- Distribuição por Score Combinado (com enriquecimento)\r\n    COUNT(CASE WHEN score_risco_combinado_60m >= 120 THEN 1 END) AS empresas_score_60m_120plus,\r\n    COUNT(CASE WHEN score_risco_combinado_60m >= 100 THEN 1 END) AS empresas_score_60m_100plus,\r\n    COUNT(CASE WHEN score_risco_combinado_12m >= 100 THEN 1 END) AS empresas_score_12m_100plus,\r\n    \r\n    -- Empresas com Indicadores de Fraude\r\n    COUNT(CASE WHEN flag_empresa_suspeita = 1 THEN 1 END) AS empresas_suspeitas,\r\n    COUNT(CASE WHEN flag_tem_decl",
    "last_modified": "2025-10-30T17:59:41.913",
    "version": 1,
    "is_history": false,
    "is_managed": false,
    "is_trashed": false,
    "parent_directory": [
      "1942b436-4932-433c-8549-8c097875c739",
      1,
      false
    ],
    "dependencies": []
  }
},
{
  "model": "desktop.document2",
  "pk": 164889,
  "fields": {
    "owner": [
      "tsevero"
    ],
    "name": "CRED-CANCEL: Criar tbls",
    "description": "",
    "uuid": "17c3e432-1f3a-283e-4fe8-749fb399f545",
    "type": "query-impala",
    "connector": null,
    "data": "{\"id\": 164889, \"uuid\": \"17c3e432-1f3a-283e-4fe8-749fb399f545\", \"name\": \"CRED-CANCEL: Criar tbls\", \"description\": \"\", \"type\": \"query-impala\", \"initialType\": \"impala\", \"coordinatorUuid\": null, \"isHistory\": false, \"isManaged\": false, \"parentSavedQueryUuid\": null, \"isSaved\": true, \"onSuccessUrl\": null, \"pubSubUrl\": null, \"isPresentationModeDefault\": false, \"isPresentationMode\": false, \"isPresentationModeInitialized\": true, \"presentationSnippets\": {}, \"isHidingCode\": false, \"snippets\": [{\"id\": \"78b693f5-17e2-abe0-ec3c-8b403720a6cb\", \"name\": \"\", \"type\": \"impala\", \"connector\": {\"name\": \"Impala\", \"type\": \"impala\", \"id\": \"impala\", \"displayName\": \"Impala\", \"buttonName\": \"Consulta\", \"tooltip\": \"Impala Query\", \"optimizer\": \"off\", \"page\": \"/editor/?type=impala\", \"is_sql\": true, \"is_batchable\": true, \"dialect\": \"impala\", \"dialect_properties\": {}}, \"isSqlDialect\": true, \"dialect\": \"impala\", \"isBatchable\": true, \"autocompleteSettings\": {\"temporaryOnly\": false}, \"aceCursorPosition\": {\"row\": 7, \"column\": 72}, \"errors\": [], \"aceErrorsHolder\": [], \"aceWarningsHolder\": [], \"aceErrors\": [], \"aceWarnings\": [], \"editorMode\": true, \"dbSelectionVisible\": false, \"showExecutionAnalysis\": false, \"namespace\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"status\": \"CREATED\", \"computes\": [{\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"type\": \"direct\", \"credentials\": {}}]}, \"compute\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"namespace\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"interface\": \"impala\", \"type\": \"direct\", \"options\": {}}, \"database\": \"default\", \"currentQueryTab\": \"savedQueries\", \"pinnedContextTabs\": [], \"loadingQueries\": false, \"queriesHasErrors\": false, \"queriesCurrentPage\": 1, \"queriesTotalPages\": 3, \"queriesFilter\": \"\", \"queriesFilterVisible\": false, \"statementType\": \"text\", \"statementTypes\": [\"text\", \"file\"], \"statementPath\": \"\", \"externalStatementLoaded\": false, \"associatedDocumentLoading\": true, \"associatedDocumentUuid\": null, \"statement_raw\": \"-- =====================================================================\\r\\n-- AN\\u00c1LISE CONSOLIDADA DE CR\\u00c9DITO DIME COM ENRIQUECIMENTO INTEGRADO\\r\\n-- Vers\\u00e3o Expandida - 12 e 60 meses\\r\\n-- =====================================================================\\r\\n\\r\\n-- ---------------------------------------------------------------------\\r\\n-- 1. TABELA PRINCIPAL CONSOLIDADA - teste.credito_dime_completo\\r\\n-- ---------------------------------------------------------------------\\r\\nDROP TABLE IF EXISTS teste.credito_dime_completo;\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\nCREATE TABLE IF NOT EXISTS teste.credito_dime_completo AS\\r\\n\\r\\nWITH periodos AS (\\r\\n  SELECT periodo AS nu_per_ref\\r\\n  FROM (\\r\\n    -- 2020 (\\u00faltimos 4 meses)\\r\\n    SELECT 202009 AS periodo UNION ALL SELECT 202010 UNION ALL SELECT 202011 UNION ALL SELECT 202012 UNION ALL\\r\\n    -- 2021\\r\\n    SELECT 202101 AS periodo UNION ALL SELECT 202102 UNION ALL SELECT 202103 UNION ALL SELECT 202104 UNION ALL\\r\\n    SELECT 202105 UNION ALL SELECT 202106 UNION ALL SELECT 202107 UNION ALL SELECT 202108 UNION ALL\\r\\n    SELECT 202109 UNION ALL SELECT 202110 UNION ALL SELECT 202111 UNION ALL SELECT 202112 UNION ALL\\r\\n    -- 2022\\r\\n    SELECT 202201 UNION ALL SELECT 202202 UNION ALL SELECT 202203 UNION ALL SELECT 202204 UNION ALL\\r\\n    SELECT 202205 UNION ALL SELECT 202206 UNION ALL SELECT 202207 UNION ALL SELECT 202208 UNION ALL\\r\\n    SELECT 202209 UNION ALL SELECT 202210 UNION ALL SELECT 202211 UNION ALL SELECT 202212 UNION ALL\\r\\n    -- 2023\\r\\n    SELECT 202301 UNION ALL SELECT 202302 UNION ALL SELECT 202303 UNION ALL SELECT 202304 UNION ALL\\r\\n    SELECT 202305 UNION ALL SELECT 202306 UNION ALL SELECT 202307 UNION ALL SELECT 202308 UNION ALL\\r\\n    SELECT 202309 UNION ALL SELECT 202310 UNION ALL SELECT 202311 UNION ALL SELECT 202312 UNION ALL\\r\\n    -- 2024\\r\\n    SELECT 202401 UNION ALL SELECT 202402 UNION ALL SELECT 202403 UNION ALL SELECT 202404 UNION ALL\\r\\n    SELECT 202405 UNION ALL SELECT 202406 UNION ALL SELECT 202407 UNION ALL SELECT 202408 UNION ALL\\r\\n    SELECT 202409 UNION ALL SELECT 202410 UNION ALL SELECT 202411 UNION ALL SELECT 202412 UNION ALL\\r\\n    -- 2025\\r\\n    SELECT 202501 UNION ALL SELECT 202502 UNION ALL SELECT 202503 UNION ALL SELECT 202504 UNION ALL\\r\\n    SELECT 202505 UNION ALL SELECT 202506 UNION ALL SELECT 202507 UNION ALL SELECT 202508 UNION ALL\\r\\n    SELECT 202509\\r\\n  ) p\\r\\n),\\r\\n\\r\\ndados_filtrados AS (\\r\\n  SELECT \\r\\n    d.nu_cnpj,\\r\\n    d.nu_per_ref,\\r\\n    d.vl_cred_mes_anterior,\\r\\n    d.vl_cred_mes_seguinte\\r\\n  FROM \\r\\n    usr_sat_ods.ods_decl_dime_raw d\\r\\n  WHERE \\r\\n    d.nu_per_ref IN (SELECT nu_per_ref FROM periodos)\\r\\n    AND d.vl_cred_mes_anterior > 0\\r\\n    AND d.vl_cred_mes_seguinte > 0\\r\\n),\\r\\n\\r\\n-- =====================================================================\\r\\n-- AN\\u00c1LISES DE VALORES IGUAIS - HIST\\u00d3RICO COMPLETO (60 MESES)\\r\\n-- =====================================================================\\r\\nvalores_iguais_base AS (\\r\\n  SELECT\\r\\n    nu_cnpj,\\r\\n    nu_per_ref,\\r\\n    vl_cred_mes_anterior AS valor\\r\\n  FROM \\r\\n    dados_filtrados\\r\\n  WHERE \\r\\n    vl_cred_mes_anterior = vl_cred_mes_seguinte\\r\\n),\\r\\n\\r\\ncontagem_iguais_60m AS (\\r\\n  SELECT\\r\\n    nu_cnpj,\\r\\n    COUNT(*) AS contagem_periodos_iguais_60m,\\r\\n    AVG(valor) AS valor_medio_repetido_60m,\\r\\n    MIN(nu_per_ref) AS primeiro_periodo_igual_60m,\\r\\n    MAX(nu_per_ref) AS ultimo_periodo_igual_60m\\r\\n  FROM \\r\\n    valores_iguais_base\\r\\n  GROUP BY \\r\\n    nu_cnpj\\r\\n),\\r\\n\\r\\ncontagem_iguais_12m AS (\\r\\n  SELECT\\r\\n    nu_cnpj,\\r\\n    COUNT(*) AS contagem_periodos_iguais_12m,\\r\\n    AVG(valor) AS valor_medio_repetido_12m,\\r\\n    MIN(nu_per_ref) AS primeiro_periodo_igual_12m,\\r\\n    MAX(nu_per_ref) AS ultimo_periodo_igual_12m\\r\\n  FROM \\r\\n    valores_iguais_base\\r\\n  WHERE \\r\\n    nu_per_ref >= 202509 - 100  -- \\u00daltimos 12 meses aproximadamente\\r\\n  GROUP BY \\r\\n    nu_cnpj\\r\\n),\\r\\n\\r\\n-- Sequ\\u00eancia dos \\u00faltimos meses (12 meses)\\r\\nsequencia_ultimos_12m AS (\\r\\n  SELECT\\r\\n    vi.nu_cnpj,\\r\\n    COUNT(*) AS qtde_ultimos_12m_iguais,\\r\\n    MIN(vi.nu_per_ref) AS periodo_inicial_seq_12m,\\r\\n    MAX(vi.nu_per_ref) AS periodo_final_seq_12m,\\r\\n    AVG(vi.valor) AS valor_sequencia_12m\\r\\n  FROM \\r\\n    valores_iguais_base vi\\r\\n  WHERE \\r\\n    vi.nu_per_ref >= 202409  -- \\u00daltimos 12 meses\\r\\n  GROUP BY \\r\\n    vi.nu_cnpj\\r\\n  HAVING COUNT(*) >= 3\\r\\n),\\r\\n\\r\\n-- =====================================================================\\r\\n-- SALDO CREDOR E EVOLU\\u00c7\\u00c3O\\r\\n-- =====================================================================\\r\\nsaldo_credor_atual AS (\\r\\n  SELECT \\r\\n    c.nu_cnpj_grupo,\\r\\n    c.nu_cnpj,\\r\\n    MAX(d.vl_cred_mes_seguinte) AS saldo_credor_acumulado_atual\\r\\n  FROM \\r\\n    usr_sat_ods.ods_decl_dime_raw d\\r\\n  JOIN \\r\\n    usr_sat_ods.vw_ods_contrib c ON d.nu_cnpj = c.nu_cnpj\\r\\n  WHERE \\r\\n    d.nu_per_ref = 202509\\r\\n  GROUP BY \\r\\n    c.nu_cnpj_grupo, c.nu_cnpj\\r\\n),\\r\\n\\r\\n-- Evolu\\u00e7\\u00e3o 12 meses\\r\\nevolucao_saldo_12m AS (\\r\\n  SELECT \\r\\n    c.nu_cnpj_grupo,\\r\\n    MAX(CASE WHEN d.nu_per_ref = 202409 THEN d.vl_cred_mes_seguinte ELSE NULL END) AS saldo_12m_atras,\\r\\n    MAX(CASE WHEN d.nu_per_ref = 202509 THEN d.vl_cred_mes_seguinte ELSE NULL END) AS saldo_atual\\r\\n  FROM \\r\\n    usr_sat_ods.ods_decl_dime_raw d\\r\\n  JOIN \\r\\n    usr_sat_ods.vw_ods_contrib c ON d.nu_cnpj = c.nu_cnpj\\r\\n  WHERE \\r\\n    d.nu_per_ref IN (202409, 202509)\\r\\n  GROUP BY \\r\\n    c.nu_cnpj_grupo\\r\\n),\\r\\n\\r\\ncrescimento_saldo_12m AS (\\r\\n  SELECT\\r\\n    nu_cnpj_grupo,\\r\\n    saldo_12m_atras,\\r\\n    saldo_atual,\\r\\n    COALESCE(saldo_atual, 0) - COALESCE(saldo_12m_atras, 0) AS crescimento_absoluto_12m,\\r\\n    CASE \\r\\n      WHEN saldo_12m_atras > 0 THEN\\r\\n        ROUND(100.0 * (COALESCE(saldo_atual, 0) - saldo_12m_atras) / NULLIF(saldo_12m_atras, 0), 2)\\r\\n      ELSE 0\\r\\n    END AS crescimento_percentual_12m\\r\\n  FROM \\r\\n    evolucao_saldo_12m\\r\\n),\\r\\n\\r\\n-- Evolu\\u00e7\\u00e3o 60 meses\\r\\nevolucao_saldo_60m AS (\\r\\n  SELECT \\r\\n    c.nu_cnpj_grupo,\\r\\n    MAX(CASE WHEN d.nu_per_ref = 202009 THEN d.vl_cred_mes_seguinte ELSE NULL END) AS saldo_60m_atras,\\r\\n    MAX(CASE WHEN d.nu_per_ref = 202509 THEN d.vl_cred_mes_seguinte ELSE NULL END) AS saldo_atual\\r\\n  FROM \\r\\n    usr_sat_ods.ods_decl_dime_raw d\\r\\n  JOIN \\r\\n    usr_sat_ods.vw_ods_contrib c ON d.nu_cnpj = c.nu_cnpj\\r\\n  WHERE \\r\\n    d.nu_per_ref IN (202009, 202509)\\r\\n  GROUP BY \\r\\n    c.nu_cnpj_grupo\\r\\n),\\r\\n\\r\\ncrescimento_saldo_60m AS (\\r\\n  SELECT\\r\\n    nu_cnpj_grupo,\\r\\n    saldo_60m_atras,\\r\\n    saldo_atual AS saldo_atual_60m,\\r\\n    COALESCE(saldo_atual, 0) - COALESCE(saldo_60m_atras, 0) AS crescimento_absoluto_60m,\\r\\n    CASE \\r\\n      WHEN saldo_60m_atras > 0 THEN\\r\\n        ROUND(100.0 * (COALESCE(saldo_atual, 0) - saldo_60m_atras) / NULLIF(saldo_60m_atras, 0), 2)\\r\\n      ELSE 0\\r\\n    END AS crescimento_percentual_60m\\r\\n  FROM \\r\\n    evolucao_saldo_60m\\r\\n),\\r\\n\\r\\n-- =====================================================================\\r\\n-- CR\\u00c9DITOS PRESUMIDOS\\r\\n-- =====================================================================\\r\\ncreditos_presumidos_12m AS (\\r\\n  SELECT \\r\\n    dcip.nu_cnpj_grupo,\\r\\n    SUM(dcip.vl_credito) AS vl_cp_total_12m,\\r\\n    COUNT(dcip.cd_tipo_credito) AS qtde_tipos_cp_12m\\r\\n  FROM \\r\\n    usr_sat_ods.vw_ods_dcip dcip\\r\\n  WHERE \\r\\n    dcip.cd_estado_decl = 1\\r\\n    AND dcip.sn_utilizada_dime = 1\\r\\n    AND dcip.cd_grupo_dcip = 3\\r\\n    AND dcip.nu_per_ref BETWEEN 202409 AND 202509\\r\\n  GROUP BY \\r\\n    dcip.nu_cnpj_grupo\\r\\n),\\r\\n\\r\\ncreditos_presumidos_60m AS (\\r\\n  SELECT \\r\\n    dcip.nu_cnpj_grupo,\\r\\n    SUM(dcip.vl_credito) AS vl_cp_total_60m,\\r\\n    COUNT(dcip.cd_tipo_credito) AS qtde_tipos_cp_60m,\\r\\n    COUNT(DISTINCT dcip.nu_per_ref) AS meses_com_cp_60m\\r\\n  FROM \\r\\n    usr_sat_ods.vw_ods_dcip dcip\\r\\n  WHERE \\r\\n    dcip.cd_estado_decl = 1\\r\\n    AND dcip.sn_utilizada_dime = 1\\r\\n    AND dcip.cd_grupo_dcip = 3\\r\\n    AND dcip.nu_per_ref >= 202009  -- \\u00daltimos 60 meses\\r\\n  GROUP BY \\r\\n    dcip.nu_cnpj_grupo\\r\\n),\\r\\n\\r\\n-- =====================================================================\\r\\n-- ESTAT\\u00cdSTICAS DE CR\\u00c9DITOS\\r\\n-- =====================================================================\\r\\nestatisticas_creditos_12m AS (\\r\\n  SELECT\\r\\n    nu_cnpj,\\r\\n    COUNT(nu_per_ref) AS qtde_meses_declarados_12m,\\r\\n    AVG(vl_cred_mes_anterior) AS media_credito_12m,\\r\\n    MIN(vl_cred_mes_anterior) AS min_credito_12m,\\r\\n    MAX(vl_cred_mes_anterior) AS max_credito_12m,\\r\\n    STDDEV(vl_cred_mes_anterior) AS desvio_padrao_credito_12m\\r\\n  FROM dados_filtrados\\r\\n  WHERE nu_per_ref BETWEEN 202409 AND 202509\\r\\n  GROUP BY nu_cnpj\\r\\n),\\r\\n\\r\\nestatisticas_creditos_60m AS (\\r\\n  SELECT\\r\\n    nu_cnpj,\\r\\n    COUNT(nu_per_ref) AS qtde_meses_declarados_60m,\\r\\n    AVG(vl_cred_mes_anterior) AS media_credito_60m,\\r\\n    MIN(vl_cred_mes_anterior) AS min_credito_60m,\\r\\n    MAX(vl_cred_mes_anterior) AS max_credito_60m,\\r\\n    STDDEV(vl_cred_mes_anterior) AS desvio_padrao_credito_60m,\\r\\n    SUM(vl_cred_mes_anterior) AS total_credito_acumulado_60m\\r\\n  FROM dados_filtrados\\r\\n  WHERE nu_per_ref >= 202009  -- \\u00daltimos 60 meses\\r\\n  GROUP BY nu_cnpj\\r\\n),\\r\\n\\r\\n-- =====================================================================\\r\\n-- DADOS DE ENRIQUECIMENTO (CANCELAMENTO/SUSPEITAS)\\r\\n-- =====================================================================\\r\\ndados_recolhimento AS (\\r\\n  SELECT\\r\\n    REGEXP_REPLACE(TRIM(CAST(cnpj AS STRING)), '[^0-9]', '') AS cnpj_limpo,\\r\\n    MAX(COALESCE(quantidade_pagtos, 0)) AS quantidade_pagtos,\\r\\n    MAX(COALESCE(valor_pagtos, 0)) AS valor_pagtos\\r\\n  FROM teste.cancel_recolhimento\\r\\n  GROUP BY REGEXP_REPLACE(TRIM(CAST(cnpj AS STRING)), '[^0-9]', '')\\r\\n),\\r\\n\\r\\ndados_zero_normal AS (\\r\\n  SELECT\\r\\n    REGEXP_REPLACE(TRIM(CAST(nu_cnpj AS STRING)), '[^0-9]', '') AS cnpj_limpo,\\r\\n    MAX(nm_contador) AS contador_normal,\\r\\n    MAX(total_vl_faturamento) AS total_vl_faturamento,\\r\\n    MAX(total_vl_receita_bruta) AS total_vl_receita_bruta,\\r\\n    MAX(total_vl_tot_cred) AS total_vl_tot_cred,\\r\\n    MAX(total_vl_tot_deb) AS total_vl_tot_deb,\\r\\n    MAX(total_vl_deb_recolher) AS total_vl_deb_recolher,\\r\\n    MAX(dt_constituicao_empresa) AS dt_constituicao_normal,\\r\\n    MAX(total_nfes_emitidas) AS nfes_emitidas_normal,\\r\\n    MAX(periodos_omissos) AS periodos_omissos_normal,\\r\\n    MAX(periodos_zerados) AS periodos_zerados_normal,\\r\\n    MAX(total_periodos) AS total_periodos_normal,\\r\\n    MAX(periodos_declarados) AS periodos_declarados_normal\\r\\n  FROM teste.cancel_zero_normal\\r\\n  GROUP BY REGEXP_REPLACE(TRIM(CAST(nu_cnpj AS STRING)), '[^0-9]', '')\\r\\n),\\r\\n\\r\\ndados_zero_simples AS (\\r\\n  SELECT\\r\\n    REGEXP_REPLACE(TRIM(CAST(nu_cnpj AS STRING)), '[^0-9]', '') AS cnpj_limpo,\\r\\n    MAX(nm_contador) AS contador_simples,\\r\\n    MAX(total_vl_rec_bruta) AS total_vl_rec_bruta,\\r\\n    MAX(max_vl_rec_bruta_em_12m) AS max_vl_rec_bruta_em_12m,\\r\\n    MAX(total_vl_rec_bruta_no_ano) AS total_vl_rec_bruta_no_ano,\\r\\n    MAX(total_vl_icms_sc) AS total_vl_icms_sc,\\r\\n    MAX(dt_constituicao_empresa) AS dt_constituicao_simples,\\r\\n    MAX(total_nfes_emitidas) AS nfes_emitidas_simples,\\r\\n    MAX(periodos_omissos) AS periodos_omissos_simples,\\r\\n    MAX(periodos_zerados) AS periodos_zerados_simples,\\r\\n    MAX(total_periodos) AS total_periodos_simples,\\r\\n    MAX(periodos_declarados) AS periodos_declarados_simples\\r\\n  FROM teste.cancel_zero_simples\\r\\n  GROUP BY REGEXP_REPLACE(TRIM(CAST(nu_cnpj AS STRING)), '[^0-9]', '')\\r\\n),\\r\\n\\r\\ndados_suspeitas AS (\\r\\n  SELECT\\r\\n    REGEXP_REPLACE(TRIM(CAST(cnpj AS STRING)), '[^0-9]', '') AS cnpj_limpo,\\r\\n    MAX(cd_situacao_suspeita) AS cd_situacao_suspeita,\\r\\n    MAX(dt_situacao_suspeita) AS dt_situacao_suspeita,\\r\\n    MAX(nu_score) AS score_suspeita,\\r\\n    MAX(qt_motivos) AS qt_motivos,\\r\\n    MAX(cd_tipo_confirmacao) AS cd_tipo_confirmacao,\\r\\n    MAX(sn_cancelado_inex_inativ) AS sn_cancelado_inex_inativ,\\r\\n    MAX(dt_inicio_protoc_cancelamento) AS dt_inicio_protoc_cancelamento,\\r\\n    MAX(tx_obs_situacao_suspeita) AS tx_obs_situacao_suspeita,\\r\\n    MAX(nu_score_ia) AS nu_score_ia,\\r\\n    MAX(qt_meses_valores) AS qt_meses_valores,\\r\\n    MAX(vl_total_nfes_saida) AS vl_nfes_saida_suspeita,\\r\\n    MAX(vl_total_icms_nfes_saida) AS vl_total_icms_nfes_saida,\\r\\n    MAX(vl_total_nfes_entrada) AS vl_nfes_entrada_suspeita,\\r\\n    MAX(vl_total_icms_nfes_entrada) AS vl_total_icms_nfes_entrada,\\r\\n    MAX(vl_total_arrecadacao_grupo) AS vl_total_arrecadacao_grupo,\\r\\n    MAX(qt_clientes_noteiras) AS qt_clientes_noteiras,\\r\\n    MAX(qt_fornecedoras_noteiras) AS qt_fornecedoras_noteiras,\\r\\n    MAX(sn_suspenso_dfe) AS sn_suspenso_dfe,\\r\\n    MAX(dt_suspensao_dfe_suspeita) AS dt_suspensao_dfe_suspeita\\r\\n  FROM teste.cancel_suspeitas\\r\\n  GROUP BY REGEXP_REPLACE(TRIM(CAST(cnpj AS STRING)), '[^0-9]', '')\\r\\n),\\r\\n\\r\\ndados_indicios AS (\\r\\n  SELECT\\r\\n    REGEXP_REPLACE(TRIM(CAST(cnpj AS STRING)), '[^0-9]', '') AS cnpj_limpo,\\r\\n    COUNT(DISTINCT cd_indicio) AS qtde_indicios_fraude,\\r\\n    SUM(COALESCE(score_indicio, 0)) AS soma_score_indicios\\r\\n  FROM teste.cancel_suspeitas_score\\r\\n  GROUP BY REGEXP_REPLACE(TRIM(CAST(cnpj AS STRING)), '[^0-9]', '')\\r\\n),\\r\\n\\r\\ncnpjs_unicos AS (\\r\\n  SELECT nu_cnpj \\r\\n  FROM dados_filtrados \\r\\n  GROUP BY nu_cnpj\\r\\n)\\r\\n\\r\\n-- =====================================================================\\r\\n-- SELECT PRINCIPAL COM TODAS AS M\\u00c9TRICAS\\r\\n-- =====================================================================\\r\\nSELECT \\r\\n  -- Identifica\\u00e7\\u00e3o\\r\\n  df.nu_cnpj,\\r\\n  c.nm_razao_social,\\r\\n  c.nm_fantasia,\\r\\n  c.nm_sit_cadastral,\\r\\n  c.nm_gerfe,\\r\\n  c.de_cnae,\\r\\n  c.nu_cnpj_grupo,\\r\\n  \\r\\n  -- ===================================================================\\r\\n  -- AN\\u00c1LISE DE VALORES IGUAIS - 60 MESES\\r\\n  -- ===================================================================\\r\\n  COALESCE(ci60.contagem_periodos_iguais_60m, 0) AS valor_igual_total_periodos_60m,\\r\\n  ROUND(COALESCE(ci60.valor_medio_repetido_60m, 0), 2) AS valor_medio_repetido_60m,\\r\\n  CAST(COALESCE(ci60.primeiro_periodo_igual_60m, 0) AS STRING) AS primeiro_periodo_valor_igual_60m,\\r\\n  CAST(COALESCE(ci60.ultimo_periodo_igual_60m, 0) AS STRING) AS ultimo_periodo_valor_igual_60m,\\r\\n  \\r\\n  -- AN\\u00c1LISE DE VALORES IGUAIS - 12 MESES\\r\\n  COALESCE(ci12.contagem_periodos_iguais_12m, 0) AS valor_igual_total_periodos_12m,\\r\\n  ROUND(COALESCE(ci12.valor_medio_repetido_12m, 0), 2) AS valor_medio_repetido_12m,\\r\\n  CAST(COALESCE(ci12.primeiro_periodo_igual_12m, 0) AS STRING) AS primeiro_periodo_valor_igual_12m,\\r\\n  CAST(COALESCE(ci12.ultimo_periodo_igual_12m, 0) AS STRING) AS ultimo_periodo_valor_igual_12m,\\r\\n  \\r\\n  -- SEQU\\u00caNCIA RECENTE (12 MESES)\\r\\n  COALESCE(seq12.qtde_ultimos_12m_iguais, 0) AS qtde_ultimos_12m_iguais,\\r\\n  CAST(COALESCE(seq12.periodo_inicial_seq_12m, 0) AS STRING) AS periodo_inicial_sequencia_12m,\\r\\n  CAST(COALESCE(seq12.periodo_final_seq_12m, 0) AS STRING) AS periodo_final_sequencia_12m,\\r\\n  ROUND(COALESCE(seq12.valor_sequencia_12m, 0), 2) AS valor_sequencia_12m,\\r\\n  \\r\\n  -- ===================================================================\\r\\n  -- ESTAT\\u00cdSTICAS DE CR\\u00c9DITOS - 12 MESES\\r\\n  -- ===================================================================\\r\\n  COALESCE(est12.qtde_meses_declarados_12m, 0) AS qtde_meses_declarados_12m,\\r\\n  ROUND(COALESCE(est12.media_credito_12m, 0), 2) AS media_credito_12m,\\r\\n  ROUND(COALESCE(est12.min_credito_12m, 0), 2) AS min_credito_12m,\\r\\n  ROUND(COALESCE(est12.max_credito_12m, 0), 2) AS max_credito_12m,\\r\\n  ROUND(COALESCE(est12.desvio_padrao_credito_12m, 0), 2) AS desvio_padrao_credito_12m,\\r\\n  \\r\\n  -- ESTAT\\u00cdSTICAS DE CR\\u00c9DITOS - 60 MESES\\r\\n  COALESCE(est60.qtde_meses_declarados_60m, 0) AS qtde_meses_declarados_60m,\\r\\n  ROUND(COALESCE(est60.media_credito_60m, 0), 2) AS media_credito_60m,\\r\\n  ROUND(COALESCE(est60.min_credito_60m, 0), 2) AS min_credito_60m,\\r\\n  ROUND(COALESCE(est60.max_credito_60m, 0), 2) AS max_credito_60m,\\r\\n  ROUND(COALESCE(est60.desvio_padrao_credito_60m, 0), 2) AS desvio_padrao_credito_60m,\\r\\n  ROUND(COALESCE(est60.total_credito_acumulado_60m, 0), 2) AS total_credito_acumulado_60m,\\r\\n  \\r\\n  -- ===================================================================\\r\\n  -- SALDO CREDOR E EVOLU\\u00c7\\u00c3O\\r\\n  -- ===================================================================\\r\\n  ROUND(COALESCE(saldo.saldo_credor_acumulado_atual, 0), 2) AS saldo_credor_atual,\\r\\n  \\r\\n  -- Evolu\\u00e7\\u00e3o 12 meses\\r\\n  ROUND(COALESCE(cresc12.saldo_12m_atras, 0), 2) AS saldo_12m_atras,\\r\\n  ROUND(COALESCE(cresc12.crescimento_absoluto_12m, 0), 2) AS crescimento_saldo_absoluto_12m,\\r\\n  ROUND(COALESCE(cresc12.crescimento_percentual_12m, 0), 2) AS crescimento_saldo_percentual_12m,\\r\\n  \\r\\n  -- Evolu\\u00e7\\u00e3o 60 meses\\r\\n  ROUND(COALESCE(cresc60.saldo_60m_atras, 0), 2) AS saldo_60m_atras,\\r\\n  ROUND(COALESCE(cresc60.crescimento_absoluto_60m, 0), 2) AS crescimento_saldo_absoluto_60m,\\r\\n  ROUND(COALESCE(cresc60.crescimento_percentual_60m, 0), 2) AS crescimento_saldo_percentual_60m,\\r\\n  \\r\\n  -- ===================================================================\\r\\n  -- CR\\u00c9DITOS PRESUMIDOS\\r\\n  -- ===================================================================\\r\\n  ROUND(COALESCE(cp12.vl_cp_total_12m, 0), 2) AS vl_credito_presumido_12m,\\r\\n  COALESCE(cp12.qtde_tipos_cp_12m, 0) AS qtde_tipos_cp_12m,\\r\\n  \\r\\n  ROUND(COALESCE(cp60.vl_cp_total_60m, 0), 2) AS vl_credito_presumido_60m,\\r\\n  COALESCE(cp60.qtde_tipos_cp_60m, 0) AS qtde_tipos_cp_60m,\\r\\n  COALESCE(cp60.meses_com_cp_60m, 0) AS meses_com_cp_60m,\\r\\n  \\r\\n  -- ===================================================================\\r\\n  -- SCORES DE RISCO\\r\\n  -- ===================================================================\\r\\n  \\r\\n  -- Score de Risco Base - 12 meses\\r\\n  (\\r\\n    CASE \\r\\n      WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 12 THEN 40\\r\\n      WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 6 THEN 30\\r\\n      WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 3 THEN 15\\r\\n      ELSE 0\\r\\n    END\\r\\n    +\\r\\n    CASE\\r\\n      WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 100 THEN 30\\r\\n      WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 50 THEN 20\\r\\n      WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 25 THEN 10\\r\\n      ELSE 0\\r\\n    END\\r\\n    +\\r\\n    CASE\\r\\n      WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 1000000 THEN 20\\r\\n      WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 500000 THEN 15\\r\\n      WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 100000 THEN 10\\r\\n      WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 50000 THEN 5\\r\\n      ELSE 0\\r\\n    END\\r\\n    +\\r\\n    CASE\\r\\n      WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 100 AND COALESCE(est12.media_credito_12m, 0) > 1000 THEN 10\\r\\n      WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 500 AND COALESCE(est12.media_credito_12m, 0) > 5000 THEN 5\\r\\n      ELSE 0\\r\\n    END\\r\\n  ) AS score_risco_12m,\\r\\n  \\r\\n  -- Score de Risco Base - 60 meses\\r\\n  (\\r\\n    CASE \\r\\n      WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 48 THEN 50\\r\\n      WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 36 THEN 40\\r\\n      WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 24 THEN 30\\r\\n      WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 12 THEN 20\\r\\n      ELSE 0\\r\\n    END\\r\\n    +\\r\\n    CASE\\r\\n      WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 500 THEN 40\\r\\n      WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 300 THEN 30\\r\\n      WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 150 THEN 20\\r\\n      WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 75 THEN 10\\r\\n      ELSE 0\\r\\n    END\\r\\n    +\\r\\n    CASE\\r\\n      WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 200 AND COALESCE(est60.media_credito_60m, 0) > 5000 THEN 15\\r\\n      WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 500 AND COALESCE(est60.media_credito_60m, 0) > 2000 THEN 10\\r\\n      ELSE 0\\r\\n    END\\r\\n    +\\r\\n    CASE\\r\\n      WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 5000000 THEN 25\\r\\n      WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 2000000 THEN 20\\r\\n      WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 1000000 THEN 15\\r\\n      WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 500000 THEN 10\\r\\n      ELSE 0\\r\\n    END\\r\\n  ) AS score_risco_60m,\\r\\n  \\r\\n  -- Classifica\\u00e7\\u00e3o de Risco - 12 meses\\r\\n  CASE\\r\\n    WHEN (\\r\\n      CASE WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 12 THEN 40 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 6 THEN 30 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 3 THEN 15 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 100 THEN 30 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 50 THEN 20 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 25 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 1000000 THEN 20 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 500000 THEN 15 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 100000 THEN 10 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 50000 THEN 5 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 100 AND COALESCE(est12.media_credito_12m, 0) > 1000 THEN 10 WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 500 AND COALESCE(est12.media_credito_12m, 0) > 5000 THEN 5 ELSE 0 END\\r\\n    ) >= 70 THEN 'CR\\u00cdTICO'\\r\\n    WHEN (\\r\\n      CASE WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 12 THEN 40 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 6 THEN 30 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 3 THEN 15 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 100 THEN 30 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 50 THEN 20 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 25 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 1000000 THEN 20 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 500000 THEN 15 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 100000 THEN 10 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 50000 THEN 5 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 100 AND COALESCE(est12.media_credito_12m, 0) > 1000 THEN 10 WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 500 AND COALESCE(est12.media_credito_12m, 0) > 5000 THEN 5 ELSE 0 END\\r\\n    ) >= 50 THEN 'ALTO'\\r\\n    WHEN (\\r\\n      CASE WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 12 THEN 40 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 6 THEN 30 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 3 THEN 15 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 100 THEN 30 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 50 THEN 20 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 25 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 1000000 THEN 20 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 500000 THEN 15 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 100000 THEN 10 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 50000 THEN 5 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 100 AND COALESCE(est12.media_credito_12m, 0) > 1000 THEN 10 WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 500 AND COALESCE(est12.media_credito_12m, 0) > 5000 THEN 5 ELSE 0 END\\r\\n    ) >= 30 THEN 'M\\u00c9DIO'\\r\\n    ELSE 'BAIXO'\\r\\n  END AS classificacao_risco_12m,\\r\\n  \\r\\n  -- Classifica\\u00e7\\u00e3o de Risco - 60 meses\\r\\n  CASE\\r\\n    WHEN (\\r\\n      CASE WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 48 THEN 50 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 36 THEN 40 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 24 THEN 30 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 12 THEN 20 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 500 THEN 40 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 300 THEN 30 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 150 THEN 20 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 75 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 200 AND COALESCE(est60.media_credito_60m, 0) > 5000 THEN 15 WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 500 AND COALESCE(est60.media_credito_60m, 0) > 2000 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 5000000 THEN 25 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 2000000 THEN 20 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 1000000 THEN 15 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 500000 THEN 10 ELSE 0 END\\r\\n    ) >= 90 THEN 'CR\\u00cdTICO'\\r\\n    WHEN (\\r\\n      CASE WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 48 THEN 50 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 36 THEN 40 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 24 THEN 30 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 12 THEN 20 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 500 THEN 40 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 300 THEN 30 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 150 THEN 20 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 75 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 200 AND COALESCE(est60.media_credito_60m, 0) > 5000 THEN 15 WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 500 AND COALESCE(est60.media_credito_60m, 0) > 2000 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 5000000 THEN 25 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 2000000 THEN 20 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 1000000 THEN 15 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 500000 THEN 10 ELSE 0 END\\r\\n    ) >= 60 THEN 'ALTO'\\r\\n    WHEN (\\r\\n      CASE WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 48 THEN 50 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 36 THEN 40 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 24 THEN 30 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 12 THEN 20 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 500 THEN 40 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 300 THEN 30 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 150 THEN 20 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 75 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 200 AND COALESCE(est60.media_credito_60m, 0) > 5000 THEN 15 WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 500 AND COALESCE(est60.media_credito_60m, 0) > 2000 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 5000000 THEN 25 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 2000000 THEN 20 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 1000000 THEN 15 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 500000 THEN 10 ELSE 0 END\\r\\n    ) >= 35 THEN 'M\\u00c9DIO'\\r\\n    ELSE 'BAIXO'\\r\\n  END AS classificacao_risco_60m,\\r\\n  \\r\\n  -- ===================================================================\\r\\n  -- DADOS DE ENRIQUECIMENTO\\r\\n  -- ===================================================================\\r\\n  \\r\\n  -- Dados de Recolhimento\\r\\n  COALESCE(dr.quantidade_pagtos, 0) AS quantidade_pagtos,\\r\\n  ROUND(COALESCE(dr.valor_pagtos, 0), 2) AS valor_pagtos,\\r\\n  \\r\\n  -- Dados de Declara\\u00e7\\u00f5es Zeradas - NORMAL\\r\\n  dzn.contador_normal,\\r\\n  ROUND(COALESCE(dzn.total_vl_faturamento, 0), 2) AS total_vl_faturamento,\\r\\n  ROUND(COALESCE(dzn.total_vl_receita_bruta, 0), 2) AS total_vl_receita_bruta,\\r\\n  ROUND(COALESCE(dzn.total_vl_tot_cred, 0), 2) AS total_vl_tot_cred,\\r\\n  ROUND(COALESCE(dzn.total_vl_tot_deb, 0), 2) AS total_vl_tot_deb,\\r\\n  ROUND(COALESCE(dzn.total_vl_deb_recolher, 0), 2) AS total_vl_deb_recolher,\\r\\n  dzn.dt_constituicao_normal,\\r\\n  COALESCE(dzn.nfes_emitidas_normal, 0) AS nfes_emitidas_normal,\\r\\n  COALESCE(dzn.periodos_omissos_normal, 0) AS periodos_omissos_normal,\\r\\n  COALESCE(dzn.periodos_zerados_normal, 0) AS periodos_zerados_normal,\\r\\n  COALESCE(dzn.total_periodos_normal, 0) AS total_periodos_normal,\\r\\n  COALESCE(dzn.periodos_declarados_normal, 0) AS periodos_declarados_normal,\\r\\n  \\r\\n  -- Dados de Declara\\u00e7\\u00f5es Zeradas - SIMPLES\\r\\n  dzs.contador_simples,\\r\\n  ROUND(COALESCE(dzs.total_vl_rec_bruta, 0), 2) AS total_vl_rec_bruta,\\r\\n  ROUND(COALESCE(dzs.max_vl_rec_bruta_em_12m, 0), 2) AS max_vl_rec_bruta_em_12m,\\r\\n  ROUND(COALESCE(dzs.total_vl_rec_bruta_no_ano, 0), 2) AS total_vl_rec_bruta_no_ano,\\r\\n  ROUND(COALESCE(dzs.total_vl_icms_sc, 0), 2) AS total_vl_icms_sc,\\r\\n  dzs.dt_constituicao_simples,\\r\\n  COALESCE(dzs.nfes_emitidas_simples, 0) AS nfes_emitidas_simples,\\r\\n  COALESCE(dzs.periodos_omissos_simples, 0) AS periodos_omissos_simples,\\r\\n  COALESCE(dzs.periodos_zerados_simples, 0) AS periodos_zerados_simples,\\r\\n  COALESCE(dzs.total_periodos_simples, 0) AS total_periodos_simples,\\r\\n  COALESCE(dzs.periodos_declarados_simples, 0) AS periodos_declarados_simples,\\r\\n  \\r\\n  -- Dados de Suspeitas\\r\\n  ds.cd_situacao_suspeita,\\r\\n  ds.dt_situacao_suspeita,\\r\\n  COALESCE(ds.score_suspeita, 0) AS score_suspeita,\\r\\n  COALESCE(ds.qt_motivos, 0) AS qt_motivos,\\r\\n  ds.cd_tipo_confirmacao,\\r\\n  COALESCE(ds.sn_cancelado_inex_inativ, 0) AS sn_cancelado_inex_inativ,\\r\\n  ds.dt_inicio_protoc_cancelamento,\\r\\n  ds.tx_obs_situacao_suspeita,\\r\\n  COALESCE(ds.nu_score_ia, 0) AS nu_score_ia,\\r\\n  COALESCE(ds.qt_meses_valores, 0) AS qt_meses_valores,\\r\\n  ROUND(COALESCE(ds.vl_nfes_saida_suspeita, 0), 2) AS vl_nfes_saida_suspeita,\\r\\n  ROUND(COALESCE(ds.vl_total_icms_nfes_saida, 0), 2) AS vl_total_icms_nfes_saida,\\r\\n  ROUND(COALESCE(ds.vl_nfes_entrada_suspeita, 0), 2) AS vl_nfes_entrada_suspeita,\\r\\n  ROUND(COALESCE(ds.vl_total_icms_nfes_entrada, 0), 2) AS vl_total_icms_nfes_entrada,\\r\\n  ROUND(COALESCE(ds.vl_total_arrecadacao_grupo, 0), 2) AS vl_total_arrecadacao_grupo,\\r\\n  COALESCE(ds.qt_clientes_noteiras, 0) AS qt_clientes_noteiras,\\r\\n  COALESCE(ds.qt_fornecedoras_noteiras, 0) AS qt_fornecedoras_noteiras,\\r\\n  COALESCE(ds.sn_suspenso_dfe, 0) AS sn_suspenso_dfe,\\r\\n  ds.dt_suspensao_dfe_suspeita,\\r\\n  \\r\\n  -- Contagem de Ind\\u00edcios de Fraude\\r\\n  COALESCE(di.qtde_indicios_fraude, 0) AS qtde_indicios_fraude,\\r\\n  ROUND(COALESCE(di.soma_score_indicios, 0), 2) AS soma_score_indicios,\\r\\n  \\r\\n  -- ===================================================================\\r\\n  -- FLAGS E INDICADORES CONSOLIDADOS\\r\\n  -- ===================================================================\\r\\n  CASE WHEN ds.cd_situacao_suspeita IS NOT NULL THEN 1 ELSE 0 END AS flag_empresa_suspeita,\\r\\n  CASE WHEN COALESCE(dr.quantidade_pagtos, 0) > 0 THEN 1 ELSE 0 END AS flag_tem_pagamentos,\\r\\n  CASE WHEN COALESCE(dzn.periodos_zerados_normal, 0) > 0 OR COALESCE(dzs.periodos_zerados_simples, 0) > 0 THEN 1 ELSE 0 END AS flag_tem_declaracoes_zeradas,\\r\\n  CASE WHEN COALESCE(dzn.periodos_omissos_normal, 0) > 0 OR COALESCE(dzs.periodos_omissos_simples, 0) > 0 THEN 1 ELSE 0 END AS flag_tem_omissoes,\\r\\n  \\r\\n  -- ===================================================================\\r\\n  -- SCORES COMBINADOS (BASE + ENRIQUECIMENTO)\\r\\n  -- ===================================================================\\r\\n  \\r\\n  -- Score Combinado 12 meses\\r\\n  (\\r\\n    -- Score base 12m\\r\\n    (\\r\\n      CASE WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 12 THEN 40 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 6 THEN 30 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 3 THEN 15 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 100 THEN 30 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 50 THEN 20 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 25 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 1000000 THEN 20 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 500000 THEN 15 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 100000 THEN 10 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 50000 THEN 5 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 100 AND COALESCE(est12.media_credito_12m, 0) > 1000 THEN 10 WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 500 AND COALESCE(est12.media_credito_12m, 0) > 5000 THEN 5 ELSE 0 END\\r\\n    )\\r\\n    +\\r\\n    -- Pontos de enriquecimento\\r\\n    CASE WHEN ds.cd_situacao_suspeita IS NOT NULL THEN 30 ELSE 0 END +\\r\\n    CASE WHEN COALESCE(ds.score_suspeita, 0) > 80 THEN 20 WHEN COALESCE(ds.score_suspeita, 0) > 50 THEN 10 ELSE 0 END +\\r\\n    CASE WHEN COALESCE(dzn.periodos_zerados_normal, 0) >= 6 OR COALESCE(dzs.periodos_zerados_simples, 0) >= 6 THEN 15 ELSE 0 END +\\r\\n    CASE WHEN COALESCE(dzn.periodos_omissos_normal, 0) >= 3 OR COALESCE(dzs.periodos_omissos_simples, 0) >= 3 THEN 10 ELSE 0 END +\\r\\n    CASE WHEN COALESCE(ds.sn_cancelado_inex_inativ, 0) = 1 THEN 25 ELSE 0 END +\\r\\n    CASE WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 5 THEN 20 WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 3 THEN 10 ELSE 0 END\\r\\n  ) AS score_risco_combinado_12m,\\r\\n  \\r\\n  -- Score Combinado 60 meses\\r\\n  (\\r\\n    -- Score base 60m\\r\\n    (\\r\\n      CASE WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 48 THEN 50 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 36 THEN 40 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 24 THEN 30 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 12 THEN 20 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 500 THEN 40 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 300 THEN 30 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 150 THEN 20 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 75 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 200 AND COALESCE(est60.media_credito_60m, 0) > 5000 THEN 15 WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 500 AND COALESCE(est60.media_credito_60m, 0) > 2000 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 5000000 THEN 25 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 2000000 THEN 20 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 1000000 THEN 15 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 500000 THEN 10 ELSE 0 END\\r\\n    )\\r\\n    +\\r\\n    -- Pontos de enriquecimento (mesmos do 12m)\\r\\n    CASE WHEN ds.cd_situacao_suspeita IS NOT NULL THEN 30 ELSE 0 END +\\r\\n    CASE WHEN COALESCE(ds.score_suspeita, 0) > 80 THEN 20 WHEN COALESCE(ds.score_suspeita, 0) > 50 THEN 10 ELSE 0 END +\\r\\n    CASE WHEN COALESCE(dzn.periodos_zerados_normal, 0) >= 6 OR COALESCE(dzs.periodos_zerados_simples, 0) >= 6 THEN 15 ELSE 0 END +\\r\\n    CASE WHEN COALESCE(dzn.periodos_omissos_normal, 0) >= 3 OR COALESCE(dzs.periodos_omissos_simples, 0) >= 3 THEN 10 ELSE 0 END +\\r\\n    CASE WHEN COALESCE(ds.sn_cancelado_inex_inativ, 0) = 1 THEN 25 ELSE 0 END +\\r\\n    CASE WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 5 THEN 20 WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 3 THEN 10 ELSE 0 END\\r\\n  ) AS score_risco_combinado_60m,\\r\\n  \\r\\n  -- Classifica\\u00e7\\u00e3o Combinada 12m\\r\\n  CASE\\r\\n    WHEN (\\r\\n      (CASE WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 12 THEN 40 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 6 THEN 30 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 3 THEN 15 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 100 THEN 30 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 50 THEN 20 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 25 THEN 10 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 1000000 THEN 20 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 500000 THEN 15 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 100000 THEN 10 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 50000 THEN 5 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 100 AND COALESCE(est12.media_credito_12m, 0) > 1000 THEN 10 WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 500 AND COALESCE(est12.media_credito_12m, 0) > 5000 THEN 5 ELSE 0 END) +\\r\\n      CASE WHEN ds.cd_situacao_suspeita IS NOT NULL THEN 30 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.score_suspeita, 0) > 80 THEN 20 WHEN COALESCE(ds.score_suspeita, 0) > 50 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_zerados_normal, 0) >= 6 OR COALESCE(dzs.periodos_zerados_simples, 0) >= 6 THEN 15 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_omissos_normal, 0) >= 3 OR COALESCE(dzs.periodos_omissos_simples, 0) >= 3 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.sn_cancelado_inex_inativ, 0) = 1 THEN 25 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 5 THEN 20 WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 3 THEN 10 ELSE 0 END\\r\\n    ) >= 100 THEN 'CR\\u00cdTICO'\\r\\n    WHEN (\\r\\n      (CASE WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 12 THEN 40 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 6 THEN 30 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 3 THEN 15 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 100 THEN 30 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 50 THEN 20 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 25 THEN 10 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 1000000 THEN 20 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 500000 THEN 15 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 100000 THEN 10 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 50000 THEN 5 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 100 AND COALESCE(est12.media_credito_12m, 0) > 1000 THEN 10 WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 500 AND COALESCE(est12.media_credito_12m, 0) > 5000 THEN 5 ELSE 0 END) +\\r\\n      CASE WHEN ds.cd_situacao_suspeita IS NOT NULL THEN 30 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.score_suspeita, 0) > 80 THEN 20 WHEN COALESCE(ds.score_suspeita, 0) > 50 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_zerados_normal, 0) >= 6 OR COALESCE(dzs.periodos_zerados_simples, 0) >= 6 THEN 15 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_omissos_normal, 0) >= 3 OR COALESCE(dzs.periodos_omissos_simples, 0) >= 3 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.sn_cancelado_inex_inativ, 0) = 1 THEN 25 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 5 THEN 20 WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 3 THEN 10 ELSE 0 END\\r\\n    ) >= 70 THEN 'ALTO'\\r\\n    WHEN (\\r\\n      (CASE WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 12 THEN 40 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 6 THEN 30 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 3 THEN 15 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 100 THEN 30 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 50 THEN 20 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 25 THEN 10 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 1000000 THEN 20 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 500000 THEN 15 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 100000 THEN 10 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 50000 THEN 5 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 100 AND COALESCE(est12.media_credito_12m, 0) > 1000 THEN 10 WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 500 AND COALESCE(est12.media_credito_12m, 0) > 5000 THEN 5 ELSE 0 END) +\\r\\n      CASE WHEN ds.cd_situacao_suspeita IS NOT NULL THEN 30 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.score_suspeita, 0) > 80 THEN 20 WHEN COALESCE(ds.score_suspeita, 0) > 50 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_zerados_normal, 0) >= 6 OR COALESCE(dzs.periodos_zerados_simples, 0) >= 6 THEN 15 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_omissos_normal, 0) >= 3 OR COALESCE(dzs.periodos_omissos_simples, 0) >= 3 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.sn_cancelado_inex_inativ, 0) = 1 THEN 25 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 5 THEN 20 WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 3 THEN 10 ELSE 0 END\\r\\n    ) >= 40 THEN 'M\\u00c9DIO'\\r\\n    ELSE 'BAIXO'\\r\\n  END AS classificacao_risco_combinado_12m,\\r\\n  \\r\\n  -- Classifica\\u00e7\\u00e3o Combinada 60m\\r\\n  CASE\\r\\n    WHEN (\\r\\n      (CASE WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 48 THEN 50 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 36 THEN 40 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 24 THEN 30 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 12 THEN 20 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 500 THEN 40 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 300 THEN 30 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 150 THEN 20 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 75 THEN 10 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 200 AND COALESCE(est60.media_credito_60m, 0) > 5000 THEN 15 WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 500 AND COALESCE(est60.media_credito_60m, 0) > 2000 THEN 10 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 5000000 THEN 25 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 2000000 THEN 20 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 1000000 THEN 15 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 500000 THEN 10 ELSE 0 END) +\\r\\n      CASE WHEN ds.cd_situacao_suspeita IS NOT NULL THEN 30 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.score_suspeita, 0) > 80 THEN 20 WHEN COALESCE(ds.score_suspeita, 0) > 50 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_zerados_normal, 0) >= 6 OR COALESCE(dzs.periodos_zerados_simples, 0) >= 6 THEN 15 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_omissos_normal, 0) >= 3 OR COALESCE(dzs.periodos_omissos_simples, 0) >= 3 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.sn_cancelado_inex_inativ, 0) = 1 THEN 25 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 5 THEN 20 WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 3 THEN 10 ELSE 0 END\\r\\n    ) >= 120 THEN 'CR\\u00cdTICO'\\r\\n    WHEN (\\r\\n      (CASE WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 48 THEN 50 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 36 THEN 40 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 24 THEN 30 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 12 THEN 20 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 500 THEN 40 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 300 THEN 30 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 150 THEN 20 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 75 THEN 10 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 200 AND COALESCE(est60.media_credito_60m, 0) > 5000 THEN 15 WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 500 AND COALESCE(est60.media_credito_60m, 0) > 2000 THEN 10 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 5000000 THEN 25 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 2000000 THEN 20 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 1000000 THEN 15 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 500000 THEN 10 ELSE 0 END) +\\r\\n      CASE WHEN ds.cd_situacao_suspeita IS NOT NULL THEN 30 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.score_suspeita, 0) > 80 THEN 20 WHEN COALESCE(ds.score_suspeita, 0) > 50 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_zerados_normal, 0) >= 6 OR COALESCE(dzs.periodos_zerados_simples, 0) >= 6 THEN 15 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_omissos_normal, 0) >= 3 OR COALESCE(dzs.periodos_omissos_simples, 0) >= 3 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.sn_cancelado_inex_inativ, 0) = 1 THEN 25 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 5 THEN 20 WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 3 THEN 10 ELSE 0 END\\r\\n    ) >= 85 THEN 'ALTO'\\r\\n    WHEN (\\r\\n      (CASE WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 48 THEN 50 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 36 THEN 40 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 24 THEN 30 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 12 THEN 20 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 500 THEN 40 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 300 THEN 30 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 150 THEN 20 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 75 THEN 10 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 200 AND COALESCE(est60.media_credito_60m, 0) > 5000 THEN 15 WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 500 AND COALESCE(est60.media_credito_60m, 0) > 2000 THEN 10 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 5000000 THEN 25 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 2000000 THEN 20 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 1000000 THEN 15 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 500000 THEN 10 ELSE 0 END) +\\r\\n      CASE WHEN ds.cd_situacao_suspeita IS NOT NULL THEN 30 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.score_suspeita, 0) > 80 THEN 20 WHEN COALESCE(ds.score_suspeita, 0) > 50 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_zerados_normal, 0) >= 6 OR COALESCE(dzs.periodos_zerados_simples, 0) >= 6 THEN 15 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_omissos_normal, 0) >= 3 OR COALESCE(dzs.periodos_omissos_simples, 0) >= 3 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.sn_cancelado_inex_inativ, 0) = 1 THEN 25 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 5 THEN 20 WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 3 THEN 10 ELSE 0 END\\r\\n    ) >= 50 THEN 'M\\u00c9DIO'\\r\\n    ELSE 'BAIXO'\\r\\n  END AS classificacao_risco_combinado_60m\\r\\n  \\r\\nFROM \\r\\n  cnpjs_unicos df\\r\\nLEFT JOIN \\r\\n  usr_sat_ods.vw_ods_contrib c ON df.nu_cnpj = c.nu_cnpj\\r\\nLEFT JOIN \\r\\n  contagem_iguais_60m ci60 ON df.nu_cnpj = ci60.nu_cnpj\\r\\nLEFT JOIN \\r\\n  contagem_iguais_12m ci12 ON df.nu_cnpj = ci12.nu_cnpj\\r\\nLEFT JOIN \\r\\n  sequencia_ultimos_12m seq12 ON df.nu_cnpj = seq12.nu_cnpj\\r\\nLEFT JOIN \\r\\n  estatisticas_creditos_12m est12 ON df.nu_cnpj = est12.nu_cnpj\\r\\nLEFT JOIN \\r\\n  estatisticas_creditos_60m est60 ON df.nu_cnpj = est60.nu_cnpj\\r\\nLEFT JOIN \\r\\n  saldo_credor_atual saldo ON df.nu_cnpj = saldo.nu_cnpj\\r\\nLEFT JOIN \\r\\n  crescimento_saldo_12m cresc12 ON c.nu_cnpj_grupo = cresc12.nu_cnpj_grupo\\r\\nLEFT JOIN \\r\\n  crescimento_saldo_60m cresc60 ON c.nu_cnpj_grupo = cresc60.nu_cnpj_grupo\\r\\nLEFT JOIN \\r\\n  creditos_presumidos_12m cp12 ON c.nu_cnpj_grupo = cp12.nu_cnpj_grupo\\r\\nLEFT JOIN \\r\\n  creditos_presumidos_60m cp60 ON c.nu_cnpj_grupo = cp60.nu_cnpj_grupo\\r\\nLEFT JOIN\\r\\n  dados_recolhimento dr ON REGEXP_REPLACE(TRIM(CAST(df.nu_cnpj AS STRING)), '[^0-9]', '') = dr.cnpj_limpo\\r\\nLEFT JOIN\\r\\n  dados_zero_normal dzn ON REGEXP_REPLACE(TRIM(CAST(df.nu_cnpj AS STRING)), '[^0-9]', '') = dzn.cnpj_limpo\\r\\nLEFT JOIN\\r\\n  dados_zero_simples dzs ON REGEXP_REPLACE(TRIM(CAST(df.nu_cnpj AS STRING)), '[^0-9]', '') = dzs.cnpj_limpo\\r\\nLEFT JOIN\\r\\n  dados_suspeitas ds ON REGEXP_REPLACE(TRIM(CAST(df.nu_cnpj AS STRING)), '[^0-9]', '') = ds.cnpj_limpo\\r\\nLEFT JOIN\\r\\n  dados_indicios di ON REGEXP_REPLACE(TRIM(CAST(df.nu_cnpj AS STRING)), '[^0-9]', '') = di.cnpj_limpo\\r\\n\\r\\nORDER BY \\r\\n  score_risco_combinado_60m DESC, \\r\\n  score_risco_combinado_12m DESC,\\r\\n  score_risco_60m DESC;\\r\\n\\r\\n\\r\\n-- =====================================================================\\r\\n-- 2. TABELA CONSOLIDADA T\\u00caXTIL - teste.credito_dime_textil\\r\\n-- =====================================================================\\r\\nDROP TABLE IF EXISTS teste.credito_dime_textil;\\r\\n\\r\\nCREATE TABLE teste.credito_dime_textil STORED AS PARQUET AS\\r\\nWITH movimentacao_textil AS (\\r\\n  SELECT \\r\\n    my_efd.codigocnpj AS nu_cnpj,\\r\\n    SUM(CASE WHEN c170.cfop BETWEEN 1000 AND 3999 THEN c170.vl_item ELSE 0 END) AS vl_entradas_textil,\\r\\n    SUM(CASE WHEN c170.cfop BETWEEN 5000 AND 7999 THEN c170.vl_item ELSE 0 END) AS vl_saidas_textil,\\r\\n    COUNT(DISTINCT c100.dt_doc) AS dias_movimento_textil,\\r\\n    COUNT(DISTINCT r0200.cod_ncm) AS qtde_ncm_distintos_textil\\r\\n  FROM \\r\\n    efd.efd my_efd\\r\\n  JOIN \\r\\n    efd.efd_rc100 c100 ON my_efd.id_file = c100.id_file,\\r\\n    c100.listarc170_itensdocumento c170\\r\\n  JOIN \\r\\n    efd.efd_r0200 r0200 ON c100.id_file = r0200.id_file \\r\\n                        AND c170.cod_item = r0200.cod_item\\r\\n  WHERE \\r\\n    (my_efd.ano_referencia = 2024 OR \\r\\n     (my_efd.ano_referencia = 2025 AND my_efd.mes_referencia <= 9))\\r\\n    AND (r0200.cod_ncm LIKE '61%' OR r0200.cod_ncm LIKE '62%')\\r\\n  GROUP BY \\r\\n    my_efd.codigocnpj\\r\\n)\\r\\n\\r\\nSELECT \\r\\n  cd.*,\\r\\n  ROUND(COALESCE(mov.vl_entradas_textil, 0), 2) AS vl_entradas_textil,\\r\\n  ROUND(COALESCE(mov.vl_saidas_textil, 0), 2) AS vl_saidas_textil,\\r\\n  COALESCE(mov.dias_movimento_textil, 0) AS dias_movimento_textil,\\r\\n  COALESCE(mov.qtde_ncm_distintos_textil, 0) AS qtde_ncm_distintos_textil,\\r\\n  \\r\\n  CASE \\r\\n    WHEN mov.vl_saidas_textil > 0 THEN \\r\\n      ROUND(100.0 * mov.vl_entradas_textil / NULLIF(mov.vl_saidas_textil, 0), 2)\\r\\n    ELSE 0 \\r\\n  END AS indice_entrada_saida_textil,\\r\\n  \\r\\n  CASE \\r\\n    WHEN mov.vl_entradas_textil > 0 THEN\\r\\n      ROUND(cd.saldo_credor_atual / NULLIF(mov.vl_entradas_textil, 0), 4)\\r\\n    ELSE 0\\r\\n  END AS indice_saldo_entrada_textil,\\r\\n  \\r\\n  CASE WHEN mov.nu_cnpj IS NOT NULL THEN 1 ELSE 0 END AS flag_setor_textil,\\r\\n  'T\\u00caXTIL' AS setor,\\r\\n  \\r\\n  -- Score Combinado Setorial (usando score 60m como base)\\r\\n  (\\r\\n    cd.score_risco_combinado_60m + \\r\\n    CASE WHEN cd.flag_empresa_suspeita = 1 THEN 15 ELSE 0 END +\\r\\n    CASE WHEN cd.score_suspeita > 70 THEN 10 ELSE 0 END +\\r\\n    CASE WHEN cd.sn_cancelado_inex_inativ = 1 THEN 15 ELSE 0 END +\\r\\n    CASE WHEN cd.qtde_indicios_fraude >= 3 THEN 10 ELSE 0 END\\r\\n  ) AS score_risco_textil_combinado\\r\\n  \\r\\nFROM teste.credito_dime_completo cd\\r\\nLEFT JOIN movimentacao_textil mov ON cd.nu_cnpj = mov.nu_cnpj\\r\\n\\r\\nORDER BY score_risco_textil_combinado DESC;\\r\\n\\r\\n\\r\\n-- =====================================================================\\r\\n-- 3. TABELA CONSOLIDADA METAL-MEC\\u00c2NICO - teste.credito_dime_metalmec\\r\\n-- =====================================================================\\r\\nDROP TABLE IF EXISTS teste.credito_dime_metalmec;\\r\\n\\r\\nCREATE TABLE teste.credito_dime_metalmec STORED AS PARQUET AS\\r\\nWITH movimentacao_metalmec AS (\\r\\n  SELECT \\r\\n    my_efd.codigocnpj AS nu_cnpj,\\r\\n    SUM(CASE WHEN c170.cfop BETWEEN 1000 AND 3999 THEN c170.vl_item ELSE 0 END) AS vl_entradas_metalmec,\\r\\n    SUM(CASE WHEN c170.cfop BETWEEN 5000 AND 7999 THEN c170.vl_item ELSE 0 END) AS vl_saidas_metalmec,\\r\\n    COUNT(DISTINCT c100.dt_doc) AS dias_movimento_metalmec,\\r\\n    COUNT(DISTINCT r0200.cod_ncm) AS qtde_ncm_distintos_metalmec,\\r\\n    SUM(CASE WHEN r0200.cod_ncm LIKE '84%' THEN c170.vl_item ELSE 0 END) AS vl_cap84,\\r\\n    SUM(CASE WHEN r0200.cod_ncm LIKE '85%' THEN c170.vl_item ELSE 0 END) AS vl_cap85\\r\\n  FROM \\r\\n    efd.efd my_efd\\r\\n  JOIN \\r\\n    efd.efd_rc100 c100 ON my_efd.id_file = c100.id_file,\\r\\n    c100.listarc170_itensdocumento c170\\r\\n  JOIN \\r\\n    efd.efd_r0200 r0200 ON c100.id_file = r0200.id_file \\r\\n                        AND c170.cod_item = r0200.cod_item\\r\\n  WHERE \\r\\n    (my_efd.ano_referencia = 2024 OR \\r\\n     (my_efd.ano_referencia = 2025 AND my_efd.mes_referencia <= 9))\\r\\n    AND (r0200.cod_ncm LIKE '84%' OR r0200.cod_ncm LIKE '85%')\\r\\n  GROUP BY \\r\\n    my_efd.codigocnpj\\r\\n)\\r\\n\\r\\nSELECT \\r\\n  cd.*,\\r\\n  ROUND(COALESCE(mov.vl_entradas_metalmec, 0), 2) AS vl_entradas_metalmec,\\r\\n  ROUND(COALESCE(mov.vl_saidas_metalmec, 0), 2) AS vl_saidas_metalmec,\\r\\n  COALESCE(mov.dias_movimento_metalmec, 0) AS dias_movimento_metalmec,\\r\\n  COALESCE(mov.qtde_ncm_distintos_metalmec, 0) AS qtde_ncm_distintos_metalmec,\\r\\n  ROUND(COALESCE(mov.vl_cap84, 0), 2) AS vl_capitulo_84,\\r\\n  ROUND(COALESCE(mov.vl_cap85, 0), 2) AS vl_capitulo_85,\\r\\n  \\r\\n  CASE \\r\\n    WHEN mov.vl_saidas_metalmec > 0 THEN \\r\\n      ROUND(100.0 * mov.vl_entradas_metalmec / NULLIF(mov.vl_saidas_metalmec, 0), 2)\\r\\n    ELSE 0 \\r\\n  END AS indice_entrada_saida_metalmec,\\r\\n  \\r\\n  CASE \\r\\n    WHEN mov.vl_entradas_metalmec > 0 THEN\\r\\n      ROUND(cd.saldo_credor_atual / NULLIF(mov.vl_entradas_metalmec, 0), 4)\\r\\n    ELSE 0\\r\\n  END AS indice_saldo_entrada_metalmec,\\r\\n  \\r\\n  CASE \\r\\n    WHEN (mov.vl_cap84 + mov.vl_cap85) > 0 THEN\\r\\n      ROUND(100.0 * mov.vl_cap84 / NULLIF(mov.vl_cap84 + mov.vl_cap85, 0), 2)\\r\\n    ELSE 0\\r\\n  END AS perc_cap84,\\r\\n  \\r\\n  CASE WHEN mov.nu_cnpj IS NOT NULL THEN 1 ELSE 0 END AS flag_setor_metalmec,\\r\\n  'METAL-MEC\\u00c2NICO' AS setor,\\r\\n  \\r\\n  -- Score Combinado Setorial (usando score 60m como base)\\r\\n  (\\r\\n    cd.score_risco_combinado_60m + \\r\\n    CASE WHEN cd.flag_empresa_suspeita = 1 THEN 15 ELSE 0 END +\\r\\n    CASE WHEN cd.score_suspeita > 70 THEN 10 ELSE 0 END +\\r\\n    CASE WHEN cd.sn_cancelado_inex_inativ = 1 THEN 15 ELSE 0 END +\\r\\n    CASE WHEN cd.qtde_indicios_fraude >= 3 THEN 10 ELSE 0 END\\r\\n  ) AS score_risco_metalmec_combinado\\r\\n  \\r\\nFROM teste.credito_dime_completo cd\\r\\nLEFT JOIN movimentacao_metalmec mov ON cd.nu_cnpj = mov.nu_cnpj\\r\\n\\r\\nORDER BY score_risco_metalmec_combinado DESC;\\r\\n\\r\\n\\r\\n-- =====================================================================\\r\\n-- 4. TABELA CONSOLIDADA TECNOLOGIA - teste.credito_dime_tech\\r\\n-- =====================================================================\\r\\nDROP TABLE IF EXISTS teste.credito_dime_tech;\\r\\n\\r\\nCREATE TABLE teste.credito_dime_tech STORED AS PARQUET AS\\r\\nWITH movimentacao_tech AS (\\r\\n  SELECT \\r\\n    my_efd.codigocnpj AS nu_cnpj,\\r\\n    SUM(CASE WHEN c170.cfop BETWEEN 1000 AND 3999 THEN c170.vl_item ELSE 0 END) AS vl_entradas_tech,\\r\\n    SUM(CASE WHEN c170.cfop BETWEEN 5000 AND 7999 THEN c170.vl_item ELSE 0 END) AS vl_saidas_tech,\\r\\n    COUNT(DISTINCT c100.dt_doc) AS dias_movimento_tech,\\r\\n    COUNT(DISTINCT r0200.cod_ncm) AS qtde_ncm_distintos_tech,\\r\\n    SUM(CASE WHEN r0200.cod_ncm LIKE '8471%' THEN c170.vl_item ELSE 0 END) AS vl_computadores,\\r\\n    SUM(CASE WHEN r0200.cod_ncm LIKE '8473%' THEN c170.vl_item ELSE 0 END) AS vl_partes_computadores,\\r\\n    SUM(CASE WHEN r0200.cod_ncm LIKE '8517%' THEN c170.vl_item ELSE 0 END) AS vl_telecom\\r\\n  FROM \\r\\n    efd.efd my_efd\\r\\n  JOIN \\r\\n    efd.efd_rc100 c100 ON my_efd.id_file = c100.id_file,\\r\\n    c100.listarc170_itensdocumento c170\\r\\n  JOIN \\r\\n    efd.efd_r0200 r0200 ON c100.id_file = r0200.id_file \\r\\n                        AND c170.cod_item = r0200.cod_item\\r\\n  WHERE \\r\\n    (my_efd.ano_referencia = 2024 OR \\r\\n     (my_efd.ano_referencia = 2025 AND my_efd.mes_referencia <= 9))\\r\\n    AND (r0200.cod_ncm LIKE '8471%' OR r0200.cod_ncm LIKE '8473%' OR r0200.cod_ncm LIKE '8517%')\\r\\n  GROUP BY \\r\\n    my_efd.codigocnpj\\r\\n)\\r\\n\\r\\nSELECT \\r\\n  cd.*,\\r\\n  ROUND(COALESCE(mov.vl_entradas_tech, 0), 2) AS vl_entradas_tech,\\r\\n  ROUND(COALESCE(mov.vl_saidas_tech, 0), 2) AS vl_saidas_tech,\\r\\n  COALESCE(mov.dias_movimento_tech, 0) AS dias_movimento_tech,\\r\\n  COALESCE(mov.qtde_ncm_distintos_tech, 0) AS qtde_ncm_distintos_tech,\\r\\n  ROUND(COALESCE(mov.vl_computadores, 0), 2) AS vl_computadores,\\r\\n  ROUND(COALESCE(mov.vl_partes_computadores, 0), 2) AS vl_partes_computadores,\\r\\n  ROUND(COALESCE(mov.vl_telecom, 0), 2) AS vl_telecom,\\r\\n  \\r\\n  CASE \\r\\n    WHEN mov.vl_saidas_tech > 0 THEN \\r\\n      ROUND(100.0 * mov.vl_entradas_tech / NULLIF(mov.vl_saidas_tech, 0), 2)\\r\\n    ELSE 0 \\r\\n  END AS indice_entrada_saida_tech,\\r\\n  \\r\\n  CASE \\r\\n    WHEN mov.vl_entradas_tech > 0 THEN\\r\\n      ROUND(cd.saldo_credor_atual / NULLIF(mov.vl_entradas_tech, 0), 4)\\r\\n    ELSE 0\\r\\n  END AS indice_saldo_entrada_tech,\\r\\n  \\r\\n  CASE WHEN mov.nu_cnpj IS NOT NULL THEN 1 ELSE 0 END AS flag_setor_tech,\\r\\n  'TECNOLOGIA' AS setor,\\r\\n  \\r\\n  -- Score Combinado Setorial (usando score 60m como base)\\r\\n  (\\r\\n    cd.score_risco_combinado_60m + \\r\\n    CASE WHEN cd.flag_empresa_suspeita = 1 THEN 15 ELSE 0 END +\\r\\n    CASE WHEN cd.score_suspeita > 70 THEN 10 ELSE 0 END +\\r\\n    CASE WHEN cd.sn_cancelado_inex_inativ = 1 THEN 15 ELSE 0 END +\\r\\n    CASE WHEN cd.qtde_indicios_fraude >= 3 THEN 10 ELSE 0 END\\r\\n  ) AS score_risco_tech_combinado\\r\\n  \\r\\nFROM teste.credito_dime_completo cd\\r\\nLEFT JOIN movimentacao_tech mov ON cd.nu_cnpj = mov.nu_cnpj\\r\\n\\r\\nORDER BY score_risco_tech_combinado DESC;\", \"statementsList\": [\"-- =====================================================================\\r\\n-- AN\\u00c1LISE CONSOLIDADA DE CR\\u00c9DITO DIME COM ENRIQUECIMENTO INTEGRADO\\r\\n-- Vers\\u00e3o Expandida - 12 e 60 meses\\r\\n-- =====================================================================\\r\\n\\r\\n-- ---------------------------------------------------------------------\\r\\n-- 1. TABELA PRINCIPAL CONSOLIDADA - teste.credito_dime_completo\\r\\n-- ---------------------------------------------------------------------\\r\\nDROP TABLE IF EXISTS teste.credito_dime_completo;\", \"\\r\\nSET REQUEST_POOL = 'medium';\", \"\\r\\n\\r\\nCREATE TABLE IF NOT EXISTS teste.credito_dime_completo AS\\r\\n\\r\\nWITH periodos AS (\\r\\n  SELECT periodo AS nu_per_ref\\r\\n  FROM (\\r\\n    -- 2020 (\\u00faltimos 4 meses)\\r\\n    SELECT 202009 AS periodo UNION ALL SELECT 202010 UNION ALL SELECT 202011 UNION ALL SELECT 202012 UNION ALL\\r\\n    -- 2021\\r\\n    SELECT 202101 AS periodo UNION ALL SELECT 202102 UNION ALL SELECT 202103 UNION ALL SELECT 202104 UNION ALL\\r\\n    SELECT 202105 UNION ALL SELECT 202106 UNION ALL SELECT 202107 UNION ALL SELECT 202108 UNION ALL\\r\\n    SELECT 202109 UNION ALL SELECT 202110 UNION ALL SELECT 202111 UNION ALL SELECT 202112 UNION ALL\\r\\n    -- 2022\\r\\n    SELECT 202201 UNION ALL SELECT 202202 UNION ALL SELECT 202203 UNION ALL SELECT 202204 UNION ALL\\r\\n    SELECT 202205 UNION ALL SELECT 202206 UNION ALL SELECT 202207 UNION ALL SELECT 202208 UNION ALL\\r\\n    SELECT 202209 UNION ALL SELECT 202210 UNION ALL SELECT 202211 UNION ALL SELECT 202212 UNION ALL\\r\\n    -- 2023\\r\\n    SELECT 202301 UNION ALL SELECT 202302 UNION ALL SELECT 202303 UNION ALL SELECT 202304 UNION ALL\\r\\n    SELECT 202305 UNION ALL SELECT 202306 UNION ALL SELECT 202307 UNION ALL SELECT 202308 UNION ALL\\r\\n    SELECT 202309 UNION ALL SELECT 202310 UNION ALL SELECT 202311 UNION ALL SELECT 202312 UNION ALL\\r\\n    -- 2024\\r\\n    SELECT 202401 UNION ALL SELECT 202402 UNION ALL SELECT 202403 UNION ALL SELECT 202404 UNION ALL\\r\\n    SELECT 202405 UNION ALL SELECT 202406 UNION ALL SELECT 202407 UNION ALL SELECT 202408 UNION ALL\\r\\n    SELECT 202409 UNION ALL SELECT 202410 UNION ALL SELECT 202411 UNION ALL SELECT 202412 UNION ALL\\r\\n    -- 2025\\r\\n    SELECT 202501 UNION ALL SELECT 202502 UNION ALL SELECT 202503 UNION ALL SELECT 202504 UNION ALL\\r\\n    SELECT 202505 UNION ALL SELECT 202506 UNION ALL SELECT 202507 UNION ALL SELECT 202508 UNION ALL\\r\\n    SELECT 202509\\r\\n  ) p\\r\\n),\\r\\n\\r\\ndados_filtrados AS (\\r\\n  SELECT \\r\\n    d.nu_cnpj,\\r\\n    d.nu_per_ref,\\r\\n    d.vl_cred_mes_anterior,\\r\\n    d.vl_cred_mes_seguinte\\r\\n  FROM \\r\\n    usr_sat_ods.ods_decl_dime_raw d\\r\\n  WHERE \\r\\n    d.nu_per_ref IN (SELECT nu_per_ref FROM periodos)\\r\\n    AND d.vl_cred_mes_anterior > 0\\r\\n    AND d.vl_cred_mes_seguinte > 0\\r\\n),\\r\\n\\r\\n-- =====================================================================\\r\\n-- AN\\u00c1LISES DE VALORES IGUAIS - HIST\\u00d3RICO COMPLETO (60 MESES)\\r\\n-- =====================================================================\\r\\nvalores_iguais_base AS (\\r\\n  SELECT\\r\\n    nu_cnpj,\\r\\n    nu_per_ref,\\r\\n    vl_cred_mes_anterior AS valor\\r\\n  FROM \\r\\n    dados_filtrados\\r\\n  WHERE \\r\\n    vl_cred_mes_anterior = vl_cred_mes_seguinte\\r\\n),\\r\\n\\r\\ncontagem_iguais_60m AS (\\r\\n  SELECT\\r\\n    nu_cnpj,\\r\\n    COUNT(*) AS contagem_periodos_iguais_60m,\\r\\n    AVG(valor) AS valor_medio_repetido_60m,\\r\\n    MIN(nu_per_ref) AS primeiro_periodo_igual_60m,\\r\\n    MAX(nu_per_ref) AS ultimo_periodo_igual_60m\\r\\n  FROM \\r\\n    valores_iguais_base\\r\\n  GROUP BY \\r\\n    nu_cnpj\\r\\n),\\r\\n\\r\\ncontagem_iguais_12m AS (\\r\\n  SELECT\\r\\n    nu_cnpj,\\r\\n    COUNT(*) AS contagem_periodos_iguais_12m,\\r\\n    AVG(valor) AS valor_medio_repetido_12m,\\r\\n    MIN(nu_per_ref) AS primeiro_periodo_igual_12m,\\r\\n    MAX(nu_per_ref) AS ultimo_periodo_igual_12m\\r\\n  FROM \\r\\n    valores_iguais_base\\r\\n  WHERE \\r\\n    nu_per_ref >= 202509 - 100  -- \\u00daltimos 12 meses aproximadamente\\r\\n  GROUP BY \\r\\n    nu_cnpj\\r\\n),\\r\\n\\r\\n-- Sequ\\u00eancia dos \\u00faltimos meses (12 meses)\\r\\nsequencia_ultimos_12m AS (\\r\\n  SELECT\\r\\n    vi.nu_cnpj,\\r\\n    COUNT(*) AS qtde_ultimos_12m_iguais,\\r\\n    MIN(vi.nu_per_ref) AS periodo_inicial_seq_12m,\\r\\n    MAX(vi.nu_per_ref) AS periodo_final_seq_12m,\\r\\n    AVG(vi.valor) AS valor_sequencia_12m\\r\\n  FROM \\r\\n    valores_iguais_base vi\\r\\n  WHERE \\r\\n    vi.nu_per_ref >= 202409  -- \\u00daltimos 12 meses\\r\\n  GROUP BY \\r\\n    vi.nu_cnpj\\r\\n  HAVING COUNT(*) >= 3\\r\\n),\\r\\n\\r\\n-- =====================================================================\\r\\n-- SALDO CREDOR E EVOLU\\u00c7\\u00c3O\\r\\n-- =====================================================================\\r\\nsaldo_credor_atual AS (\\r\\n  SELECT \\r\\n    c.nu_cnpj_grupo,\\r\\n    c.nu_cnpj,\\r\\n    MAX(d.vl_cred_mes_seguinte) AS saldo_credor_acumulado_atual\\r\\n  FROM \\r\\n    usr_sat_ods.ods_decl_dime_raw d\\r\\n  JOIN \\r\\n    usr_sat_ods.vw_ods_contrib c ON d.nu_cnpj = c.nu_cnpj\\r\\n  WHERE \\r\\n    d.nu_per_ref = 202509\\r\\n  GROUP BY \\r\\n    c.nu_cnpj_grupo, c.nu_cnpj\\r\\n),\\r\\n\\r\\n-- Evolu\\u00e7\\u00e3o 12 meses\\r\\nevolucao_saldo_12m AS (\\r\\n  SELECT \\r\\n    c.nu_cnpj_grupo,\\r\\n    MAX(CASE WHEN d.nu_per_ref = 202409 THEN d.vl_cred_mes_seguinte ELSE NULL END) AS saldo_12m_atras,\\r\\n    MAX(CASE WHEN d.nu_per_ref = 202509 THEN d.vl_cred_mes_seguinte ELSE NULL END) AS saldo_atual\\r\\n  FROM \\r\\n    usr_sat_ods.ods_decl_dime_raw d\\r\\n  JOIN \\r\\n    usr_sat_ods.vw_ods_contrib c ON d.nu_cnpj = c.nu_cnpj\\r\\n  WHERE \\r\\n    d.nu_per_ref IN (202409, 202509)\\r\\n  GROUP BY \\r\\n    c.nu_cnpj_grupo\\r\\n),\\r\\n\\r\\ncrescimento_saldo_12m AS (\\r\\n  SELECT\\r\\n    nu_cnpj_grupo,\\r\\n    saldo_12m_atras,\\r\\n    saldo_atual,\\r\\n    COALESCE(saldo_atual, 0) - COALESCE(saldo_12m_atras, 0) AS crescimento_absoluto_12m,\\r\\n    CASE \\r\\n      WHEN saldo_12m_atras > 0 THEN\\r\\n        ROUND(100.0 * (COALESCE(saldo_atual, 0) - saldo_12m_atras) / NULLIF(saldo_12m_atras, 0), 2)\\r\\n      ELSE 0\\r\\n    END AS crescimento_percentual_12m\\r\\n  FROM \\r\\n    evolucao_saldo_12m\\r\\n),\\r\\n\\r\\n-- Evolu\\u00e7\\u00e3o 60 meses\\r\\nevolucao_saldo_60m AS (\\r\\n  SELECT \\r\\n    c.nu_cnpj_grupo,\\r\\n    MAX(CASE WHEN d.nu_per_ref = 202009 THEN d.vl_cred_mes_seguinte ELSE NULL END) AS saldo_60m_atras,\\r\\n    MAX(CASE WHEN d.nu_per_ref = 202509 THEN d.vl_cred_mes_seguinte ELSE NULL END) AS saldo_atual\\r\\n  FROM \\r\\n    usr_sat_ods.ods_decl_dime_raw d\\r\\n  JOIN \\r\\n    usr_sat_ods.vw_ods_contrib c ON d.nu_cnpj = c.nu_cnpj\\r\\n  WHERE \\r\\n    d.nu_per_ref IN (202009, 202509)\\r\\n  GROUP BY \\r\\n    c.nu_cnpj_grupo\\r\\n),\\r\\n\\r\\ncrescimento_saldo_60m AS (\\r\\n  SELECT\\r\\n    nu_cnpj_grupo,\\r\\n    saldo_60m_atras,\\r\\n    saldo_atual AS saldo_atual_60m,\\r\\n    COALESCE(saldo_atual, 0) - COALESCE(saldo_60m_atras, 0) AS crescimento_absoluto_60m,\\r\\n    CASE \\r\\n      WHEN saldo_60m_atras > 0 THEN\\r\\n        ROUND(100.0 * (COALESCE(saldo_atual, 0) - saldo_60m_atras) / NULLIF(saldo_60m_atras, 0), 2)\\r\\n      ELSE 0\\r\\n    END AS crescimento_percentual_60m\\r\\n  FROM \\r\\n    evolucao_saldo_60m\\r\\n),\\r\\n\\r\\n-- =====================================================================\\r\\n-- CR\\u00c9DITOS PRESUMIDOS\\r\\n-- =====================================================================\\r\\ncreditos_presumidos_12m AS (\\r\\n  SELECT \\r\\n    dcip.nu_cnpj_grupo,\\r\\n    SUM(dcip.vl_credito) AS vl_cp_total_12m,\\r\\n    COUNT(dcip.cd_tipo_credito) AS qtde_tipos_cp_12m\\r\\n  FROM \\r\\n    usr_sat_ods.vw_ods_dcip dcip\\r\\n  WHERE \\r\\n    dcip.cd_estado_decl = 1\\r\\n    AND dcip.sn_utilizada_dime = 1\\r\\n    AND dcip.cd_grupo_dcip = 3\\r\\n    AND dcip.nu_per_ref BETWEEN 202409 AND 202509\\r\\n  GROUP BY \\r\\n    dcip.nu_cnpj_grupo\\r\\n),\\r\\n\\r\\ncreditos_presumidos_60m AS (\\r\\n  SELECT \\r\\n    dcip.nu_cnpj_grupo,\\r\\n    SUM(dcip.vl_credito) AS vl_cp_total_60m,\\r\\n    COUNT(dcip.cd_tipo_credito) AS qtde_tipos_cp_60m,\\r\\n    COUNT(DISTINCT dcip.nu_per_ref) AS meses_com_cp_60m\\r\\n  FROM \\r\\n    usr_sat_ods.vw_ods_dcip dcip\\r\\n  WHERE \\r\\n    dcip.cd_estado_decl = 1\\r\\n    AND dcip.sn_utilizada_dime = 1\\r\\n    AND dcip.cd_grupo_dcip = 3\\r\\n    AND dcip.nu_per_ref >= 202009  -- \\u00daltimos 60 meses\\r\\n  GROUP BY \\r\\n    dcip.nu_cnpj_grupo\\r\\n),\\r\\n\\r\\n-- =====================================================================\\r\\n-- ESTAT\\u00cdSTICAS DE CR\\u00c9DITOS\\r\\n-- =====================================================================\\r\\nestatisticas_creditos_12m AS (\\r\\n  SELECT\\r\\n    nu_cnpj,\\r\\n    COUNT(nu_per_ref) AS qtde_meses_declarados_12m,\\r\\n    AVG(vl_cred_mes_anterior) AS media_credito_12m,\\r\\n    MIN(vl_cred_mes_anterior) AS min_credito_12m,\\r\\n    MAX(vl_cred_mes_anterior) AS max_credito_12m,\\r\\n    STDDEV(vl_cred_mes_anterior) AS desvio_padrao_credito_12m\\r\\n  FROM dados_filtrados\\r\\n  WHERE nu_per_ref BETWEEN 202409 AND 202509\\r\\n  GROUP BY nu_cnpj\\r\\n),\\r\\n\\r\\nestatisticas_creditos_60m AS (\\r\\n  SELECT\\r\\n    nu_cnpj,\\r\\n    COUNT(nu_per_ref) AS qtde_meses_declarados_60m,\\r\\n    AVG(vl_cred_mes_anterior) AS media_credito_60m,\\r\\n    MIN(vl_cred_mes_anterior) AS min_credito_60m,\\r\\n    MAX(vl_cred_mes_anterior) AS max_credito_60m,\\r\\n    STDDEV(vl_cred_mes_anterior) AS desvio_padrao_credito_60m,\\r\\n    SUM(vl_cred_mes_anterior) AS total_credito_acumulado_60m\\r\\n  FROM dados_filtrados\\r\\n  WHERE nu_per_ref >= 202009  -- \\u00daltimos 60 meses\\r\\n  GROUP BY nu_cnpj\\r\\n),\\r\\n\\r\\n-- =====================================================================\\r\\n-- DADOS DE ENRIQUECIMENTO (CANCELAMENTO/SUSPEITAS)\\r\\n-- =====================================================================\\r\\ndados_recolhimento AS (\\r\\n  SELECT\\r\\n    REGEXP_REPLACE(TRIM(CAST(cnpj AS STRING)), '[^0-9]', '') AS cnpj_limpo,\\r\\n    MAX(COALESCE(quantidade_pagtos, 0)) AS quantidade_pagtos,\\r\\n    MAX(COALESCE(valor_pagtos, 0)) AS valor_pagtos\\r\\n  FROM teste.cancel_recolhimento\\r\\n  GROUP BY REGEXP_REPLACE(TRIM(CAST(cnpj AS STRING)), '[^0-9]', '')\\r\\n),\\r\\n\\r\\ndados_zero_normal AS (\\r\\n  SELECT\\r\\n    REGEXP_REPLACE(TRIM(CAST(nu_cnpj AS STRING)), '[^0-9]', '') AS cnpj_limpo,\\r\\n    MAX(nm_contador) AS contador_normal,\\r\\n    MAX(total_vl_faturamento) AS total_vl_faturamento,\\r\\n    MAX(total_vl_receita_bruta) AS total_vl_receita_bruta,\\r\\n    MAX(total_vl_tot_cred) AS total_vl_tot_cred,\\r\\n    MAX(total_vl_tot_deb) AS total_vl_tot_deb,\\r\\n    MAX(total_vl_deb_recolher) AS total_vl_deb_recolher,\\r\\n    MAX(dt_constituicao_empresa) AS dt_constituicao_normal,\\r\\n    MAX(total_nfes_emitidas) AS nfes_emitidas_normal,\\r\\n    MAX(periodos_omissos) AS periodos_omissos_normal,\\r\\n    MAX(periodos_zerados) AS periodos_zerados_normal,\\r\\n    MAX(total_periodos) AS total_periodos_normal,\\r\\n    MAX(periodos_declarados) AS periodos_declarados_normal\\r\\n  FROM teste.cancel_zero_normal\\r\\n  GROUP BY REGEXP_REPLACE(TRIM(CAST(nu_cnpj AS STRING)), '[^0-9]', '')\\r\\n),\\r\\n\\r\\ndados_zero_simples AS (\\r\\n  SELECT\\r\\n    REGEXP_REPLACE(TRIM(CAST(nu_cnpj AS STRING)), '[^0-9]', '') AS cnpj_limpo,\\r\\n    MAX(nm_contador) AS contador_simples,\\r\\n    MAX(total_vl_rec_bruta) AS total_vl_rec_bruta,\\r\\n    MAX(max_vl_rec_bruta_em_12m) AS max_vl_rec_bruta_em_12m,\\r\\n    MAX(total_vl_rec_bruta_no_ano) AS total_vl_rec_bruta_no_ano,\\r\\n    MAX(total_vl_icms_sc) AS total_vl_icms_sc,\\r\\n    MAX(dt_constituicao_empresa) AS dt_constituicao_simples,\\r\\n    MAX(total_nfes_emitidas) AS nfes_emitidas_simples,\\r\\n    MAX(periodos_omissos) AS periodos_omissos_simples,\\r\\n    MAX(periodos_zerados) AS periodos_zerados_simples,\\r\\n    MAX(total_periodos) AS total_periodos_simples,\\r\\n    MAX(periodos_declarados) AS periodos_declarados_simples\\r\\n  FROM teste.cancel_zero_simples\\r\\n  GROUP BY REGEXP_REPLACE(TRIM(CAST(nu_cnpj AS STRING)), '[^0-9]', '')\\r\\n),\\r\\n\\r\\ndados_suspeitas AS (\\r\\n  SELECT\\r\\n    REGEXP_REPLACE(TRIM(CAST(cnpj AS STRING)), '[^0-9]', '') AS cnpj_limpo,\\r\\n    MAX(cd_situacao_suspeita) AS cd_situacao_suspeita,\\r\\n    MAX(dt_situacao_suspeita) AS dt_situacao_suspeita,\\r\\n    MAX(nu_score) AS score_suspeita,\\r\\n    MAX(qt_motivos) AS qt_motivos,\\r\\n    MAX(cd_tipo_confirmacao) AS cd_tipo_confirmacao,\\r\\n    MAX(sn_cancelado_inex_inativ) AS sn_cancelado_inex_inativ,\\r\\n    MAX(dt_inicio_protoc_cancelamento) AS dt_inicio_protoc_cancelamento,\\r\\n    MAX(tx_obs_situacao_suspeita) AS tx_obs_situacao_suspeita,\\r\\n    MAX(nu_score_ia) AS nu_score_ia,\\r\\n    MAX(qt_meses_valores) AS qt_meses_valores,\\r\\n    MAX(vl_total_nfes_saida) AS vl_nfes_saida_suspeita,\\r\\n    MAX(vl_total_icms_nfes_saida) AS vl_total_icms_nfes_saida,\\r\\n    MAX(vl_total_nfes_entrada) AS vl_nfes_entrada_suspeita,\\r\\n    MAX(vl_total_icms_nfes_entrada) AS vl_total_icms_nfes_entrada,\\r\\n    MAX(vl_total_arrecadacao_grupo) AS vl_total_arrecadacao_grupo,\\r\\n    MAX(qt_clientes_noteiras) AS qt_clientes_noteiras,\\r\\n    MAX(qt_fornecedoras_noteiras) AS qt_fornecedoras_noteiras,\\r\\n    MAX(sn_suspenso_dfe) AS sn_suspenso_dfe,\\r\\n    MAX(dt_suspensao_dfe_suspeita) AS dt_suspensao_dfe_suspeita\\r\\n  FROM teste.cancel_suspeitas\\r\\n  GROUP BY REGEXP_REPLACE(TRIM(CAST(cnpj AS STRING)), '[^0-9]', '')\\r\\n),\\r\\n\\r\\ndados_indicios AS (\\r\\n  SELECT\\r\\n    REGEXP_REPLACE(TRIM(CAST(cnpj AS STRING)), '[^0-9]', '') AS cnpj_limpo,\\r\\n    COUNT(DISTINCT cd_indicio) AS qtde_indicios_fraude,\\r\\n    SUM(COALESCE(score_indicio, 0)) AS soma_score_indicios\\r\\n  FROM teste.cancel_suspeitas_score\\r\\n  GROUP BY REGEXP_REPLACE(TRIM(CAST(cnpj AS STRING)), '[^0-9]', '')\\r\\n),\\r\\n\\r\\ncnpjs_unicos AS (\\r\\n  SELECT nu_cnpj \\r\\n  FROM dados_filtrados \\r\\n  GROUP BY nu_cnpj\\r\\n)\\r\\n\\r\\n-- =====================================================================\\r\\n-- SELECT PRINCIPAL COM TODAS AS M\\u00c9TRICAS\\r\\n-- =====================================================================\\r\\nSELECT \\r\\n  -- Identifica\\u00e7\\u00e3o\\r\\n  df.nu_cnpj,\\r\\n  c.nm_razao_social,\\r\\n  c.nm_fantasia,\\r\\n  c.nm_sit_cadastral,\\r\\n  c.nm_gerfe,\\r\\n  c.de_cnae,\\r\\n  c.nu_cnpj_grupo,\\r\\n  \\r\\n  -- ===================================================================\\r\\n  -- AN\\u00c1LISE DE VALORES IGUAIS - 60 MESES\\r\\n  -- ===================================================================\\r\\n  COALESCE(ci60.contagem_periodos_iguais_60m, 0) AS valor_igual_total_periodos_60m,\\r\\n  ROUND(COALESCE(ci60.valor_medio_repetido_60m, 0), 2) AS valor_medio_repetido_60m,\\r\\n  CAST(COALESCE(ci60.primeiro_periodo_igual_60m, 0) AS STRING) AS primeiro_periodo_valor_igual_60m,\\r\\n  CAST(COALESCE(ci60.ultimo_periodo_igual_60m, 0) AS STRING) AS ultimo_periodo_valor_igual_60m,\\r\\n  \\r\\n  -- AN\\u00c1LISE DE VALORES IGUAIS - 12 MESES\\r\\n  COALESCE(ci12.contagem_periodos_iguais_12m, 0) AS valor_igual_total_periodos_12m,\\r\\n  ROUND(COALESCE(ci12.valor_medio_repetido_12m, 0), 2) AS valor_medio_repetido_12m,\\r\\n  CAST(COALESCE(ci12.primeiro_periodo_igual_12m, 0) AS STRING) AS primeiro_periodo_valor_igual_12m,\\r\\n  CAST(COALESCE(ci12.ultimo_periodo_igual_12m, 0) AS STRING) AS ultimo_periodo_valor_igual_12m,\\r\\n  \\r\\n  -- SEQU\\u00caNCIA RECENTE (12 MESES)\\r\\n  COALESCE(seq12.qtde_ultimos_12m_iguais, 0) AS qtde_ultimos_12m_iguais,\\r\\n  CAST(COALESCE(seq12.periodo_inicial_seq_12m, 0) AS STRING) AS periodo_inicial_sequencia_12m,\\r\\n  CAST(COALESCE(seq12.periodo_final_seq_12m, 0) AS STRING) AS periodo_final_sequencia_12m,\\r\\n  ROUND(COALESCE(seq12.valor_sequencia_12m, 0), 2) AS valor_sequencia_12m,\\r\\n  \\r\\n  -- ===================================================================\\r\\n  -- ESTAT\\u00cdSTICAS DE CR\\u00c9DITOS - 12 MESES\\r\\n  -- ===================================================================\\r\\n  COALESCE(est12.qtde_meses_declarados_12m, 0) AS qtde_meses_declarados_12m,\\r\\n  ROUND(COALESCE(est12.media_credito_12m, 0), 2) AS media_credito_12m,\\r\\n  ROUND(COALESCE(est12.min_credito_12m, 0), 2) AS min_credito_12m,\\r\\n  ROUND(COALESCE(est12.max_credito_12m, 0), 2) AS max_credito_12m,\\r\\n  ROUND(COALESCE(est12.desvio_padrao_credito_12m, 0), 2) AS desvio_padrao_credito_12m,\\r\\n  \\r\\n  -- ESTAT\\u00cdSTICAS DE CR\\u00c9DITOS - 60 MESES\\r\\n  COALESCE(est60.qtde_meses_declarados_60m, 0) AS qtde_meses_declarados_60m,\\r\\n  ROUND(COALESCE(est60.media_credito_60m, 0), 2) AS media_credito_60m,\\r\\n  ROUND(COALESCE(est60.min_credito_60m, 0), 2) AS min_credito_60m,\\r\\n  ROUND(COALESCE(est60.max_credito_60m, 0), 2) AS max_credito_60m,\\r\\n  ROUND(COALESCE(est60.desvio_padrao_credito_60m, 0), 2) AS desvio_padrao_credito_60m,\\r\\n  ROUND(COALESCE(est60.total_credito_acumulado_60m, 0), 2) AS total_credito_acumulado_60m,\\r\\n  \\r\\n  -- ===================================================================\\r\\n  -- SALDO CREDOR E EVOLU\\u00c7\\u00c3O\\r\\n  -- ===================================================================\\r\\n  ROUND(COALESCE(saldo.saldo_credor_acumulado_atual, 0), 2) AS saldo_credor_atual,\\r\\n  \\r\\n  -- Evolu\\u00e7\\u00e3o 12 meses\\r\\n  ROUND(COALESCE(cresc12.saldo_12m_atras, 0), 2) AS saldo_12m_atras,\\r\\n  ROUND(COALESCE(cresc12.crescimento_absoluto_12m, 0), 2) AS crescimento_saldo_absoluto_12m,\\r\\n  ROUND(COALESCE(cresc12.crescimento_percentual_12m, 0), 2) AS crescimento_saldo_percentual_12m,\\r\\n  \\r\\n  -- Evolu\\u00e7\\u00e3o 60 meses\\r\\n  ROUND(COALESCE(cresc60.saldo_60m_atras, 0), 2) AS saldo_60m_atras,\\r\\n  ROUND(COALESCE(cresc60.crescimento_absoluto_60m, 0), 2) AS crescimento_saldo_absoluto_60m,\\r\\n  ROUND(COALESCE(cresc60.crescimento_percentual_60m, 0), 2) AS crescimento_saldo_percentual_60m,\\r\\n  \\r\\n  -- ===================================================================\\r\\n  -- CR\\u00c9DITOS PRESUMIDOS\\r\\n  -- ===================================================================\\r\\n  ROUND(COALESCE(cp12.vl_cp_total_12m, 0), 2) AS vl_credito_presumido_12m,\\r\\n  COALESCE(cp12.qtde_tipos_cp_12m, 0) AS qtde_tipos_cp_12m,\\r\\n  \\r\\n  ROUND(COALESCE(cp60.vl_cp_total_60m, 0), 2) AS vl_credito_presumido_60m,\\r\\n  COALESCE(cp60.qtde_tipos_cp_60m, 0) AS qtde_tipos_cp_60m,\\r\\n  COALESCE(cp60.meses_com_cp_60m, 0) AS meses_com_cp_60m,\\r\\n  \\r\\n  -- ===================================================================\\r\\n  -- SCORES DE RISCO\\r\\n  -- ===================================================================\\r\\n  \\r\\n  -- Score de Risco Base - 12 meses\\r\\n  (\\r\\n    CASE \\r\\n      WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 12 THEN 40\\r\\n      WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 6 THEN 30\\r\\n      WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 3 THEN 15\\r\\n      ELSE 0\\r\\n    END\\r\\n    +\\r\\n    CASE\\r\\n      WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 100 THEN 30\\r\\n      WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 50 THEN 20\\r\\n      WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 25 THEN 10\\r\\n      ELSE 0\\r\\n    END\\r\\n    +\\r\\n    CASE\\r\\n      WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 1000000 THEN 20\\r\\n      WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 500000 THEN 15\\r\\n      WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 100000 THEN 10\\r\\n      WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 50000 THEN 5\\r\\n      ELSE 0\\r\\n    END\\r\\n    +\\r\\n    CASE\\r\\n      WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 100 AND COALESCE(est12.media_credito_12m, 0) > 1000 THEN 10\\r\\n      WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 500 AND COALESCE(est12.media_credito_12m, 0) > 5000 THEN 5\\r\\n      ELSE 0\\r\\n    END\\r\\n  ) AS score_risco_12m,\\r\\n  \\r\\n  -- Score de Risco Base - 60 meses\\r\\n  (\\r\\n    CASE \\r\\n      WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 48 THEN 50\\r\\n      WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 36 THEN 40\\r\\n      WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 24 THEN 30\\r\\n      WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 12 THEN 20\\r\\n      ELSE 0\\r\\n    END\\r\\n    +\\r\\n    CASE\\r\\n      WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 500 THEN 40\\r\\n      WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 300 THEN 30\\r\\n      WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 150 THEN 20\\r\\n      WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 75 THEN 10\\r\\n      ELSE 0\\r\\n    END\\r\\n    +\\r\\n    CASE\\r\\n      WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 200 AND COALESCE(est60.media_credito_60m, 0) > 5000 THEN 15\\r\\n      WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 500 AND COALESCE(est60.media_credito_60m, 0) > 2000 THEN 10\\r\\n      ELSE 0\\r\\n    END\\r\\n    +\\r\\n    CASE\\r\\n      WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 5000000 THEN 25\\r\\n      WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 2000000 THEN 20\\r\\n      WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 1000000 THEN 15\\r\\n      WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 500000 THEN 10\\r\\n      ELSE 0\\r\\n    END\\r\\n  ) AS score_risco_60m,\\r\\n  \\r\\n  -- Classifica\\u00e7\\u00e3o de Risco - 12 meses\\r\\n  CASE\\r\\n    WHEN (\\r\\n      CASE WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 12 THEN 40 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 6 THEN 30 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 3 THEN 15 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 100 THEN 30 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 50 THEN 20 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 25 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 1000000 THEN 20 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 500000 THEN 15 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 100000 THEN 10 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 50000 THEN 5 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 100 AND COALESCE(est12.media_credito_12m, 0) > 1000 THEN 10 WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 500 AND COALESCE(est12.media_credito_12m, 0) > 5000 THEN 5 ELSE 0 END\\r\\n    ) >= 70 THEN 'CR\\u00cdTICO'\\r\\n    WHEN (\\r\\n      CASE WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 12 THEN 40 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 6 THEN 30 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 3 THEN 15 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 100 THEN 30 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 50 THEN 20 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 25 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 1000000 THEN 20 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 500000 THEN 15 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 100000 THEN 10 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 50000 THEN 5 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 100 AND COALESCE(est12.media_credito_12m, 0) > 1000 THEN 10 WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 500 AND COALESCE(est12.media_credito_12m, 0) > 5000 THEN 5 ELSE 0 END\\r\\n    ) >= 50 THEN 'ALTO'\\r\\n    WHEN (\\r\\n      CASE WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 12 THEN 40 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 6 THEN 30 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 3 THEN 15 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 100 THEN 30 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 50 THEN 20 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 25 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 1000000 THEN 20 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 500000 THEN 15 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 100000 THEN 10 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 50000 THEN 5 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 100 AND COALESCE(est12.media_credito_12m, 0) > 1000 THEN 10 WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 500 AND COALESCE(est12.media_credito_12m, 0) > 5000 THEN 5 ELSE 0 END\\r\\n    ) >= 30 THEN 'M\\u00c9DIO'\\r\\n    ELSE 'BAIXO'\\r\\n  END AS classificacao_risco_12m,\\r\\n  \\r\\n  -- Classifica\\u00e7\\u00e3o de Risco - 60 meses\\r\\n  CASE\\r\\n    WHEN (\\r\\n      CASE WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 48 THEN 50 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 36 THEN 40 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 24 THEN 30 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 12 THEN 20 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 500 THEN 40 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 300 THEN 30 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 150 THEN 20 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 75 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 200 AND COALESCE(est60.media_credito_60m, 0) > 5000 THEN 15 WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 500 AND COALESCE(est60.media_credito_60m, 0) > 2000 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 5000000 THEN 25 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 2000000 THEN 20 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 1000000 THEN 15 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 500000 THEN 10 ELSE 0 END\\r\\n    ) >= 90 THEN 'CR\\u00cdTICO'\\r\\n    WHEN (\\r\\n      CASE WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 48 THEN 50 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 36 THEN 40 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 24 THEN 30 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 12 THEN 20 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 500 THEN 40 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 300 THEN 30 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 150 THEN 20 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 75 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 200 AND COALESCE(est60.media_credito_60m, 0) > 5000 THEN 15 WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 500 AND COALESCE(est60.media_credito_60m, 0) > 2000 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 5000000 THEN 25 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 2000000 THEN 20 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 1000000 THEN 15 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 500000 THEN 10 ELSE 0 END\\r\\n    ) >= 60 THEN 'ALTO'\\r\\n    WHEN (\\r\\n      CASE WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 48 THEN 50 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 36 THEN 40 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 24 THEN 30 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 12 THEN 20 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 500 THEN 40 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 300 THEN 30 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 150 THEN 20 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 75 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 200 AND COALESCE(est60.media_credito_60m, 0) > 5000 THEN 15 WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 500 AND COALESCE(est60.media_credito_60m, 0) > 2000 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 5000000 THEN 25 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 2000000 THEN 20 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 1000000 THEN 15 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 500000 THEN 10 ELSE 0 END\\r\\n    ) >= 35 THEN 'M\\u00c9DIO'\\r\\n    ELSE 'BAIXO'\\r\\n  END AS classificacao_risco_60m,\\r\\n  \\r\\n  -- ===================================================================\\r\\n  -- DADOS DE ENRIQUECIMENTO\\r\\n  -- ===================================================================\\r\\n  \\r\\n  -- Dados de Recolhimento\\r\\n  COALESCE(dr.quantidade_pagtos, 0) AS quantidade_pagtos,\\r\\n  ROUND(COALESCE(dr.valor_pagtos, 0), 2) AS valor_pagtos,\\r\\n  \\r\\n  -- Dados de Declara\\u00e7\\u00f5es Zeradas - NORMAL\\r\\n  dzn.contador_normal,\\r\\n  ROUND(COALESCE(dzn.total_vl_faturamento, 0), 2) AS total_vl_faturamento,\\r\\n  ROUND(COALESCE(dzn.total_vl_receita_bruta, 0), 2) AS total_vl_receita_bruta,\\r\\n  ROUND(COALESCE(dzn.total_vl_tot_cred, 0), 2) AS total_vl_tot_cred,\\r\\n  ROUND(COALESCE(dzn.total_vl_tot_deb, 0), 2) AS total_vl_tot_deb,\\r\\n  ROUND(COALESCE(dzn.total_vl_deb_recolher, 0), 2) AS total_vl_deb_recolher,\\r\\n  dzn.dt_constituicao_normal,\\r\\n  COALESCE(dzn.nfes_emitidas_normal, 0) AS nfes_emitidas_normal,\\r\\n  COALESCE(dzn.periodos_omissos_normal, 0) AS periodos_omissos_normal,\\r\\n  COALESCE(dzn.periodos_zerados_normal, 0) AS periodos_zerados_normal,\\r\\n  COALESCE(dzn.total_periodos_normal, 0) AS total_periodos_normal,\\r\\n  COALESCE(dzn.periodos_declarados_normal, 0) AS periodos_declarados_normal,\\r\\n  \\r\\n  -- Dados de Declara\\u00e7\\u00f5es Zeradas - SIMPLES\\r\\n  dzs.contador_simples,\\r\\n  ROUND(COALESCE(dzs.total_vl_rec_bruta, 0), 2) AS total_vl_rec_bruta,\\r\\n  ROUND(COALESCE(dzs.max_vl_rec_bruta_em_12m, 0), 2) AS max_vl_rec_bruta_em_12m,\\r\\n  ROUND(COALESCE(dzs.total_vl_rec_bruta_no_ano, 0), 2) AS total_vl_rec_bruta_no_ano,\\r\\n  ROUND(COALESCE(dzs.total_vl_icms_sc, 0), 2) AS total_vl_icms_sc,\\r\\n  dzs.dt_constituicao_simples,\\r\\n  COALESCE(dzs.nfes_emitidas_simples, 0) AS nfes_emitidas_simples,\\r\\n  COALESCE(dzs.periodos_omissos_simples, 0) AS periodos_omissos_simples,\\r\\n  COALESCE(dzs.periodos_zerados_simples, 0) AS periodos_zerados_simples,\\r\\n  COALESCE(dzs.total_periodos_simples, 0) AS total_periodos_simples,\\r\\n  COALESCE(dzs.periodos_declarados_simples, 0) AS periodos_declarados_simples,\\r\\n  \\r\\n  -- Dados de Suspeitas\\r\\n  ds.cd_situacao_suspeita,\\r\\n  ds.dt_situacao_suspeita,\\r\\n  COALESCE(ds.score_suspeita, 0) AS score_suspeita,\\r\\n  COALESCE(ds.qt_motivos, 0) AS qt_motivos,\\r\\n  ds.cd_tipo_confirmacao,\\r\\n  COALESCE(ds.sn_cancelado_inex_inativ, 0) AS sn_cancelado_inex_inativ,\\r\\n  ds.dt_inicio_protoc_cancelamento,\\r\\n  ds.tx_obs_situacao_suspeita,\\r\\n  COALESCE(ds.nu_score_ia, 0) AS nu_score_ia,\\r\\n  COALESCE(ds.qt_meses_valores, 0) AS qt_meses_valores,\\r\\n  ROUND(COALESCE(ds.vl_nfes_saida_suspeita, 0), 2) AS vl_nfes_saida_suspeita,\\r\\n  ROUND(COALESCE(ds.vl_total_icms_nfes_saida, 0), 2) AS vl_total_icms_nfes_saida,\\r\\n  ROUND(COALESCE(ds.vl_nfes_entrada_suspeita, 0), 2) AS vl_nfes_entrada_suspeita,\\r\\n  ROUND(COALESCE(ds.vl_total_icms_nfes_entrada, 0), 2) AS vl_total_icms_nfes_entrada,\\r\\n  ROUND(COALESCE(ds.vl_total_arrecadacao_grupo, 0), 2) AS vl_total_arrecadacao_grupo,\\r\\n  COALESCE(ds.qt_clientes_noteiras, 0) AS qt_clientes_noteiras,\\r\\n  COALESCE(ds.qt_fornecedoras_noteiras, 0) AS qt_fornecedoras_noteiras,\\r\\n  COALESCE(ds.sn_suspenso_dfe, 0) AS sn_suspenso_dfe,\\r\\n  ds.dt_suspensao_dfe_suspeita,\\r\\n  \\r\\n  -- Contagem de Ind\\u00edcios de Fraude\\r\\n  COALESCE(di.qtde_indicios_fraude, 0) AS qtde_indicios_fraude,\\r\\n  ROUND(COALESCE(di.soma_score_indicios, 0), 2) AS soma_score_indicios,\\r\\n  \\r\\n  -- ===================================================================\\r\\n  -- FLAGS E INDICADORES CONSOLIDADOS\\r\\n  -- ===================================================================\\r\\n  CASE WHEN ds.cd_situacao_suspeita IS NOT NULL THEN 1 ELSE 0 END AS flag_empresa_suspeita,\\r\\n  CASE WHEN COALESCE(dr.quantidade_pagtos, 0) > 0 THEN 1 ELSE 0 END AS flag_tem_pagamentos,\\r\\n  CASE WHEN COALESCE(dzn.periodos_zerados_normal, 0) > 0 OR COALESCE(dzs.periodos_zerados_simples, 0) > 0 THEN 1 ELSE 0 END AS flag_tem_declaracoes_zeradas,\\r\\n  CASE WHEN COALESCE(dzn.periodos_omissos_normal, 0) > 0 OR COALESCE(dzs.periodos_omissos_simples, 0) > 0 THEN 1 ELSE 0 END AS flag_tem_omissoes,\\r\\n  \\r\\n  -- ===================================================================\\r\\n  -- SCORES COMBINADOS (BASE + ENRIQUECIMENTO)\\r\\n  -- ===================================================================\\r\\n  \\r\\n  -- Score Combinado 12 meses\\r\\n  (\\r\\n    -- Score base 12m\\r\\n    (\\r\\n      CASE WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 12 THEN 40 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 6 THEN 30 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 3 THEN 15 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 100 THEN 30 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 50 THEN 20 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 25 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 1000000 THEN 20 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 500000 THEN 15 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 100000 THEN 10 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 50000 THEN 5 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 100 AND COALESCE(est12.media_credito_12m, 0) > 1000 THEN 10 WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 500 AND COALESCE(est12.media_credito_12m, 0) > 5000 THEN 5 ELSE 0 END\\r\\n    )\\r\\n    +\\r\\n    -- Pontos de enriquecimento\\r\\n    CASE WHEN ds.cd_situacao_suspeita IS NOT NULL THEN 30 ELSE 0 END +\\r\\n    CASE WHEN COALESCE(ds.score_suspeita, 0) > 80 THEN 20 WHEN COALESCE(ds.score_suspeita, 0) > 50 THEN 10 ELSE 0 END +\\r\\n    CASE WHEN COALESCE(dzn.periodos_zerados_normal, 0) >= 6 OR COALESCE(dzs.periodos_zerados_simples, 0) >= 6 THEN 15 ELSE 0 END +\\r\\n    CASE WHEN COALESCE(dzn.periodos_omissos_normal, 0) >= 3 OR COALESCE(dzs.periodos_omissos_simples, 0) >= 3 THEN 10 ELSE 0 END +\\r\\n    CASE WHEN COALESCE(ds.sn_cancelado_inex_inativ, 0) = 1 THEN 25 ELSE 0 END +\\r\\n    CASE WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 5 THEN 20 WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 3 THEN 10 ELSE 0 END\\r\\n  ) AS score_risco_combinado_12m,\\r\\n  \\r\\n  -- Score Combinado 60 meses\\r\\n  (\\r\\n    -- Score base 60m\\r\\n    (\\r\\n      CASE WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 48 THEN 50 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 36 THEN 40 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 24 THEN 30 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 12 THEN 20 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 500 THEN 40 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 300 THEN 30 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 150 THEN 20 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 75 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 200 AND COALESCE(est60.media_credito_60m, 0) > 5000 THEN 15 WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 500 AND COALESCE(est60.media_credito_60m, 0) > 2000 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 5000000 THEN 25 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 2000000 THEN 20 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 1000000 THEN 15 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 500000 THEN 10 ELSE 0 END\\r\\n    )\\r\\n    +\\r\\n    -- Pontos de enriquecimento (mesmos do 12m)\\r\\n    CASE WHEN ds.cd_situacao_suspeita IS NOT NULL THEN 30 ELSE 0 END +\\r\\n    CASE WHEN COALESCE(ds.score_suspeita, 0) > 80 THEN 20 WHEN COALESCE(ds.score_suspeita, 0) > 50 THEN 10 ELSE 0 END +\\r\\n    CASE WHEN COALESCE(dzn.periodos_zerados_normal, 0) >= 6 OR COALESCE(dzs.periodos_zerados_simples, 0) >= 6 THEN 15 ELSE 0 END +\\r\\n    CASE WHEN COALESCE(dzn.periodos_omissos_normal, 0) >= 3 OR COALESCE(dzs.periodos_omissos_simples, 0) >= 3 THEN 10 ELSE 0 END +\\r\\n    CASE WHEN COALESCE(ds.sn_cancelado_inex_inativ, 0) = 1 THEN 25 ELSE 0 END +\\r\\n    CASE WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 5 THEN 20 WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 3 THEN 10 ELSE 0 END\\r\\n  ) AS score_risco_combinado_60m,\\r\\n  \\r\\n  -- Classifica\\u00e7\\u00e3o Combinada 12m\\r\\n  CASE\\r\\n    WHEN (\\r\\n      (CASE WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 12 THEN 40 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 6 THEN 30 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 3 THEN 15 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 100 THEN 30 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 50 THEN 20 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 25 THEN 10 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 1000000 THEN 20 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 500000 THEN 15 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 100000 THEN 10 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 50000 THEN 5 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 100 AND COALESCE(est12.media_credito_12m, 0) > 1000 THEN 10 WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 500 AND COALESCE(est12.media_credito_12m, 0) > 5000 THEN 5 ELSE 0 END) +\\r\\n      CASE WHEN ds.cd_situacao_suspeita IS NOT NULL THEN 30 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.score_suspeita, 0) > 80 THEN 20 WHEN COALESCE(ds.score_suspeita, 0) > 50 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_zerados_normal, 0) >= 6 OR COALESCE(dzs.periodos_zerados_simples, 0) >= 6 THEN 15 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_omissos_normal, 0) >= 3 OR COALESCE(dzs.periodos_omissos_simples, 0) >= 3 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.sn_cancelado_inex_inativ, 0) = 1 THEN 25 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 5 THEN 20 WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 3 THEN 10 ELSE 0 END\\r\\n    ) >= 100 THEN 'CR\\u00cdTICO'\\r\\n    WHEN (\\r\\n      (CASE WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 12 THEN 40 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 6 THEN 30 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 3 THEN 15 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 100 THEN 30 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 50 THEN 20 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 25 THEN 10 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 1000000 THEN 20 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 500000 THEN 15 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 100000 THEN 10 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 50000 THEN 5 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 100 AND COALESCE(est12.media_credito_12m, 0) > 1000 THEN 10 WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 500 AND COALESCE(est12.media_credito_12m, 0) > 5000 THEN 5 ELSE 0 END) +\\r\\n      CASE WHEN ds.cd_situacao_suspeita IS NOT NULL THEN 30 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.score_suspeita, 0) > 80 THEN 20 WHEN COALESCE(ds.score_suspeita, 0) > 50 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_zerados_normal, 0) >= 6 OR COALESCE(dzs.periodos_zerados_simples, 0) >= 6 THEN 15 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_omissos_normal, 0) >= 3 OR COALESCE(dzs.periodos_omissos_simples, 0) >= 3 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.sn_cancelado_inex_inativ, 0) = 1 THEN 25 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 5 THEN 20 WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 3 THEN 10 ELSE 0 END\\r\\n    ) >= 70 THEN 'ALTO'\\r\\n    WHEN (\\r\\n      (CASE WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 12 THEN 40 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 6 THEN 30 WHEN COALESCE(seq12.qtde_ultimos_12m_iguais, 0) >= 3 THEN 15 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 100 THEN 30 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 50 THEN 20 WHEN COALESCE(cresc12.crescimento_percentual_12m, 0) > 25 THEN 10 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 1000000 THEN 20 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 500000 THEN 15 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 100000 THEN 10 WHEN COALESCE(saldo.saldo_credor_acumulado_atual, 0) > 50000 THEN 5 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 100 AND COALESCE(est12.media_credito_12m, 0) > 1000 THEN 10 WHEN COALESCE(est12.desvio_padrao_credito_12m, 0) < 500 AND COALESCE(est12.media_credito_12m, 0) > 5000 THEN 5 ELSE 0 END) +\\r\\n      CASE WHEN ds.cd_situacao_suspeita IS NOT NULL THEN 30 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.score_suspeita, 0) > 80 THEN 20 WHEN COALESCE(ds.score_suspeita, 0) > 50 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_zerados_normal, 0) >= 6 OR COALESCE(dzs.periodos_zerados_simples, 0) >= 6 THEN 15 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_omissos_normal, 0) >= 3 OR COALESCE(dzs.periodos_omissos_simples, 0) >= 3 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.sn_cancelado_inex_inativ, 0) = 1 THEN 25 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 5 THEN 20 WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 3 THEN 10 ELSE 0 END\\r\\n    ) >= 40 THEN 'M\\u00c9DIO'\\r\\n    ELSE 'BAIXO'\\r\\n  END AS classificacao_risco_combinado_12m,\\r\\n  \\r\\n  -- Classifica\\u00e7\\u00e3o Combinada 60m\\r\\n  CASE\\r\\n    WHEN (\\r\\n      (CASE WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 48 THEN 50 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 36 THEN 40 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 24 THEN 30 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 12 THEN 20 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 500 THEN 40 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 300 THEN 30 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 150 THEN 20 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 75 THEN 10 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 200 AND COALESCE(est60.media_credito_60m, 0) > 5000 THEN 15 WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 500 AND COALESCE(est60.media_credito_60m, 0) > 2000 THEN 10 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 5000000 THEN 25 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 2000000 THEN 20 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 1000000 THEN 15 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 500000 THEN 10 ELSE 0 END) +\\r\\n      CASE WHEN ds.cd_situacao_suspeita IS NOT NULL THEN 30 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.score_suspeita, 0) > 80 THEN 20 WHEN COALESCE(ds.score_suspeita, 0) > 50 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_zerados_normal, 0) >= 6 OR COALESCE(dzs.periodos_zerados_simples, 0) >= 6 THEN 15 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_omissos_normal, 0) >= 3 OR COALESCE(dzs.periodos_omissos_simples, 0) >= 3 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.sn_cancelado_inex_inativ, 0) = 1 THEN 25 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 5 THEN 20 WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 3 THEN 10 ELSE 0 END\\r\\n    ) >= 120 THEN 'CR\\u00cdTICO'\\r\\n    WHEN (\\r\\n      (CASE WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 48 THEN 50 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 36 THEN 40 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 24 THEN 30 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 12 THEN 20 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 500 THEN 40 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 300 THEN 30 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 150 THEN 20 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 75 THEN 10 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 200 AND COALESCE(est60.media_credito_60m, 0) > 5000 THEN 15 WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 500 AND COALESCE(est60.media_credito_60m, 0) > 2000 THEN 10 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 5000000 THEN 25 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 2000000 THEN 20 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 1000000 THEN 15 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 500000 THEN 10 ELSE 0 END) +\\r\\n      CASE WHEN ds.cd_situacao_suspeita IS NOT NULL THEN 30 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.score_suspeita, 0) > 80 THEN 20 WHEN COALESCE(ds.score_suspeita, 0) > 50 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_zerados_normal, 0) >= 6 OR COALESCE(dzs.periodos_zerados_simples, 0) >= 6 THEN 15 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_omissos_normal, 0) >= 3 OR COALESCE(dzs.periodos_omissos_simples, 0) >= 3 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.sn_cancelado_inex_inativ, 0) = 1 THEN 25 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 5 THEN 20 WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 3 THEN 10 ELSE 0 END\\r\\n    ) >= 85 THEN 'ALTO'\\r\\n    WHEN (\\r\\n      (CASE WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 48 THEN 50 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 36 THEN 40 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 24 THEN 30 WHEN COALESCE(ci60.contagem_periodos_iguais_60m, 0) >= 12 THEN 20 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 500 THEN 40 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 300 THEN 30 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 150 THEN 20 WHEN COALESCE(cresc60.crescimento_percentual_60m, 0) > 75 THEN 10 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 200 AND COALESCE(est60.media_credito_60m, 0) > 5000 THEN 15 WHEN COALESCE(est60.desvio_padrao_credito_60m, 0) < 500 AND COALESCE(est60.media_credito_60m, 0) > 2000 THEN 10 ELSE 0 END +\\r\\n       CASE WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 5000000 THEN 25 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 2000000 THEN 20 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 1000000 THEN 15 WHEN COALESCE(est60.total_credito_acumulado_60m, 0) > 500000 THEN 10 ELSE 0 END) +\\r\\n      CASE WHEN ds.cd_situacao_suspeita IS NOT NULL THEN 30 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.score_suspeita, 0) > 80 THEN 20 WHEN COALESCE(ds.score_suspeita, 0) > 50 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_zerados_normal, 0) >= 6 OR COALESCE(dzs.periodos_zerados_simples, 0) >= 6 THEN 15 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(dzn.periodos_omissos_normal, 0) >= 3 OR COALESCE(dzs.periodos_omissos_simples, 0) >= 3 THEN 10 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(ds.sn_cancelado_inex_inativ, 0) = 1 THEN 25 ELSE 0 END +\\r\\n      CASE WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 5 THEN 20 WHEN COALESCE(di.qtde_indicios_fraude, 0) >= 3 THEN 10 ELSE 0 END\\r\\n    ) >= 50 THEN 'M\\u00c9DIO'\\r\\n    ELSE 'BAIXO'\\r\\n  END AS classificacao_risco_combinado_60m\\r\\n  \\r\\nFROM \\r\\n  cnpjs_unicos df\\r\\nLEFT JOIN \\r\\n  usr_sat_ods.vw_ods_contrib c ON df.nu_cnpj = c.nu_cnpj\\r\\nLEFT JOIN \\r\\n  contagem_iguais_60m ci60 ON df.nu_cnpj = ci60.nu_cnpj\\r\\nLEFT JOIN \\r\\n  contagem_iguais_12m ci12 ON df.nu_cnpj = ci12.nu_cnpj\\r\\nLEFT JOIN \\r\\n  sequencia_ultimos_12m seq12 ON df.nu_cnpj = seq12.nu_cnpj\\r\\nLEFT JOIN \\r\\n  estatisticas_creditos_12m est12 ON df.nu_cnpj = est12.nu_cnpj\\r\\nLEFT JOIN \\r\\n  estatisticas_creditos_60m est60 ON df.nu_cnpj = est60.nu_cnpj\\r\\nLEFT JOIN \\r\\n  saldo_credor_atual saldo ON df.nu_cnpj = saldo.nu_cnpj\\r\\nLEFT JOIN \\r\\n  crescimento_saldo_12m cresc12 ON c.nu_cnpj_grupo = cresc12.nu_cnpj_grupo\\r\\nLEFT JOIN \\r\\n  crescimento_saldo_60m cresc60 ON c.nu_cnpj_grupo = cresc60.nu_cnpj_grupo\\r\\nLEFT JOIN \\r\\n  creditos_presumidos_12m cp12 ON c.nu_cnpj_grupo = cp12.nu_cnpj_grupo\\r\\nLEFT JOIN \\r\\n  creditos_presumidos_60m cp60 ON c.nu_cnpj_grupo = cp60.nu_cnpj_grupo\\r\\nLEFT JOIN\\r\\n  dados_recolhimento dr ON REGEXP_REPLACE(TRIM(CAST(df.nu_cnpj AS STRING)), '[^0-9]', '') = dr.cnpj_limpo\\r\\nLEFT JOIN\\r\\n  dados_zero_normal dzn ON REGEXP_REPLACE(TRIM(CAST(df.nu_cnpj AS STRING)), '[^0-9]', '') = dzn.cnpj_limpo\\r\\nLEFT JOIN\\r\\n  dados_zero_simples dzs ON REGEXP_REPLACE(TRIM(CAST(df.nu_cnpj AS STRING)), '[^0-9]', '') = dzs.cnpj_limpo\\r\\nLEFT JOIN\\r\\n  dados_suspeitas ds ON REGEXP_REPLACE(TRIM(CAST(df.nu_cnpj AS STRING)), '[^0-9]', '') = ds.cnpj_limpo\\r\\nLEFT JOIN\\r\\n  dados_indicios di ON REGEXP_REPLACE(TRIM(CAST(df.nu_cnpj AS STRING)), '[^0-9]', '') = di.cnpj_limpo\\r\\n\\r\\nORDER BY \\r\\n  score_risco_combinado_60m DESC, \\r\\n  score_risco_combinado_12m DESC,\\r\\n  score_risco_60m DESC;\", \"\\r\\n\\r\\n\\r\\n-- =====================================================================\\r\\n-- 2. TABELA CONSOLIDADA T\\u00caXTIL - teste.credito_dime_textil\\r\\n-- =====================================================================\\r\\nDROP TABLE IF EXISTS teste.credito_dime_textil;\", \"\\r\\n\\r\\nCREATE TABLE teste.credito_dime_textil STORED AS PARQUET AS\\r\\nWITH movimentacao_textil AS (\\r\\n  SELECT \\r\\n    my_efd.codigocnpj AS nu_cnpj,\\r\\n    SUM(CASE WHEN c170.cfop BETWEEN 1000 AND 3999 THEN c170.vl_item ELSE 0 END) AS vl_entradas_textil,\\r\\n    SUM(CASE WHEN c170.cfop BETWEEN 5000 AND 7999 THEN c170.vl_item ELSE 0 END) AS vl_saidas_textil,\\r\\n    COUNT(DISTINCT c100.dt_doc) AS dias_movimento_textil,\\r\\n    COUNT(DISTINCT r0200.cod_ncm) AS qtde_ncm_distintos_textil\\r\\n  FROM \\r\\n    efd.efd my_efd\\r\\n  JOIN \\r\\n    efd.efd_rc100 c100 ON my_efd.id_file = c100.id_file,\\r\\n    c100.listarc170_itensdocumento c170\\r\\n  JOIN \\r\\n    efd.efd_r0200 r0200 ON c100.id_file = r0200.id_file \\r\\n                        AND c170.cod_item = r0200.cod_item\\r\\n  WHERE \\r\\n    (my_efd.ano_referencia = 2024 OR \\r\\n     (my_efd.ano_referencia = 2025 AND my_efd.mes_referencia <= 9))\\r\\n    AND (r0200.cod_ncm LIKE '61%' OR r0200.cod_ncm LIKE '62%')\\r\\n  GROUP BY \\r\\n    my_efd.codigocnpj\\r\\n)\\r\\n\\r\\nSELECT \\r\\n  cd.*,\\r\\n  ROUND(COALESCE(mov.vl_entradas_textil, 0), 2) AS vl_entradas_textil,\\r\\n  ROUND(COALESCE(mov.vl_saidas_textil, 0), 2) AS vl_saidas_textil,\\r\\n  COALESCE(mov.dias_movimento_textil, 0) AS dias_movimento_textil,\\r\\n  COALESCE(mov.qtde_ncm_distintos_textil, 0) AS qtde_ncm_distintos_textil,\\r\\n  \\r\\n  CASE \\r\\n    WHEN mov.vl_saidas_textil > 0 THEN \\r\\n      ROUND(100.0 * mov.vl_entradas_textil / NULLIF(mov.vl_saidas_textil, 0), 2)\\r\\n    ELSE 0 \\r\\n  END AS indice_entrada_saida_textil,\\r\\n  \\r\\n  CASE \\r\\n    WHEN mov.vl_entradas_textil > 0 THEN\\r\\n      ROUND(cd.saldo_credor_atual / NULLIF(mov.vl_entradas_textil, 0), 4)\\r\\n    ELSE 0\\r\\n  END AS indice_saldo_entrada_textil,\\r\\n  \\r\\n  CASE WHEN mov.nu_cnpj IS NOT NULL THEN 1 ELSE 0 END AS flag_setor_textil,\\r\\n  'T\\u00caXTIL' AS setor,\\r\\n  \\r\\n  -- Score Combinado Setorial (usando score 60m como base)\\r\\n  (\\r\\n    cd.score_risco_combinado_60m + \\r\\n    CASE WHEN cd.flag_empresa_suspeita = 1 THEN 15 ELSE 0 END +\\r\\n    CASE WHEN cd.score_suspeita > 70 THEN 10 ELSE 0 END +\\r\\n    CASE WHEN cd.sn_cancelado_inex_inativ = 1 THEN 15 ELSE 0 END +\\r\\n    CASE WHEN cd.qtde_indicios_fraude >= 3 THEN 10 ELSE 0 END\\r\\n  ) AS score_risco_textil_combinado\\r\\n  \\r\\nFROM teste.credito_dime_completo cd\\r\\nLEFT JOIN movimentacao_textil mov ON cd.nu_cnpj = mov.nu_cnpj\\r\\n\\r\\nORDER BY score_risco_textil_combinado DESC;\", \"\\r\\n\\r\\n\\r\\n-- =====================================================================\\r\\n-- 3. TABELA CONSOLIDADA METAL-MEC\\u00c2NICO - teste.credito_dime_metalmec\\r\\n-- =====================================================================\\r\\nDROP TABLE IF EXISTS teste.credito_dime_metalmec;\", \"\\r\\n\\r\\nCREATE TABLE teste.credito_dime_metalmec STORED AS PARQUET AS\\r\\nWITH movimentacao_metalmec AS (\\r\\n  SELECT \\r\\n    my_efd.codigocnpj AS nu_cnpj,\\r\\n    SUM(CASE WHEN c170.cfop BETWEEN 1000 AND 3999 THEN c170.vl_item ELSE 0 END) AS vl_entradas_metalmec,\\r\\n    SUM(CASE WHEN c170.cfop BETWEEN 5000 AND 7999 THEN c170.vl_item ELSE 0 END) AS vl_saidas_metalmec,\\r\\n    COUNT(DISTINCT c100.dt_doc) AS dias_movimento_metalmec,\\r\\n    COUNT(DISTINCT r0200.cod_ncm) AS qtde_ncm_distintos_metalmec,\\r\\n    SUM(CASE WHEN r0200.cod_ncm LIKE '84%' THEN c170.vl_item ELSE 0 END) AS vl_cap84,\\r\\n    SUM(CASE WHEN r0200.cod_ncm LIKE '85%' THEN c170.vl_item ELSE 0 END) AS vl_cap85\\r\\n  FROM \\r\\n    efd.efd my_efd\\r\\n  JOIN \\r\\n    efd.efd_rc100 c100 ON my_efd.id_file = c100.id_file,\\r\\n    c100.listarc170_itensdocumento c170\\r\\n  JOIN \\r\\n    efd.efd_r0200 r0200 ON c100.id_file = r0200.id_file \\r\\n                        AND c170.cod_item = r0200.cod_item\\r\\n  WHERE \\r\\n    (my_efd.ano_referencia = 2024 OR \\r\\n     (my_efd.ano_referencia = 2025 AND my_efd.mes_referencia <= 9))\\r\\n    AND (r0200.cod_ncm LIKE '84%' OR r0200.cod_ncm LIKE '85%')\\r\\n  GROUP BY \\r\\n    my_efd.codigocnpj\\r\\n)\\r\\n\\r\\nSELECT \\r\\n  cd.*,\\r\\n  ROUND(COALESCE(mov.vl_entradas_metalmec, 0), 2) AS vl_entradas_metalmec,\\r\\n  ROUND(COALESCE(mov.vl_saidas_metalmec, 0), 2) AS vl_saidas_metalmec,\\r\\n  COALESCE(mov.dias_movimento_metalmec, 0) AS dias_movimento_metalmec,\\r\\n  COALESCE(mov.qtde_ncm_distintos_metalmec, 0) AS qtde_ncm_distintos_metalmec,\\r\\n  ROUND(COALESCE(mov.vl_cap84, 0), 2) AS vl_capitulo_84,\\r\\n  ROUND(COALESCE(mov.vl_cap85, 0), 2) AS vl_capitulo_85,\\r\\n  \\r\\n  CASE \\r\\n    WHEN mov.vl_saidas_metalmec > 0 THEN \\r\\n      ROUND(100.0 * mov.vl_entradas_metalmec / NULLIF(mov.vl_saidas_metalmec, 0), 2)\\r\\n    ELSE 0 \\r\\n  END AS indice_entrada_saida_metalmec,\\r\\n  \\r\\n  CASE \\r\\n    WHEN mov.vl_entradas_metalmec > 0 THEN\\r\\n      ROUND(cd.saldo_credor_atual / NULLIF(mov.vl_entradas_metalmec, 0), 4)\\r\\n    ELSE 0\\r\\n  END AS indice_saldo_entrada_metalmec,\\r\\n  \\r\\n  CASE \\r\\n    WHEN (mov.vl_cap84 + mov.vl_cap85) > 0 THEN\\r\\n      ROUND(100.0 * mov.vl_cap84 / NULLIF(mov.vl_cap84 + mov.vl_cap85, 0), 2)\\r\\n    ELSE 0\\r\\n  END AS perc_cap84,\\r\\n  \\r\\n  CASE WHEN mov.nu_cnpj IS NOT NULL THEN 1 ELSE 0 END AS flag_setor_metalmec,\\r\\n  'METAL-MEC\\u00c2NICO' AS setor,\\r\\n  \\r\\n  -- Score Combinado Setorial (usando score 60m como base)\\r\\n  (\\r\\n    cd.score_risco_combinado_60m + \\r\\n    CASE WHEN cd.flag_empresa_suspeita = 1 THEN 15 ELSE 0 END +\\r\\n    CASE WHEN cd.score_suspeita > 70 THEN 10 ELSE 0 END +\\r\\n    CASE WHEN cd.sn_cancelado_inex_inativ = 1 THEN 15 ELSE 0 END +\\r\\n    CASE WHEN cd.qtde_indicios_fraude >= 3 THEN 10 ELSE 0 END\\r\\n  ) AS score_risco_metalmec_combinado\\r\\n  \\r\\nFROM teste.credito_dime_completo cd\\r\\nLEFT JOIN movimentacao_metalmec mov ON cd.nu_cnpj = mov.nu_cnpj\\r\\n\\r\\nORDER BY score_risco_metalmec_combinado DESC;\", \"\\r\\n\\r\\n\\r\\n-- =====================================================================\\r\\n-- 4. TABELA CONSOLIDADA TECNOLOGIA - teste.credito_dime_tech\\r\\n-- =====================================================================\\r\\nDROP TABLE IF EXISTS teste.credito_dime_tech;\", \"\\r\\n\\r\\nCREATE TABLE teste.credito_dime_tech STORED AS PARQUET AS\\r\\nWITH movimentacao_tech AS (\\r\\n  SELECT \\r\\n    my_efd.codigocnpj AS nu_cnpj,\\r\\n    SUM(CASE WHEN c170.cfop BETWEEN 1000 AND 3999 THEN c170.vl_item ELSE 0 END) AS vl_entradas_tech,\\r\\n    SUM(CASE WHEN c170.cfop BETWEEN 5000 AND 7999 THEN c170.vl_item ELSE 0 END) AS vl_saidas_tech,\\r\\n    COUNT(DISTINCT c100.dt_doc) AS dias_movimento_tech,\\r\\n    COUNT(DISTINCT r0200.cod_ncm) AS qtde_ncm_distintos_tech,\\r\\n    SUM(CASE WHEN r0200.cod_ncm LIKE '8471%' THEN c170.vl_item ELSE 0 END) AS vl_computadores,\\r\\n    SUM(CASE WHEN r0200.cod_ncm LIKE '8473%' THEN c170.vl_item ELSE 0 END) AS vl_partes_computadores,\\r\\n    SUM(CASE WHEN r0200.cod_ncm LIKE '8517%' THEN c170.vl_item ELSE 0 END) AS vl_telecom\\r\\n  FROM \\r\\n    efd.efd my_efd\\r\\n  JOIN \\r\\n    efd.efd_rc100 c100 ON my_efd.id_file = c100.id_file,\\r\\n    c100.listarc170_itensdocumento c170\\r\\n  JOIN \\r\\n    efd.efd_r0200 r0200 ON c100.id_file = r0200.id_file \\r\\n                        AND c170.cod_item = r0200.cod_item\\r\\n  WHERE \\r\\n    (my_efd.ano_referencia = 2024 OR \\r\\n     (my_efd.ano_referencia = 2025 AND my_efd.mes_referencia <= 9))\\r\\n    AND (r0200.cod_ncm LIKE '8471%' OR r0200.cod_ncm LIKE '8473%' OR r0200.cod_ncm LIKE '8517%')\\r\\n  GROUP BY \\r\\n    my_efd.codigocnpj\\r\\n)\\r\\n\\r\\nSELECT \\r\\n  cd.*,\\r\\n  ROUND(COALESCE(mov.vl_entradas_tech, 0), 2) AS vl_entradas_tech,\\r\\n  ROUND(COALESCE(mov.vl_saidas_tech, 0), 2) AS vl_saidas_tech,\\r\\n  COALESCE(mov.dias_movimento_tech, 0) AS dias_movimento_tech,\\r\\n  COALESCE(mov.qtde_ncm_distintos_tech, 0) AS qtde_ncm_distintos_tech,\\r\\n  ROUND(COALESCE(mov.vl_computadores, 0), 2) AS vl_computadores,\\r\\n  ROUND(COALESCE(mov.vl_partes_computadores, 0), 2) AS vl_partes_computadores,\\r\\n  ROUND(COALESCE(mov.vl_telecom, 0), 2) AS vl_telecom,\\r\\n  \\r\\n  CASE \\r\\n    WHEN mov.vl_saidas_tech > 0 THEN \\r\\n      ROUND(100.0 * mov.vl_entradas_tech / NULLIF(mov.vl_saidas_tech, 0), 2)\\r\\n    ELSE 0 \\r\\n  END AS indice_entrada_saida_tech,\\r\\n  \\r\\n  CASE \\r\\n    WHEN mov.vl_entradas_tech > 0 THEN\\r\\n      ROUND(cd.saldo_credor_atual / NULLIF(mov.vl_entradas_tech, 0), 4)\\r\\n    ELSE 0\\r\\n  END AS indice_saldo_entrada_tech,\\r\\n  \\r\\n  CASE WHEN mov.nu_cnpj IS NOT NULL THEN 1 ELSE 0 END AS flag_setor_tech,\\r\\n  'TECNOLOGIA' AS setor,\\r\\n  \\r\\n  -- Score Combinado Setorial (usando score 60m como base)\\r\\n  (\\r\\n    cd.score_risco_combinado_60m + \\r\\n    CASE WHEN cd.flag_empresa_suspeita = 1 THEN 15 ELSE 0 END +\\r\\n    CASE WHEN cd.score_suspeita > 70 THEN 10 ELSE 0 END +\\r\\n    CASE WHEN cd.sn_cancelado_inex_inativ = 1 THEN 15 ELSE 0 END +\\r\\n    CASE WHEN cd.qtde_indicios_fraude >= 3 THEN 10 ELSE 0 END\\r\\n  ) AS score_risco_tech_combinado\\r\\n  \\r\\nFROM teste.credito_dime_completo cd\\r\\nLEFT JOIN movimentacao_tech mov ON cd.nu_cnpj = mov.nu_cnpj\\r\\n\\r\\nORDER BY score_risco_tech_combinado DESC;\"], \"aceSize\": 100, \"status\": \"ready\", \"statusForButtons\": \"executed\", \"properties\": {\"settings\": []}, \"viewSettings\": {\"placeHolder\": \"Exemplo: SELECT * FROM tablename ou pressione CTRL + espa\\u00e7o\", \"sqlDialect\": true}, \"variables\": [], \"hasCurlyBracketParameters\": true, \"variableNames\": [], \"variableValues\": {}, \"statement\": \"-- =====================================================================\\r\\n-- AN\\u00c1LISE CONSOLIDADA DE CR\\u00c9DITO DIME COM ENRIQUECIMENTO INTEGRADO\\r\\n-- Vers\\u00e3o Expandida - 12 e 60 meses\\r\\n-- =====================================================================\\r\\n\\r\\n-- ---------------------------------------------------------------------\\r\\n-- 1. TABELA PRINCIPAL CONSOLIDADA - teste.credito_dime_completo\\r\\n-- ---------------------------------------------------------------------\\r\\nDROP TABLE IF EXISTS teste.credito_dime_completo;\", \"result\": {\"id\": \"3d27ec9f-c5dc-f79e-1530-6bf5e9511ac8\", \"type\": \"table\", \"hasResultset\": true, \"handle\": {}, \"meta\": [], \"rows\": null, \"hasMore\": false, \"statement_id\": 0, \"statement_range\": {\"start\": {\"row\": 0, \"column\": 0}, \"end\": {\"row\": 0, \"column\": 0}}, \"statements_count\": 1, \"previous_statement_hash\": null, \"metaFilter\": {\"query\": \"\", \"facets\": {}, \"text\": []}, \"isMetaFilterVisible\": false, \"filteredMetaChecked\": true, \"filteredColumnCount\": -1, \"filteredMeta\": [], \"fetchedOnce\": false, \"startTime\": \"2025-10-15T20:19:07.943Z\", \"endTime\": \"2025-10-15T20:19:07.943Z\", \"executionTime\": 0, \"data\": [], \"explanation\": \"\", \"logs\": \"\", \"logLines\": 0, \"hasSomeResults\": false}, \"showGrid\": true, \"showChart\": false, \"showLogs\": true, \"progress\": 0, \"jobs\": [], \"executeNextTimeout\": -1, \"isLoading\": false, \"resultsKlass\": \"results impala\", \"errorsKlass\": \"results impala alert alert-error\", \"is_redacted\": false, \"chartType\": \"bars\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null, \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartLimits\": [5, 10, 25, 50, 100], \"chartLimit\": null, \"chartX\": null, \"chartXPivot\": null, \"chartYSingle\": null, \"chartYMulti\": [], \"chartData\": [], \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"hideStacked\": true, \"hasDataForChart\": false, \"previousChartOptions\": {\"chartLimit\": null, \"chartX\": null, \"chartXPivot\": null, \"chartYSingle\": null, \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"chartYMulti\": [], \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null}, \"isResultSettingsVisible\": false, \"settingsVisible\": false, \"checkStatusTimeout\": null, \"getLogsTimeout\": null, \"topRisk\": null, \"suggestion\": \"\", \"hasSuggestion\": null, \"compatibilityCheckRunning\": false, \"compatibilitySourcePlatforms\": [{\"name\": \"Teradata\", \"value\": \"teradata\"}, {\"name\": \"Oracle\", \"value\": \"oracle\"}, {\"name\": \"Netezza\", \"value\": \"netezza\"}, {\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}, {\"name\": \"DB2\", \"value\": \"db2\"}, {\"name\": \"Greenplum\", \"value\": \"greenplum\"}, {\"name\": \"MySQL\", \"value\": \"mysql\"}, {\"name\": \"PostgreSQL\", \"value\": \"postgresql\"}, {\"name\": \"Informix\", \"value\": \"informix\"}, {\"name\": \"SQL Server\", \"value\": \"sqlserver\"}, {\"name\": \"Sybase\", \"value\": \"sybase\"}, {\"name\": \"Access\", \"value\": \"access\"}, {\"name\": \"Firebird\", \"value\": \"firebird\"}, {\"name\": \"ANSISQL\", \"value\": \"ansisql\"}, {\"name\": \"Generic\", \"value\": \"generic\"}], \"compatibilitySourcePlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"compatibilityTargetPlatforms\": [{\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}], \"compatibilityTargetPlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"showSqlAnalyzer\": false, \"wasBatchExecuted\": false, \"isReady\": true, \"lastExecuted\": 0, \"lastAceSelectionRowOffset\": 0, \"executingBlockingOperation\": null, \"showLongOperationWarning\": false, \"formatEnabled\": true, \"isFetchingData\": false, \"isCanceling\": false, \"aceAutoExpand\": false}], \"selectedSnippet\": \"impala\", \"creatingSessionLocks\": [], \"sessions\": [], \"directoryUuid\": \"\", \"dependentsCoordinator\": [], \"historyFilter\": \"\", \"historyFilterVisible\": false, \"loadingHistory\": false, \"historyInitialHeight\": 78, \"forceHistoryInitialHeight\": false, \"historyCurrentPage\": 1, \"historyTotalPages\": 175, \"schedulerViewModel\": null, \"schedulerViewModelIsLoaded\": false, \"isBatchable\": true, \"isExecutingAll\": false, \"executingAllIndex\": 0, \"retryModalConfirm\": null, \"retryModalCancel\": null, \"canSave\": true, \"unloaded\": false, \"updateHistoryFailed\": false, \"viewSchedulerId\": \"\", \"loadingScheduler\": false}",
    "extra": "",
    "search": "-- =====================================================================\r\n-- ANÁLISE CONSOLIDADA DE CRÉDITO DIME COM ENRIQUECIMENTO INTEGRADO\r\n-- Versão Expandida - 12 e 60 meses\r\n-- =====================================================================\r\n\r\n-- ---------------------------------------------------------------------\r\n-- 1. TABELA PRINCIPAL CONSOLIDADA - teste.credito_dime_completo\r\n-- ---------------------------------------------------------------------\r\nDROP TABLE IF EXISTS teste.credito_dime_completo;\r\nSET REQUEST_POOL = 'medium';\r\n\r\nCREATE TABLE IF NOT EXISTS teste.credito_dime_completo AS\r\n\r\nWITH periodos AS (\r\n  SELECT periodo AS nu_per_ref\r\n  FROM (\r\n    -- 2020 (últimos 4 meses)\r\n    SELECT 202009 AS periodo UNION ALL SELECT 202010 UNION ALL SELECT 202011 UNION ALL SELECT 202012 UNION ALL\r\n    -- 2021\r\n    SELECT 202101 AS periodo UNION ALL SELECT 202102 UNION ALL SELECT 202103 UNION ALL SELECT 202104 UNION ALL\r\n    SELECT 202105 UNION ALL SELECT 202106 UNION ALL SELECT 202107 UNION ALL SELECT 202108 UNION ALL\r\n    SELECT 202109 UNION ALL SELECT 202110 UNION ALL SELECT 202111 UNION ALL SELECT 202112 UNION ALL\r\n    -- 2022\r\n    SELECT 202201 UNION ALL SELECT 202202 UNION ALL SELECT 202203 UNION ALL SELECT 202204 UNION ALL\r\n    SELECT 202205 UNION ALL SELECT 202206 UNION ALL SELECT 202207 UNION ALL SELECT 202208 UNION ALL\r\n    SELECT 202209 UNION ALL SELECT 202210 UNION ALL SELECT 202211 UNION ALL SELECT 202212 UNION ALL\r\n    -- 2023\r\n    SELECT 202301 UNION ALL SELECT 202302 UNION ALL SELECT 202303 UNION ALL SELECT 202304 UNION ALL\r\n    SELECT 202305 UNION ALL SELECT 202306 UNION ALL SELECT 202307 UNION ALL SELECT 202308 UNION ALL\r\n    SELECT 202309 UNION ALL SELECT 202310 UNION ALL SELECT 202311 UNION ALL SELECT 202312 UNION ALL\r\n    -- 2024\r\n    SELECT 202401 UNION ALL SELECT 202402 UNION ALL SELECT 202403 UNION ALL SELECT 202404 UNION ALL\r\n    SELECT 202405 UNION ALL SELECT 202406 UNION ALL SELECT 202407 UNION ALL SELECT 202408 UNION ALL\r\n    SEL",
    "last_modified": "2025-10-30T16:22:56.874",
    "version": 1,
    "is_history": false,
    "is_managed": false,
    "is_trashed": false,
    "parent_directory": [
      "1942b436-4932-433c-8549-8c097875c739",
      1,
      false
    ],
    "dependencies": []
  }
},
{
  "model": "desktop.document2",
  "pk": 164890,
  "fields": {
    "owner": [
      "tsevero"
    ],
    "name": "CRED-CANCEL",
    "description": "",
    "uuid": "1942b436-4932-433c-8549-8c097875c739",
    "type": "directory",
    "connector": null,
    "data": "{}",
    "extra": "",
    "search": null,
    "last_modified": "2025-10-15T17:19:20.986",
    "version": 1,
    "is_history": false,
    "is_managed": false,
    "is_trashed": false,
    "parent_directory": [
      "a8280168-7cf2-40b1-bc5d-733014ae6ba9",
      1,
      false
    ],
    "dependencies": []
  }
}
]
